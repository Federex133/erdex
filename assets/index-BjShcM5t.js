var e,t=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(e,s,r)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,l=(e,t)=>{for(var s in t||(t={}))i.call(t,s)&&o(e,s,t[s]);if(a)for(var s of a(t))n.call(t,s)&&o(e,s,t[s]);return e},c=(e,t)=>s(e,r(t)),d=(e,t)=>{var s={};for(var r in e)i.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&a)for(var r of a(e))t.indexOf(r)<0&&n.call(e,r)&&(s[r]=e[r]);return s},u=(e,t,s)=>o(e,"symbol"!=typeof t?t+"":t,s),h=(e,t,s)=>new Promise(((r,a)=>{var i=e=>{try{o(s.next(e))}catch(t){a(t)}},n=e=>{try{o(s.throw(e))}catch(t){a(t)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,n);o((s=s.apply(e,t)).next())}));import{j as m,S as p,O as f,P as x,C as g,a as v,T as y,D as b,R as w,b as j,c as _,d as N,u as k,e as S,f as C,I as E,g as T,h as P,i as A,k as R,V as O,L as I,l as $,m as D,n as L,o as M,p as U,q as F,r as V,s as q,t as z,v as B,w as Z,x as H,y as K,W,z as G,A as J,B as X,E as Y,F as Q,G as ee,H as te,J as se,K as re,M as ae,N as ie,Q as ne,U as oe,X as le,Y as ce,Z as de,_ as ue,$ as he,a0 as me,a1 as pe,a2 as fe,a3 as xe,a4 as ge,a5 as ve,a6 as ye,a7 as be,a8 as we,a9 as je,aa as _e,ab as Ne,ac as ke,ad as Se,ae as Ce,af as Ee,ag as Te}from"./ui-DXRfdSup.js";import{a as Pe,r as Ae,g as Re,d as Oe,c as Ie}from"./vendor-R2o2sIeT.js";import{t as $e,c as De,a as Le}from"./utils-BN-jISw6.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Me=Pe;function Ue(...e){return $e(De(e))}e=Me.createRoot,Me.hydrateRoot;const Fe=Le("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ve=Ae.forwardRef(((e,t)=>{var s=e,{className:r,variant:a,size:i,asChild:n=!1}=s,o=d(s,["className","variant","size","asChild"]);const c=n?p:"button";return m.jsx(c,l({className:Ue(Fe({variant:a,size:i,className:r})),ref:t},o))}));Ve.displayName="Button";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const qe=(...e)=>e.filter(((e,t,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===t)).join(" ").trim();
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var ze={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=Ae.forwardRef(((e,t)=>{var s=e,{color:r="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:n,className:o="",children:u,iconNode:h}=s,m=d(s,["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"]);return Ae.createElement("svg",l(c(l({ref:t},ze),{width:a,height:a,stroke:r,strokeWidth:n?24*Number(i)/Number(a):i,className:qe("lucide",o)}),m),[...h.map((([e,t])=>Ae.createElement(e,t))),...Array.isArray(u)?u:[u]])})),Ze=(e,t)=>{const s=Ae.forwardRef(((s,r)=>{var a,i=s,{className:n}=i,o=d(i,["className"]);return Ae.createElement(Be,l({ref:r,iconNode:t,className:qe(`lucide-${a=e,a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,n)},o))}));return s.displayName=`${e}`,s},He=Ze("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Ke=Ze("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),We=Ze("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),Ge=Ze("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Je=Ze("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Xe=Ze("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Ye=Ze("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Qe=Ze("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),et=Ze("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),tt=Ze("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),st=Ze("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),rt=Ze("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),at=Ze("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),it=Ze("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),nt=Ze("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ot=Ze("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),lt=Ze("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),ct=Ze("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),dt=Ze("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),ut=Ze("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),ht=Ze("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),mt=Ze("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),pt=Ze("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ft=Ze("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),xt=Ze("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),gt=Ze("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),vt=Ze("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),yt=Ze("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),bt=Ze("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),wt=Ze("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),jt=Ze("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),_t=Ze("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),Nt=Ze("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),kt=Ze("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),St=Ze("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Ct=Ze("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),Et=Ze("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),Tt=Ze("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),Pt=Ze("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),At=Ze("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),Rt=Ze("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Ot=Ze("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),It=Ze("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),$t=Ze("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Dt=Ze("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),Lt=Ze("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),Mt=Ze("Shuffle",[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]]),Ut=Ze("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),Ft=Ze("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Vt=Ze("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),qt=Ze("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),zt=Ze("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Bt=Ze("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Zt=Ze("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Ht=Ze("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Kt=Ze("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Wt=Ze("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Gt=Ze("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Jt=Ze("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Xt=Ze("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Yt=Ze("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Qt=Ze("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),es=Ze("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),ts=Ze("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),ss=Ze("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),rs=w,as=j,is=x,ns=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(f,c(l({className:Ue("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r)},a),{ref:t}))}));
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */ns.displayName=f.displayName;const os=Le("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ls=Ae.forwardRef(((e,t)=>{var s=e,{side:r="right",className:a,children:i}=s,n=d(s,["side","className","children"]);return m.jsxs(is,{children:[m.jsx(ns,{}),m.jsxs(g,c(l({ref:t,className:Ue(os({side:r}),a)},n),{children:[i,m.jsxs(v,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[m.jsx(ss,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"Close"})]})]}))]})}));ls.displayName=g.displayName;const cs=e=>{var t=e,{className:s}=t,r=d(t,["className"]);return m.jsx("div",l({className:Ue("flex flex-col space-y-2 text-center sm:text-left",s)},r))};cs.displayName="SheetHeader";const ds=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(y,l({ref:t,className:Ue("text-lg font-semibold text-foreground",r)},a))}));ds.displayName=y.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(b,l({ref:t,className:Ue("text-sm text-muted-foreground",r)},a))})).displayName=b.displayName;let us=0;const hs=new Map,ms=e=>{if(hs.has(e))return;const t=setTimeout((()=>{hs.delete(e),gs({type:"REMOVE_TOAST",toastId:e})}),1e6);hs.set(e,t)},ps=(e,t)=>{switch(t.type){case"ADD_TOAST":return c(l({},e),{toasts:[t.toast,...e.toasts].slice(0,1)});case"UPDATE_TOAST":return c(l({},e),{toasts:e.toasts.map((e=>e.id===t.toast.id?l(l({},e),t.toast):e))});case"DISMISS_TOAST":{const{toastId:s}=t;return s?ms(s):e.toasts.forEach((e=>{ms(e.id)})),c(l({},e),{toasts:e.toasts.map((e=>e.id===s||void 0===s?c(l({},e),{open:!1}):e))})}case"REMOVE_TOAST":return void 0===t.toastId?c(l({},e),{toasts:[]}):c(l({},e),{toasts:e.toasts.filter((e=>e.id!==t.toastId))})}},fs=[];let xs={toasts:[]};function gs(e){xs=ps(xs,e),fs.forEach((e=>{e(xs)}))}function vs(e){var t=d(e,[]);const s=(us=(us+1)%Number.MAX_SAFE_INTEGER,us.toString()),r=()=>gs({type:"DISMISS_TOAST",toastId:s});return gs({type:"ADD_TOAST",toast:c(l({},t),{id:s,open:!0,onOpenChange:e=>{e||r()}})}),{id:s,dismiss:r,update:e=>gs({type:"UPDATE_TOAST",toast:c(l({},e),{id:s})})}}function ys(){const[e,t]=Ae.useState(xs);return Ae.useEffect((()=>(fs.push(t),()=>{const e=fs.indexOf(t);e>-1&&fs.splice(e,1)})),[e]),c(l({},e),{toast:vs,dismiss:e=>gs({type:"DISMISS_TOAST",toastId:e})})}function bs(){const[e,t]=Ae.useState(!1);return Ae.useEffect((()=>{const e=navigator.userAgent.toLowerCase().includes("android");t(e)}),[]),e}const ws=()=>{const[e,t]=Ae.useState(null),[s,r]=Ae.useState(!1),{toast:a}=ys(),i=bs();Ae.useEffect((()=>{const e=e=>{e.preventDefault(),t(e),r(!0)};return window.addEventListener("beforeinstallprompt",e),()=>window.removeEventListener("beforeinstallprompt",e)}),[]);return i?m.jsxs(Ve,{onClick:()=>h(void 0,null,(function*(){if(e)try{yield e.prompt();const{outcome:s}=yield e.userChoice;a("accepted"===s?{title:"🎉 ¡ERDEX instalado!",description:"La aplicación se ha añadido a tu pantalla de inicio"}:{title:"📱 Instalación cancelada",description:"Puedes instalar ERDEX más tarde desde el menú del navegador"}),t(null),r(!1)}catch(s){console.error("Error installing PWA:",s),a({title:"❌ Error de instalación",description:"No se pudo instalar la aplicación. Intenta desde el menú del navegador.",variant:"destructive"})}else a({title:"📱 ERDEX ya está instalado",description:"La aplicación ya está disponible en tu dispositivo o no es compatible con PWA"})})),className:"bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white shadow-lg",children:[m.jsx(ut,{className:"w-4 h-4 mr-2"}),"Descargar ERDEX"]}):null};const js={},_s=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),i=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map((t=>{if(t=function(e,t){return new URL(e,t).href}(t,s),t in js)return;js[t]=!0;const r=t.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(!!s)for(let s=e.length-1;s>=0;s--){const a=e[s];if(a.href===t&&(!r||"stylesheet"===a.rel))return}else if(document.querySelector(`link[href="${t}"]${a}`))return;const n=document.createElement("link");return n.rel=r?"stylesheet":"modulepreload",r||(n.as="script"),n.crossOrigin="",n.href=t,i&&n.setAttribute("nonce",i),document.head.appendChild(n),r?new Promise(((e,s)=>{n.addEventListener("load",e),n.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)}))};class Ns extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class ks extends Ns{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ss extends Ns{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Cs extends Ns{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Es,Ts;(Ts=Es||(Es={})).Any="any",Ts.ApNortheast1="ap-northeast-1",Ts.ApNortheast2="ap-northeast-2",Ts.ApSouth1="ap-south-1",Ts.ApSoutheast1="ap-southeast-1",Ts.ApSoutheast2="ap-southeast-2",Ts.CaCentral1="ca-central-1",Ts.EuCentral1="eu-central-1",Ts.EuWest1="eu-west-1",Ts.EuWest2="eu-west-2",Ts.EuWest3="eu-west-3",Ts.SaEast1="sa-east-1",Ts.UsEast1="us-east-1",Ts.UsWest1="us-west-1",Ts.UsWest2="us-west-2";var Ps=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};class As{constructor(e,{headers:t={},customFetch:s,region:r=Es.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>_s((()=>h(void 0,null,(function*(){const{default:e}=yield Promise.resolve().then((()=>Bs));return{default:e}}))),void 0,import.meta.url).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Ps(this,void 0,void 0,(function*(){try{const{headers:r,method:a,body:i}=t;let n,o={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(o["x-region"]=l),i&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",n=i):"string"==typeof i?(o["Content-Type"]="text/plain",n=i):"undefined"!=typeof FormData&&i instanceof FormData?n=i:(o["Content-Type"]="application/json",n=JSON.stringify(i)));const c=yield this.fetch(`${this.url}/${e}`,{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:n}).catch((e=>{throw new ks(e)})),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new Ss(c);if(!c.ok)throw new Cs(c);let u,h=(null!==(s=c.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return u="application/json"===h?yield c.json():"application/octet-stream"===h?yield c.blob():"text/event-stream"===h?c:"multipart/form-data"===h?yield c.formData():yield c.text(),{data:u,error:null}}catch(r){return{data:null,error:r}}}))}}var Rs={},Os={},Is={},$s={},Ds={},Ls={},Ms=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const Us=Ms.fetch,Fs=Ms.fetch.bind(Ms),Vs=Ms.Headers,qs=Ms.Request,zs=Ms.Response,Bs=Object.freeze(Object.defineProperty({__proto__:null,Headers:Vs,Request:qs,Response:zs,default:Fs,fetch:Us},Symbol.toStringTag,{value:"Module"})),Zs=Re(Bs);var Hs={};Object.defineProperty(Hs,"__esModule",{value:!0});let Ks=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Hs.default=Ks;var Ws=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ls,"__esModule",{value:!0});const Gs=Ws(Zs),Js=Ws(Hs);Ls.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=Gs.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((e=>h(this,null,(function*(){var t,s,r;let a=null,i=null,n=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=yield e.text();""===t||(i="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const r=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");r&&c&&c.length>1&&(n=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(a={code:"PGRST116",details:`Results contain ${i.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,n=null,o=406,l="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=yield e.text();try{a=JSON.parse(t),Array.isArray(a)&&404===e.status&&(i=[],a=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):a={message:t}}if(a&&this.isMaybeSingle&&(null===(r=null==a?void 0:a.details)||void 0===r?void 0:r.includes("0 rows"))&&(a=null,o=200,l="OK"),a&&this.shouldThrowOnError)throw new Js.default(a)}return{error:a,data:i,count:n,status:o,statusText:l}}))));return this.shouldThrowOnError||(s=s.catch((e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}}))),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var Xs=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ds,"__esModule",{value:!0});const Ys=Xs(Ls);let Qs=class extends Ys.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:a=r}={}){const i=a?`${a}.order`:"order",n=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const a=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:a=!1,format:i="text"}={}){var n;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=null!==(n=this.headers.Accept)&&void 0!==n?n:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ds.default=Qs;var er=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($s,"__esModule",{value:!0});const tr=er(Ds);let sr=class extends tr.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let a="";"plain"===r?a="pl":"phrase"===r?a="ph":"websearch"===r&&(a="w");const i=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${a}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};$s.default=sr;var rr=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Is,"__esModule",{value:!0});const ar=rr($s);Is.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let a=!1;const i=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e))).join("");return this.url.searchParams.set("select",i),s&&(this.headers.Prefer=`count=${s}`),new ar.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new ar.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:a=!0}={}){const i=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&i.push(this.headers.Prefer),r&&i.push(`count=${r}`),a||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new ar.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new ar.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new ar.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var ir={},nr={};Object.defineProperty(nr,"__esModule",{value:!0}),nr.version=void 0,nr.version="0.0.0-automated",Object.defineProperty(ir,"__esModule",{value:!0}),ir.DEFAULT_HEADERS=void 0;const or=nr;ir.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${or.version}`};var lr=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Os,"__esModule",{value:!0});const cr=lr(Is),dr=lr($s),ur=ir;Os.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},ur.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new cr.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:a}={}){let i;const n=new URL(`${this.url}/rpc/${e}`);let o;s||r?(i=s?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{n.searchParams.append(e,t)}))):(i="POST",o=t);const l=Object.assign({},this.headers);return a&&(l.Prefer=`count=${a}`),new dr.default({method:i,url:n,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var hr=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.PostgrestError=Rs.PostgrestBuilder=Rs.PostgrestTransformBuilder=Rs.PostgrestFilterBuilder=Rs.PostgrestQueryBuilder=Rs.PostgrestClient=void 0;const mr=hr(Os);Rs.PostgrestClient=mr.default;const pr=hr(Is);Rs.PostgrestQueryBuilder=pr.default;const fr=hr($s);Rs.PostgrestFilterBuilder=fr.default;const xr=hr(Ds);Rs.PostgrestTransformBuilder=xr.default;const gr=hr(Ls);Rs.PostgrestBuilder=gr.default;const vr=hr(Hs);Rs.PostgrestError=vr.default;var yr=Rs.default={PostgrestClient:mr.default,PostgrestQueryBuilder:pr.default,PostgrestFilterBuilder:fr.default,PostgrestTransformBuilder:xr.default,PostgrestBuilder:gr.default,PostgrestError:vr.default};const{PostgrestClient:br,PostgrestQueryBuilder:wr,PostgrestFilterBuilder:jr,PostgrestTransformBuilder:_r,PostgrestBuilder:Nr,PostgrestError:kr}=yr;let Sr;Sr="undefined"==typeof window?require("ws"):window.WebSocket;const Cr={"X-Client-Info":"realtime-js/2.11.10"};var Er,Tr,Pr,Ar,Rr,Or,Ir,$r,Dr,Lr,Mr;(Tr=Er||(Er={}))[Tr.connecting=0]="connecting",Tr[Tr.open=1]="open",Tr[Tr.closing=2]="closing",Tr[Tr.closed=3]="closed",(Ar=Pr||(Pr={})).closed="closed",Ar.errored="errored",Ar.joined="joined",Ar.joining="joining",Ar.leaving="leaving",(Or=Rr||(Rr={})).close="phx_close",Or.error="phx_error",Or.join="phx_join",Or.reply="phx_reply",Or.leave="phx_leave",Or.access_token="access_token",(Ir||(Ir={})).websocket="websocket",(Dr=$r||($r={})).Connecting="connecting",Dr.Open="open",Dr.Closing="closing",Dr.Closed="closed";class Ur{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),a=t.getUint8(2);let i=this.HEADER_LENGTH+2;const n=s.decode(e.slice(i,i+r));i+=r;const o=s.decode(e.slice(i,i+a));i+=a;return{ref:null,topic:n,event:o,payload:JSON.parse(s.decode(e.slice(i,e.byteLength)))}}}class Fr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}(Mr=Lr||(Lr={})).abstime="abstime",Mr.bool="bool",Mr.date="date",Mr.daterange="daterange",Mr.float4="float4",Mr.float8="float8",Mr.int2="int2",Mr.int4="int4",Mr.int4range="int4range",Mr.int8="int8",Mr.int8range="int8range",Mr.json="json",Mr.jsonb="jsonb",Mr.money="money",Mr.numeric="numeric",Mr.oid="oid",Mr.reltime="reltime",Mr.text="text",Mr.time="time",Mr.timestamp="timestamp",Mr.timestamptz="timestamptz",Mr.timetz="timetz",Mr.tsrange="tsrange",Mr.tstzrange="tstzrange";const Vr=(e,t,s={})=>{var r;const a=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce(((s,r)=>(s[r]=qr(r,e,t,a),s)),{})},qr=(e,t,s,r)=>{const a=t.find((t=>t.name===e)),i=null==a?void 0:a.type,n=s[e];return i&&!r.includes(i)?zr(i,n):Br(n)},zr=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return Wr(t,s)}switch(e){case Lr.bool:return Zr(t);case Lr.float4:case Lr.float8:case Lr.int2:case Lr.int4:case Lr.int8:case Lr.numeric:case Lr.oid:return Hr(t);case Lr.json:case Lr.jsonb:return Kr(t);case Lr.timestamp:return Gr(t);case Lr.abstime:case Lr.date:case Lr.daterange:case Lr.int4range:case Lr.int8range:case Lr.money:case Lr.reltime:case Lr.text:case Lr.time:case Lr.timestamptz:case Lr.timetz:case Lr.tsrange:case Lr.tstzrange:default:return Br(t)}},Br=e=>e,Zr=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Hr=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Kr=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Wr=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const i=e.slice(1,s);try{r=JSON.parse("["+i+"]")}catch(a){r=i?i.split(","):[]}return r.map((e=>zr(t,e)))}return e},Gr=e=>"string"==typeof e?e.replace(" ","T"):e,Jr=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class Xr{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Yr,Qr,ea,ta,sa,ra,aa,ia;(Qr=Yr||(Yr={})).SYNC="sync",Qr.JOIN="join",Qr.LEAVE="leave";class na{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},(e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=na.syncState(this.state,e,t,s),this.pendingDiffs.forEach((e=>{this.state=na.syncDiff(this.state,e,t,s)})),this.pendingDiffs=[],r()})),this.channel._on(s.diff,{},(e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=na.syncDiff(this.state,e,t,s),r())})),this.onJoin(((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})})),this.onLeave(((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,s,r){const a=this.cloneDeep(e),i=this.transformState(t),n={},o={};return this.map(a,((e,t)=>{i[e]||(o[e]=t)})),this.map(i,((e,t)=>{const s=a[e];if(s){const r=t.map((e=>e.presence_ref)),a=s.map((e=>e.presence_ref)),i=t.filter((e=>a.indexOf(e.presence_ref)<0)),l=s.filter((e=>r.indexOf(e.presence_ref)<0));i.length>0&&(n[e]=i),l.length>0&&(o[e]=l)}else n[e]=t})),this.syncDiff(a,{joins:n,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:a,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(a,((t,r)=>{var a;const i=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=this.cloneDeep(r),i.length>0){const s=e[t].map((e=>e.presence_ref)),r=i.filter((e=>s.indexOf(e.presence_ref)<0));e[t].unshift(...r)}s(t,i,r)})),this.map(i,((t,s)=>{let a=e[t];if(!a)return;const i=s.map((e=>e.presence_ref));a=a.filter((e=>i.indexOf(e.presence_ref)<0)),e[t]=a,r(t,a,s),0===a.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((s=>t(s,e[s])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):r,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(ta=ea||(ea={})).ALL="*",ta.INSERT="INSERT",ta.UPDATE="UPDATE",ta.DELETE="DELETE",(ra=sa||(sa={})).BROADCAST="broadcast",ra.PRESENCE="presence",ra.POSTGRES_CHANGES="postgres_changes",ra.SYSTEM="system",(ia=aa||(aa={})).SUBSCRIBED="SUBSCRIBED",ia.TIMED_OUT="TIMED_OUT",ia.CLOSED="CLOSED",ia.CHANNEL_ERROR="CHANNEL_ERROR";class oa{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Pr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Xr(this,Rr.join,this.params,this.timeout),this.rejoinTimer=new Fr((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=Pr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Pr.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Pr.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Pr.errored,this.rejoinTimer.scheduleTimeout())})),this._on(Rr.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new na(this),this.broadcastEndpointURL=Jr(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:a,presence:i,private:n}}=this.params;this._onError((t=>null==e?void 0:e(aa.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(aa.CLOSED)));const o={},l={broadcast:a,presence:i,postgres_changes:null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map((e=>e.filter)))&&void 0!==r?r:[],private:n};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(t=>h(this,[t],(function*({postgres_changes:t}){var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,a=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,i=[];for(let s=0;s<a;s++){const a=r[s],{filter:{event:n,schema:o,table:l,filter:c}}=a,d=t&&t[s];if(!d||d.event!==n||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=Pr.errored,void(null==e||e(aa.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},a),{id:d.id}))}return this.bindings.postgres_changes=i,void(e&&e(aa.SUBSCRIBED))}null==e||e(aa.SUBSCRIBED)})))).receive("error",(t=>{this.state=Pr.errored,null==e||e(aa.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(aa.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}track(e){return h(this,arguments,(function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}))}untrack(){return h(this,arguments,(function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)}))}on(e,t,s){return this._on(e,t,s)}send(e){return h(this,arguments,(function*(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise((s=>{var r,a,i;const n=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(a=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===a?void 0:a.broadcast)||void 0===i?void 0:i.ack)||s("ok"),n.receive("ok",(()=>s("ok"))),n.receive("error",(()=>s("error"))),n.receive("timeout",(()=>s("timed out")))}));{const{event:i,payload:n}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:n,private:this.private}]})};try{const e=yield this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return yield null===(r=e.body)||void 0===r?void 0:r.cancel(),e.ok?"ok":"error"}catch(a){return"AbortError"===a.name?"timed out":"error"}}}))}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Pr.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Rr.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise((s=>{const r=new Xr(this,Rr.leave,{},e);r.receive("ok",(()=>{t(),s("ok")})).receive("timeout",(()=>{t(),s("timed out")})).receive("error",(()=>{s("error")})),r.send(),this._canPush()||r.trigger("ok",{})}))}teardown(){this.pushBuffer.forEach((e=>e.destroy())),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}_fetchWithTimeout(e,t,s){return h(this,null,(function*(){const r=new AbortController,a=setTimeout((()=>r.abort()),s),i=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(a),i}))}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Xr(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,a;const i=e.toLocaleLowerCase(),{close:n,error:o,leave:l,join:c}=Rr;if(s&&[n,o,l,c].indexOf(i)>=0&&s!==this._joinRef())return;let d=this._onMessage(i,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter((e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===i})).map((e=>e.callback(d,s))):null===(a=this.bindings[i])||void 0===a||a.filter((e=>{var s,r,a,n,o,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,n=null===(s=e.filter)||void 0===s?void 0:s.event;return i&&(null===(r=t.ids)||void 0===r?void 0:r.includes(i))&&("*"===n||(null==n?void 0:n.toLocaleLowerCase())===(null===(a=t.data)||void 0===a?void 0:a.type.toLocaleLowerCase()))}{const s=null===(o=null===(n=null==e?void 0:e.filter)||void 0===n?void 0:n.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i})).map((e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:a,errors:i}=e,n={schema:t,table:s,commit_timestamp:r,eventType:a,new:{},old:{},errors:i};d=Object.assign(Object.assign({},n),this._getPayloadRecords(e))}e.callback(d,s)}))}_isClosed(){return this.state===Pr.closed}_isJoined(){return this.state===Pr.joined}_isJoining(){return this.state===Pr.joining}_isLeaving(){return this.state===Pr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),a={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(a):this.bindings[r]=[a],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter((e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&oa.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Rr.close,{},e)}_onError(e){this._on(Rr.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Pr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Vr(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Vr(e.columns,e.old_record)),t}}const la=()=>{};class ca{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=Cr,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=la,this.ref=0,this.logger=la,this.conn=null,this.sendBuffer=[],this.serializer=new Ur,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>_s((()=>h(this,null,(function*(){const{default:e}=yield Promise.resolve().then((()=>Bs));return{default:e}}))),void 0,import.meta.url).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${Ir.websocket}`,this.httpEndpoint=Jr(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Fr((()=>h(this,null,(function*(){this.disconnect(),this.connect()}))),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Sr),this.transport){const e="undefined"!=typeof window&&this.transport===window.WebSocket;return this.conn=e?new this.transport(this.endpointURL()):new this.transport(this.endpointURL(),void 0,{headers:this.headers}),void this.setupConnection()}this.conn=new da(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach((e=>e.teardown())))}getChannels(){return this.channels}removeChannel(e){return h(this,null,(function*(){const t=yield e.unsubscribe();return this.channels=this.channels.filter((t=>t._joinRef!==e._joinRef)),0===this.channels.length&&this.disconnect(),t}))}removeAllChannels(){return h(this,null,(function*(){const e=yield Promise.all(this.channels.map((e=>e.unsubscribe())));return this.channels=[],this.disconnect(),e}))}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Er.connecting:return $r.Connecting;case Er.open:return $r.Open;case Er.closing:return $r.Closing;default:return $r.Closed}}isConnected(){return this.connectionState()===$r.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find((e=>e.topic===s));if(r)return r;{const s=new oa(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:a}=e,i=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${s} (${a})`,r),this.isConnected()?i():this.sendBuffer.push(i)}setAuth(e=null){return h(this,null,(function*(){let t=e||this.accessToken&&(yield this.accessToken())||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t,version:this.headers&&this.headers["X-Client-Info"]}),e.joinedOnce&&e._isJoined()&&e._push(Rr.access_token,{access_token:t})})))}))}sendHeartbeat(){return h(this,null,(function*(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),yield this.setAuth()}else this.heartbeatCallback("disconnected")}))}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t.topic!==e.topic))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:r,ref:a}=e;"phoenix"===t&&"phx_reply"===s&&this.heartbeatCallback("ok"==e.payload.status?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${t} ${s} ${a&&"("+a+")"||""}`,r),Array.from(this.channels).filter((e=>e._isMember(t))).forEach((e=>e._trigger(s,r,a))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(Rr.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class da{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Er.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class ua extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ha(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class ma extends ua{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class pa extends ua{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var fa=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const xa=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>_s((()=>h(void 0,null,(function*(){const{default:e}=yield Promise.resolve().then((()=>Bs));return{default:e}}))),void 0,import.meta.url).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},ga=e=>{if(Array.isArray(e))return e.map((e=>ga(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,s])=>{const r=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[r]=ga(s)})),t};var va=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const ya=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ba=(e,t,s)=>va(void 0,void 0,void 0,(function*(){const r=yield fa(void 0,void 0,void 0,(function*(){return"undefined"==typeof Response?(yield _s((()=>Promise.resolve().then((()=>Bs))),void 0,import.meta.url)).Response:Response}));e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then((s=>{t(new ma(ya(s),e.status||500))})).catch((e=>{t(new pa(ya(e),e))})):t(new pa(ya(e),e))}));function wa(e,t,s,r,a,i){return va(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{e(s,((e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),r&&(a.body=JSON.stringify(r)),Object.assign(Object.assign({},a),s))})(t,r,a,i)).then((e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()})).then((e=>n(e))).catch((e=>ba(e,o,r)))}))}))}function ja(e,t,s,r){return va(this,void 0,void 0,(function*(){return wa(e,"GET",t,s,r)}))}function _a(e,t,s,r,a){return va(this,void 0,void 0,(function*(){return wa(e,"POST",t,r,a,s)}))}function Na(e,t,s,r,a){return va(this,void 0,void 0,(function*(){return wa(e,"DELETE",t,r,a,s)}))}var ka=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const Sa={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ca={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ea{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=xa(r)}uploadOrUpdate(e,t,s,r){return ka(this,void 0,void 0,(function*(){try{let a;const i=Object.assign(Object.assign({},Ca),r);let n=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const o=i.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(a=new FormData,a.append("cacheControl",i.cacheControl),o&&a.append("metadata",this.encodeMetadata(o)),a.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(a=s,a.append("cacheControl",i.cacheControl),o&&a.append("metadata",this.encodeMetadata(o))):(a=s,n["cache-control"]=`max-age=${i.cacheControl}`,n["content-type"]=i.contentType,o&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(n=Object.assign(Object.assign({},n),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:a,headers:n},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{})),u=yield d.json();if(d.ok)return{data:{path:l,id:u.Id,fullPath:u.Key},error:null};return{data:null,error:u}}catch(a){if(ha(a))return{data:null,error:a};throw a}}))}upload(e,t,s){return ka(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,s)}))}uploadToSignedUrl(e,t,s,r){return ka(this,void 0,void 0,(function*(){const a=this._removeEmptyFolders(e),i=this._getFinalPath(a),n=new URL(this.url+`/object/upload/sign/${i}`);n.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Ca.upsert},r),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);const o=yield this.fetch(n.toString(),{method:"PUT",body:e,headers:i}),l=yield o.json();if(o.ok)return{data:{path:a,fullPath:l.Key},error:null};return{data:null,error:l}}catch(o){if(ha(o))return{data:null,error:o};throw o}}))}createSignedUploadUrl(e,t){return ka(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const a=yield _a(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),i=new URL(this.url+a.url),n=i.searchParams.get("token");if(!n)throw new ua("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:n},error:null}}catch(s){if(ha(s))return{data:null,error:s};throw s}}))}update(e,t,s){return ka(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,s)}))}move(e,t,s){return ka(this,void 0,void 0,(function*(){try{return{data:yield _a(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(ha(r))return{data:null,error:r};throw r}}))}copy(e,t,s){return ka(this,void 0,void 0,(function*(){try{return{data:{path:(yield _a(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(ha(r))return{data:null,error:r};throw r}}))}createSignedUrl(e,t,s){return ka(this,void 0,void 0,(function*(){try{let r=this._getFinalPath(e),a=yield _a(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${i}`)},{data:a,error:null}}catch(r){if(ha(r))return{data:null,error:r};throw r}}))}createSignedUrls(e,t,s){return ka(this,void 0,void 0,(function*(){try{const r=yield _a(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${a}`):null}))),error:null}}catch(r){if(ha(r))return{data:null,error:r};throw r}}))}download(e,t){return ka(this,void 0,void 0,(function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),a=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield ja(this.fetch,`${this.url}/${s}/${t}${a}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(i){if(ha(i))return{data:null,error:i};throw i}}))}info(e){return ka(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield ja(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ga(e),error:null}}catch(s){if(ha(s))return{data:null,error:s};throw s}}))}exists(e){return ka(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return va(this,void 0,void 0,(function*(){return wa(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(ha(s)&&s instanceof pa){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}}))}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],a=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==a&&r.push(a);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==n&&r.push(n);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${s}${o}`)}}}remove(e){return ka(this,void 0,void 0,(function*(){try{return{data:yield Na(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ha(t))return{data:null,error:t};throw t}}))}list(e,t,s){return ka(this,void 0,void 0,(function*(){try{const r=Object.assign(Object.assign(Object.assign({},Sa),t),{prefix:e||""});return{data:yield _a(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(ha(r))return{data:null,error:r};throw r}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ta={"X-Client-Info":"storage-js/2.7.1"};var Pa=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};class Aa{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Ta),t),this.fetch=xa(s)}listBuckets(){return Pa(this,void 0,void 0,(function*(){try{return{data:yield ja(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ha(e))return{data:null,error:e};throw e}}))}getBucket(e){return Pa(this,void 0,void 0,(function*(){try{return{data:yield ja(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ha(t))return{data:null,error:t};throw t}}))}createBucket(e,t={public:!1}){return Pa(this,void 0,void 0,(function*(){try{return{data:yield _a(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(ha(s))return{data:null,error:s};throw s}}))}updateBucket(e,t){return Pa(this,void 0,void 0,(function*(){try{const s=yield function(e,t,s,r,a){return va(this,void 0,void 0,(function*(){return wa(e,"PUT",t,r,a,s)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(s){if(ha(s))return{data:null,error:s};throw s}}))}emptyBucket(e){return Pa(this,void 0,void 0,(function*(){try{return{data:yield _a(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ha(t))return{data:null,error:t};throw t}}))}deleteBucket(e){return Pa(this,void 0,void 0,(function*(){try{return{data:yield Na(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ha(t))return{data:null,error:t};throw t}}))}}class Ra extends Aa{constructor(e,t={},s){super(e,t,s)}from(e){return new Ea(this.url,this.headers,e,this.fetch)}}let Oa="";Oa="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Ia={headers:{"X-Client-Info":`supabase-js-${Oa}/2.50.0`}},$a={schema:"public"},Da={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},La={};var Ma=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const Ua=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?Fs:fetch),(...e)=>t(...e)})(s),a="undefined"==typeof Headers?Vs:Headers;return(s,i)=>Ma(void 0,void 0,void 0,(function*(){var n;const o=null!==(n=yield t())&&void 0!==n?n:e;let l=new a(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},i),{headers:l}))}))};var Fa=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const Va="2.70.0",qa=3e4,za=9e4,Ba={"X-Client-Info":`gotrue-js/${Va}`},Za="X-Supabase-Api-Version",Ha={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Ka=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Wa extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Ga(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Ja extends Wa{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Xa extends Wa{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ya extends Wa{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Qa extends Ya{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ei extends Ya{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ti extends Ya{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class si extends Ya{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ri extends Ya{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ai extends Ya{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ii(e){return Ga(e)&&"AuthRetryableFetchError"===e.name}class ni extends Ya{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class oi extends Ya{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const li="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ci=" \t\n\r=".split(""),di=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<ci.length;t+=1)e[ci[t].charCodeAt(0)]=-2;for(let t=0;t<li.length;t+=1)e[li[t].charCodeAt(0)]=t;return e})();function ui(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(li[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(li[e]),t.queuedBits-=6}}function hi(e,t,s){const r=di[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function mi(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let n=0;n<e.length;n+=1)hi(e.charCodeAt(n),a,i);return t.join("")}function pi(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function fi(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let a=0;a<e.length;a+=1)hi(e.charCodeAt(a),s,r);return new Uint8Array(t)}function xi(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}pi(r,t)}}(e,(e=>t.push(e))),new Uint8Array(t)}function gi(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach((e=>ui(e,s,r))),ui(null,s,r),t.join("")}const vi=()=>"undefined"!=typeof window&&"undefined"!=typeof document,yi={tested:!1,writable:!1},bi=()=>{if(!vi())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(yi.tested)return yi.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),yi.tested=!0,yi.writable=!0}catch(t){yi.tested=!0,yi.writable=!1}return yi.writable};const wi=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>_s((()=>h(void 0,null,(function*(){const{default:e}=yield Promise.resolve().then((()=>Bs));return{default:e}}))),void 0,import.meta.url).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},ji=(e,t,s)=>h(void 0,null,(function*(){yield e.setItem(t,JSON.stringify(s))})),_i=(e,t)=>h(void 0,null,(function*(){const s=yield e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(r){return s}})),Ni=(e,t)=>h(void 0,null,(function*(){yield e.removeItem(t)}));class ki{constructor(){this.promise=new ki.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function Si(e){const t=e.split(".");if(3!==t.length)throw new oi("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Ka.test(t[s]))throw new oi("JWT not in base64url format");return{header:JSON.parse(mi(t[0])),payload:JSON.parse(mi(t[1])),signature:fi(t[2]),raw:{header:t[0],payload:t[1]}}}function Ci(e){return("0"+e.toString(16)).substr(-2)}function Ei(e){return h(this,null,(function*(){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=yield function(e){return h(this,null,(function*(){const t=(new TextEncoder).encode(e),s=yield crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map((e=>String.fromCharCode(e))).join("")}))}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}))}function Ti(e,t,s=!1){return h(this,null,(function*(){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Ci).join("")}();let a=r;s&&(a+="/PASSWORD_RECOVERY"),yield ji(e,`${t}-code-verifier`,a);const i=yield Ei(r);return[i,r===i?"plain":"s256"]}))}ki.promiseConstructor=Promise;const Pi=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Ai=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ri(e){if(!Ai.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}const Oi=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ii=[502,503,504];function $i(e){return h(this,null,(function*(){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new ai(Oi(e),0);if(Ii.includes(e.status))throw new ai(Oi(e),e.status);let r,a;try{r=yield e.json()}catch(n){throw new Xa(Oi(n),n)}const i=function(e){const t=e.headers.get(Za);if(!t)return null;if(!t.match(Pi))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(n){return null}}(e);if(i&&i.getTime()>=Ha.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?a=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(a=r.error_code),a){if("weak_password"===a)throw new ni(Oi(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===a)throw new Qa}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new ni(Oi(r),e.status,r.weak_password.reasons);throw new Ja(Oi(r),e.status||500,a)}))}function Di(e,t,s,r){return h(this,null,(function*(){var a;const i=Object.assign({},null==r?void 0:r.headers);i[Za]||(i[Za]=Ha.name),(null==r?void 0:r.jwt)&&(i.Authorization=`Bearer ${r.jwt}`);const n=null!==(a=null==r?void 0:r.query)&&void 0!==a?a:{};(null==r?void 0:r.redirectTo)&&(n.redirect_to=r.redirectTo);const o=Object.keys(n).length?"?"+new URLSearchParams(n).toString():"",l=yield function(e,t,s,r,a,i){return h(this,null,(function*(){const n=((e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))})(t,r,a,i);let o;try{o=yield e(s,Object.assign({},n))}catch(l){throw console.error(l),new ai(Oi(l),0)}if(o.ok||(yield $i(o)),null==r?void 0:r.noResolveJson)return o;try{return yield o.json()}catch(l){yield $i(l)}}))}(e,t,s+o,{headers:i,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}))}function Li(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Mi(e){const t=Li(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function Ui(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Fi(e){return{data:e,error:null}}function Vi(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i}=e,n=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i},user:Object.assign({},n)},error:null}}function qi(e){return e}const zi=["global","local","others"];class Bi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=wi(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e){return h(this,arguments,(function*(e,t=zi[0]){if(zi.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${zi.join(", ")}`);try{return yield Di(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ga(s))return{data:null,error:s};throw s}}))}inviteUserByEmail(e){return h(this,arguments,(function*(e,t={}){try{return yield Di(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ui})}catch(s){if(Ga(s))return{data:{user:null},error:s};throw s}}))}generateLink(e){return h(this,null,(function*(){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),yield Di(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:Vi,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Ga(t))return{data:{properties:null,user:null},error:t};throw t}}))}createUser(e){return h(this,null,(function*(){try{return yield Di(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ui})}catch(t){if(Ga(t))return{data:{user:null},error:t};throw t}}))}listUsers(e){return h(this,null,(function*(){var t,s,r,a,i,n,o;try{const l={nextPage:null,lastPage:0,total:0},c=yield Di(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:qi});if(c.error)throw c.error;const d=yield c.json(),u=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(o=null===(n=c.headers.get("link"))||void 0===n?void 0:n.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t})),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Ga(l))return{data:{users:[]},error:l};throw l}}))}getUserById(e){return h(this,null,(function*(){Ri(e);try{return yield Di(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ui})}catch(t){if(Ga(t))return{data:{user:null},error:t};throw t}}))}updateUserById(e,t){return h(this,null,(function*(){Ri(e);try{return yield Di(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ui})}catch(s){if(Ga(s))return{data:{user:null},error:s};throw s}}))}deleteUser(e,t=!1){return h(this,null,(function*(){Ri(e);try{return yield Di(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ui})}catch(s){if(Ga(s))return{data:{user:null},error:s};throw s}}))}_listFactors(e){return h(this,null,(function*(){Ri(e.userId);try{const{data:t,error:s}=yield Di(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(Ga(t))return{data:null,error:t};throw t}}))}_deleteFactor(e){return h(this,null,(function*(){Ri(e.userId),Ri(e.id);try{return{data:yield Di(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ga(t))return{data:null,error:t};throw t}}))}}const Zi={getItem:e=>bi()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{bi()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{bi()&&globalThis.localStorage.removeItem(e)}};function Hi(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Ki=!!(globalThis&&bi()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Wi extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Gi extends Wi{}function Ji(e,t,s){return h(this,null,(function*(){Ki&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout((()=>{r.abort(),Ki&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),yield Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},(r=>h(this,null,(function*(){if(!r){if(0===t)throw Ki&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Gi(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Ki)try{const e=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield s()}Ki&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return yield s()}finally{Ki&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))))))}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Xi={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ba,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function Yi(e,t,s){return h(this,null,(function*(){return yield s()}))}class Qi{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Qi.nextInstanceID,Qi.nextInstanceID+=1,this.instanceID>0&&vi()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Xi),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Bi({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=wi(r.fetch),this.lock=r.lock||Yi,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:vi()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Ji:this.lock=Yi,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:bi()?this.storage=Zi:(this.memoryStorage={},this.storage=Hi(this.memoryStorage)):(this.memoryStorage={},this.storage=Hi(this.memoryStorage)),vi()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",(e=>h(this,null,(function*(){this._debug("received broadcast notification from other tab or client",e),yield this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Va}) ${(new Date).toISOString()}`,...e),this}initialize(){return h(this,null,(function*(){return this.initializePromise||(this.initializePromise=(()=>h(this,null,(function*(){return yield this._acquireLock(-1,(()=>h(this,null,(function*(){return yield this._initialize()}))))})))()),yield this.initializePromise}))}_initialize(){return h(this,null,(function*(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach(((e,s)=>{t[s]=e}))}catch(r){}return s.searchParams.forEach(((e,s)=>{t[s]=e})),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":(yield this._isPKCECallback(t))&&(s="pkce"),vi()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:a}=yield this._getSessionFromURL(t,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),function(e){return Ga(e)&&"AuthImplicitGrantRedirectError"===e.name}(a)){const t=null===(e=a.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:a}}return yield this._removeSession(),{error:a}}const{session:i,redirectType:n}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),yield this._saveSession(i),setTimeout((()=>h(this,null,(function*(){"recovery"===n?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",i):yield this._notifyAllSubscribers("SIGNED_IN",i)}))),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return Ga(t)?{error:t}:{error:new Xa("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}}))}signInAnonymously(e){return h(this,null,(function*(){var t,s,r;try{const a=yield Di(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:Li}),{data:i,error:n}=a;if(n||!i)return{data:{user:null,session:null},error:n};const o=i.session,l=i.user;return i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(a){if(Ga(a))return{data:{user:null,session:null},error:a};throw a}}))}signUp(e){return h(this,null,(function*(){var t,s,r;try{let a;if("email"in e){const{email:s,password:r,options:i}=e;let n=null,o=null;"pkce"===this.flowType&&([n,o]=yield Ti(this.storage,this.storageKey)),a=yield Di(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:o},xform:Li})}else{if(!("phone"in e))throw new ti("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:n}=e;a=yield Di(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(s=null==n?void 0:n.data)&&void 0!==s?s:{},channel:null!==(r=null==n?void 0:n.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Li})}}const{data:i,error:n}=a;if(n||!i)return{data:{user:null,session:null},error:n};const o=i.session,l=i.user;return i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(a){if(Ga(a))return{data:{user:null,session:null},error:a};throw a}}))}signInWithPassword(e){return h(this,null,(function*(){try{let t;if("email"in e){const{email:s,password:r,options:a}=e;t=yield Di(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:Mi})}else{if(!("phone"in e))throw new ti("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:a}=e;t=yield Di(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:Mi})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new ei}}catch(t){if(Ga(t))return{data:{user:null,session:null},error:t};throw t}}))}signInWithOAuth(e){return h(this,null,(function*(){var t,s,r,a;return yield this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})}))}exchangeCodeForSession(e){return h(this,null,(function*(){return yield this.initializePromise,this._acquireLock(-1,(()=>h(this,null,(function*(){return this._exchangeCodeForSession(e)}))))}))}signInWithWeb3(e){return h(this,null,(function*(){const{chain:t}=e;if("solana"===t)return yield this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}))}signInWithSolana(e){return h(this,null,(function*(){var t,s,r,a,i,n,o,l,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:f,options:x}=e;let g;if(vi())if("object"==typeof h)g=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");g=e.solana}else{if("object"!=typeof h||!(null==x?void 0:x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=h}const v=new URL(null!==(t=null==x?void 0:x.url)&&void 0!==t?t:window.location.href);if("signIn"in g&&g.signIn){const e=yield g.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==x?void 0:x.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in g&&"function"==typeof g.signMessage&&"publicKey"in g&&"object"==typeof g&&g.publicKey&&"toBase58"in g.publicKey&&"function"==typeof g.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${v.host} wants you to sign in with your Solana account:`,g.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(r=null===(s=null==x?void 0:x.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(a=null==x?void 0:x.signInWithSolana)||void 0===a?void 0:a.notBefore)?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...(null===(i=null==x?void 0:x.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...(null===(n=null==x?void 0:x.signInWithSolana)||void 0===n?void 0:n.chainId)?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...(null===(o=null==x?void 0:x.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...(null===(l=null==x?void 0:x.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==x?void 0:x.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...x.signInWithSolana.resources.map((e=>`- ${e}`))]:[]].join("\n");const e=yield g.signMessage((new TextEncoder).encode(m),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:s}=yield Di(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:gi(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Li});if(s)throw s;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new ei}}catch(f){if(Ga(f))return{data:{user:null,session:null},error:f};throw f}}))}_exchangeCodeForSession(e){return h(this,null,(function*(){const t=yield _i(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:a}=yield Di(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Li});if(yield Ni(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:a}):{data:{user:null,session:null,redirectType:null},error:new ei}}catch(a){if(Ga(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}))}signInWithIdToken(e){return h(this,null,(function*(){try{const{options:t,provider:s,token:r,access_token:a,nonce:i}=e,n=yield Di(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:a,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Li}),{data:o,error:l}=n;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new ei}}catch(t){if(Ga(t))return{data:{user:null,session:null},error:t};throw t}}))}signInWithOtp(e){return h(this,null,(function*(){var t,s,r,a,i;try{if("email"in e){const{email:r,options:a}=e;let i=null,n=null;"pkce"===this.flowType&&([i,n]=yield Ti(this.storage,this.storageKey));const{error:o}=yield Di(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},create_user:null===(s=null==a?void 0:a.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:n},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:n,error:o}=yield Di(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(a=null==s?void 0:s.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(i=null==s?void 0:s.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new ti("You must provide either an email or phone number.")}catch(n){if(Ga(n))return{data:{user:null,session:null},error:n};throw n}}))}verifyOtp(e){return h(this,null,(function*(){var t,s;try{let r,a;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:i,error:n}=yield Di(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:r,xform:Li});if(n)throw n;if(!i)throw new Error("An error occurred on token verification.");const o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(yield this._saveSession(o),yield this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(Ga(r))return{data:{user:null,session:null},error:r};throw r}}))}signInWithSSO(e){return h(this,null,(function*(){var t,s,r;try{let a=null,i=null;return"pkce"===this.flowType&&([a,i]=yield Ti(this.storage,this.storageKey)),yield Di(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:i}),headers:this.headers,xform:Fi})}catch(a){if(Ga(a))return{data:null,error:a};throw a}}))}reauthenticate(){return h(this,null,(function*(){return yield this.initializePromise,yield this._acquireLock(-1,(()=>h(this,null,(function*(){return yield this._reauthenticate()}))))}))}_reauthenticate(){return h(this,null,(function*(){try{return yield this._useSession((e=>h(this,null,(function*(){const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Qa;const{error:r}=yield Di(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}}))))}catch(e){if(Ga(e))return{data:{user:null,session:null},error:e};throw e}}))}resend(e){return h(this,null,(function*(){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:a}=e,{error:i}=yield Di(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:s,type:r,options:a}=e,{data:i,error:n}=yield Di(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:n}}throw new ti("You must provide either an email or phone number and a type")}catch(t){if(Ga(t))return{data:{user:null,session:null},error:t};throw t}}))}getSession(){return h(this,null,(function*(){yield this.initializePromise;return yield this._acquireLock(-1,(()=>h(this,null,(function*(){return this._useSession((e=>h(this,null,(function*(){return e}))))}))))}))}_acquireLock(e,t){return h(this,null,(function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(()=>h(this,null,(function*(){return yield e,yield t()})))();return this.pendingInLock.push((()=>h(this,null,(function*(){try{yield s}catch(e){}})))()),s}return yield this.lock(`lock:${this.storageKey}`,e,(()=>h(this,null,(function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((()=>h(this,null,(function*(){try{yield e}catch(t){}})))()),yield e;this.pendingInLock.length;){const e=[...this.pendingInLock];yield Promise.all(e),this.pendingInLock.splice(0,e.length)}return yield e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))))}finally{this._debug("#_acquireLock","end")}}))}_useSession(e){return h(this,null,(function*(){this._debug("#_useSession","begin");try{const t=yield this.__loadSession();return yield e(t)}finally{this._debug("#_useSession","end")}}))}__loadSession(){return h(this,null,(function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=yield _i(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<za;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:a}=yield this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}))}getUser(e){return h(this,null,(function*(){if(e)return yield this._getUser(e);yield this.initializePromise;return yield this._acquireLock(-1,(()=>h(this,null,(function*(){return yield this._getUser()}))))}))}_getUser(e){return h(this,null,(function*(){try{return e?yield Di(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ui}):yield this._useSession((e=>h(this,null,(function*(){var t,s,r;const{data:a,error:i}=e;if(i)throw i;return(null===(t=a.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?yield Di(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:Ui}):{data:{user:null},error:new Qa}}))))}catch(t){if(Ga(t))return function(e){return Ga(e)&&"AuthSessionMissingError"===e.name}(t)&&(yield this._removeSession(),yield Ni(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}))}updateUser(e){return h(this,arguments,(function*(e,t={}){return yield this.initializePromise,yield this._acquireLock(-1,(()=>h(this,null,(function*(){return yield this._updateUser(e,t)}))))}))}_updateUser(e){return h(this,arguments,(function*(e,t={}){try{return yield this._useSession((s=>h(this,null,(function*(){const{data:r,error:a}=s;if(a)throw a;if(!r.session)throw new Qa;const i=r.session;let n=null,o=null;"pkce"===this.flowType&&null!=e.email&&([n,o]=yield Ti(this.storage,this.storageKey));const{data:l,error:c}=yield Di(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:n,code_challenge_method:o}),jwt:i.access_token,xform:Ui});if(c)throw c;return i.user=l.user,yield this._saveSession(i),yield this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}))))}catch(s){if(Ga(s))return{data:{user:null},error:s};throw s}}))}setSession(e){return h(this,null,(function*(){return yield this.initializePromise,yield this._acquireLock(-1,(()=>h(this,null,(function*(){return yield this._setSession(e)}))))}))}_setSession(e){return h(this,null,(function*(){try{if(!e.access_token||!e.refresh_token)throw new Qa;const t=Date.now()/1e3;let s=t,r=!0,a=null;const{payload:i}=Si(e.access_token);if(i.exp&&(s=i.exp,r=s<=t),r){const{session:t,error:s}=yield this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};a=t}else{const{data:r,error:i}=yield this._getUser(e.access_token);if(i)throw i;a={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},yield this._saveSession(a),yield this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(Ga(t))return{data:{session:null,user:null},error:t};throw t}}))}refreshSession(e){return h(this,null,(function*(){return yield this.initializePromise,yield this._acquireLock(-1,(()=>h(this,null,(function*(){return yield this._refreshSession(e)}))))}))}_refreshSession(e){return h(this,null,(function*(){try{return yield this._useSession((t=>h(this,null,(function*(){var s;if(!e){const{data:r,error:a}=t;if(a)throw a;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Qa;const{session:r,error:a}=yield this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))))}catch(t){if(Ga(t))return{data:{user:null,session:null},error:t};throw t}}))}_getSessionFromURL(e,t){return h(this,null,(function*(){try{if(!vi())throw new si("No browser detected.");if(e.error||e.error_description||e.error_code)throw new si(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new ri("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new si("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ri("No code detected.");const{data:t,error:s}=yield this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:a,refresh_token:i,expires_in:n,expires_at:o,token_type:l}=e;if(!(a&&n&&i&&l))throw new si("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(n);let u=c+d;o&&(u=parseInt(o));const h=u-c;1e3*h<=qa&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:f}=yield this._getUser(a);if(f)throw f;const x={provider_token:s,provider_refresh_token:r,access_token:a,expires_in:d,expires_at:u,refresh_token:i,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:e.type},error:null}}catch(s){if(Ga(s))return{data:{session:null,redirectType:null},error:s};throw s}}))}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}_isPKCECallback(e){return h(this,null,(function*(){const t=yield _i(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}))}signOut(){return h(this,arguments,(function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,(()=>h(this,null,(function*(){return yield this._signOut(e)}))))}))}_signOut(){return h(this,arguments,(function*({scope:e}={scope:"global"}){return yield this._useSession((t=>h(this,null,(function*(){var s;const{data:r,error:a}=t;if(a)return{error:a};const i=null===(s=r.session)||void 0===s?void 0:s.access_token;if(i){const{error:t}=yield this.admin.signOut(i,e);if(t&&(!function(e){return Ga(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(yield this._removeSession(),yield Ni(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))))}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(()=>{h(this,null,(function*(){yield this.initializePromise,yield this._acquireLock(-1,(()=>h(this,null,(function*(){this._emitInitialSession(t)}))))}))})(),{data:{subscription:s}}}_emitInitialSession(e){return h(this,null,(function*(){return yield this._useSession((t=>h(this,null,(function*(){var s,r;try{const{data:{session:r},error:a}=t;if(a)throw a;yield null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(a){yield null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}}))))}))}resetPasswordForEmail(e){return h(this,arguments,(function*(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=yield Ti(this.storage,this.storageKey,!0));try{return yield Di(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(Ga(a))return{data:null,error:a};throw a}}))}getUserIdentities(){return h(this,null,(function*(){var e;try{const{data:t,error:s}=yield this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ga(t))return{data:null,error:t};throw t}}))}linkIdentity(e){return h(this,null,(function*(){var t;try{const{data:s,error:r}=yield this._useSession((t=>h(this,null,(function*(){var s,r,a,i,n;const{data:o,error:l}=t;if(l)throw l;const c=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});return yield Di(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(n=null===(i=o.session)||void 0===i?void 0:i.access_token)&&void 0!==n?n:void 0})}))));if(r)throw r;return vi()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(Ga(s))return{data:{provider:e.provider,url:null},error:s};throw s}}))}unlinkIdentity(e){return h(this,null,(function*(){try{return yield this._useSession((t=>h(this,null,(function*(){var s,r;const{data:a,error:i}=t;if(i)throw i;return yield Di(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})}))))}catch(t){if(Ga(t))return{data:null,error:t};throw t}}))}_refreshAccessToken(e){return h(this,null,(function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return yield function(e,t){return new Promise(((s,r)=>{(()=>{h(this,null,(function*(){for(let i=0;i<1/0;i++)try{const r=yield e(i);if(!t(i,null,r))return void s(r)}catch(a){if(!t(i,a))return void r(a)}}))})()}))}((s=>h(this,null,(function*(){return s>0&&(yield function(e){return h(this,null,(function*(){return yield new Promise((t=>{setTimeout((()=>t(null)),e)}))}))}(200*Math.pow(2,s-1))),this._debug(t,"refreshing attempt",s),yield Di(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Li})}))),((e,t)=>{const r=200*Math.pow(2,e);return t&&ii(t)&&Date.now()+r-s<qa}))}catch(s){if(this._debug(t,"error",s),Ga(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}))}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return h(this,null,(function*(){const s=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),vi()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}))}_recoverAndRefresh(){return h(this,null,(function*(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=yield _i(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s))return this._debug(t,"session is not valid"),void(null!==s&&(yield this._removeSession()));const r=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<za;if(this._debug(t,`session has${r?"":" not"} expired with margin of 90000s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=yield this._callRefreshToken(s.refresh_token);e&&(console.error(e),ii(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return this._debug(t,"error",s),void console.error(s)}finally{this._debug(t,"end")}}))}_callRefreshToken(e){return h(this,null,(function*(){var t,s;if(!e)throw new Qa;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new ki;const{data:t,error:s}=yield this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Qa;yield this._saveSession(t.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(a){if(this._debug(r,"error",a),Ga(a)){const e={session:null,error:a};return ii(a)||(yield this._removeSession()),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(r,"end")}}))}_notifyAllSubscribers(e,t,s=!0){return h(this,null,(function*(){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],a=Array.from(this.stateChangeEmitters.values()).map((s=>h(this,null,(function*(){try{yield s.callback(e,t)}catch(a){r.push(a)}}))));if(yield Promise.all(a),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}))}_saveSession(e){return h(this,null,(function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,yield ji(this.storage,this.storageKey,e)}))}_removeSession(){return h(this,null,(function*(){this._debug("#_removeSession()"),yield Ni(this.storage,this.storageKey),yield this._notifyAllSubscribers("SIGNED_OUT",null)}))}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&vi()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return h(this,null,(function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),qa);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((()=>h(this,null,(function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}))),0)}))}_stopAutoRefresh(){return h(this,null,(function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}))}startAutoRefresh(){return h(this,null,(function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()}))}stopAutoRefresh(){return h(this,null,(function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()}))}_autoRefreshTokenTick(){return h(this,null,(function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,(()=>h(this,null,(function*(){try{const t=Date.now();try{return yield this._useSession((e=>h(this,null,(function*(){const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/qa);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&(yield this._callRefreshToken(s.refresh_token))}))))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))))}catch(e){if(!(e.isAcquireTimeout||e instanceof Wi))throw e;this._debug("auto refresh token tick lock not available")}}))}_handleVisibilityChange(){return h(this,null,(function*(){if(this._debug("#_handleVisibilityChange()"),!vi()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>h(this,null,(function*(){return yield this._onVisibilityChanged(!1)})),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}))}_onVisibilityChanged(e){return h(this,null,(function*(){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,(()=>h(this,null,(function*(){"visible"===document.visibilityState?yield this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}))}_getUrlForProvider(e,t,s){return h(this,null,(function*(){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=yield Ti(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}))}_unenroll(e){return h(this,null,(function*(){try{return yield this._useSession((t=>h(this,null,(function*(){var s;const{data:r,error:a}=t;return a?{data:null,error:a}:yield Di(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))))}catch(t){if(Ga(t))return{data:null,error:t};throw t}}))}_enroll(e){return h(this,null,(function*(){try{return yield this._useSession((t=>h(this,null,(function*(){var s,r;const{data:a,error:i}=t;if(i)return{data:null,error:i};const n=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=yield Di(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:null===(s=null==a?void 0:a.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))))}catch(t){if(Ga(t))return{data:null,error:t};throw t}}))}_verify(e){return h(this,null,(function*(){return this._acquireLock(-1,(()=>h(this,null,(function*(){try{return yield this._useSession((t=>h(this,null,(function*(){var s;const{data:r,error:a}=t;if(a)return{data:null,error:a};const{data:i,error:n}=yield Di(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return n?{data:null,error:n}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:n})}))))}catch(t){if(Ga(t))return{data:null,error:t};throw t}}))))}))}_challenge(e){return h(this,null,(function*(){return this._acquireLock(-1,(()=>h(this,null,(function*(){try{return yield this._useSession((t=>h(this,null,(function*(){var s;const{data:r,error:a}=t;return a?{data:null,error:a}:yield Di(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))))}catch(t){if(Ga(t))return{data:null,error:t};throw t}}))))}))}_challengeAndVerify(e){return h(this,null,(function*(){const{data:t,error:s}=yield this._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}))}_listFactors(){return h(this,null,(function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),a=s.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:s,totp:r,phone:a},error:null}}))}_getAuthenticatorAssuranceLevel(){return h(this,null,(function*(){return this._acquireLock(-1,(()=>h(this,null,(function*(){return yield this._useSession((e=>h(this,null,(function*(){var t,s;const{data:{session:r},error:a}=e;if(a)return{data:null,error:a};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Si(r.access_token);let n=null;i.aal&&(n=i.aal);let o=n;(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:n,nextLevel:o,currentAuthenticationMethods:i.amr||[]},error:null}}))))}))))}))}fetchJwk(e){return h(this,arguments,(function*(e,t={keys:[]}){let s=t.keys.find((t=>t.kid===e));if(s)return s;if(s=this.jwks.keys.find((t=>t.kid===e)),s&&this.jwks_cached_at+6e5>Date.now())return s;const{data:r,error:a}=yield Di(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;if(!r.keys||0===r.keys.length)throw new oi("JWKS is empty");if(this.jwks=r,this.jwks_cached_at=Date.now(),s=r.keys.find((t=>t.kid===e)),!s)throw new oi("No matching signing key found in JWKS");return s}))}getClaims(e){return h(this,arguments,(function*(e,t={keys:[]}){try{let s=e;if(!s){const{data:e,error:t}=yield this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:a,signature:i,raw:{header:n,payload:o}}=Si(s);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(a.exp),!r.kid||"HS256"===r.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=yield this.getUser(s);if(e)throw e;return{data:{claims:a,header:r,signature:i},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),c=yield this.fetchJwk(r.kid,t),d=yield crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!(yield crypto.subtle.verify(l,d,i,xi(`${n}.${o}`))))throw new oi("Invalid JWT signature");return{data:{claims:a,header:r,signature:i},error:null}}catch(s){if(Ga(s))return{data:null,error:s};throw s}}))}}Qi.nextInstanceID=0;const en=Qi;class tn extends en{constructor(e){super(e)}}var sn=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};class rn{constructor(e,t,s){var r,a,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const n=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(n);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,r;const{db:a,auth:i,realtime:n,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),a),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},d),n),global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:()=>Fa(this,void 0,void 0,(function*(){return""}))};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:$a,realtime:La,auth:Object.assign(Object.assign({},Da),{storageKey:c}),global:Ia});this.storageKey=null!==(r=d.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(a=d.global.headers)&&void 0!==a?a:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=d.auth)&&void 0!==i?i:{},this.headers,d.global.fetch),this.fetch=Ua(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new br(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new As(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ra(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return sn(this,void 0,void 0,(function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:a,flowType:i,lock:n,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new tn({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:i,lock:n,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ca(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}const an="./",nn={url:"https://esvtnnswavfyweokiyrp.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzdnRubnN3YXZmeXdlb2tpeXJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5MjQyNzAsImV4cCI6MjA2NTUwMDI3MH0.4T2rXPOLQ261Cbv6XRbySsg0T1nNNjVR97oPZa18_lA"},on=nn.url,ln=nn.anonKey,cn=new rn(on,ln,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});const dn=Ae.createContext(void 0),un=({children:e})=>{const[t,s]=Ae.useState(null),[r,a]=Ae.useState(null),[i,n]=Ae.useState(!0);Ae.useEffect((()=>{const{data:{subscription:e}}=cn.auth.onAuthStateChange(((e,t)=>{var r;a(t),s(null!=(r=null==t?void 0:t.user)?r:null),n(!1)}));return cn.auth.getSession().then((({data:{session:e}})=>{var t;a(e),s(null!=(t=null==e?void 0:e.user)?t:null),n(!1)})),()=>e.unsubscribe()}),[]);const o={user:t,session:r,loading:i,signIn:(e,t)=>h(void 0,null,(function*(){const{error:s}=yield cn.auth.signInWithPassword({email:e,password:t});return{error:s}})),signUp:(e,t)=>h(void 0,null,(function*(){const s=`${window.location.origin}/`,{error:r}=yield cn.auth.signUp({email:e,password:t,options:{emailRedirectTo:s}});return{error:r}})),signOut:()=>h(void 0,null,(function*(){yield cn.auth.signOut()}))};return m.jsx(dn.Provider,{value:o,children:e})},hn=()=>{const e=Ae.useContext(dn);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},mn=Ae.createContext(void 0),pn=({children:e})=>{const[t,s]=Ae.useState([]),[r,a]=Ae.useState(!0),{user:i}=hn(),{toast:n}=ys(),o=Ae.useCallback((()=>h(void 0,null,(function*(){if(!i)return s([]),void a(!1);a(!0);try{const{data:e,error:t}=yield cn.from("cart_items").select("id, product_id, created_at, products (*)").eq("user_id",i.id).order("created_at",{ascending:!1});if(t)throw t;const r=(e||[]).filter((e=>e.products)).map((e=>c(l({},e),{products:c(l({},e.products),{is_featured:e.products.is_paid_featured||e.products.is_performance_featured})})));s(r)}catch(e){console.error("Error fetching cart items:",e),n({title:"Error",description:"No se pudieron cargar los artículos del carrito",variant:"destructive"})}finally{a(!1)}}))),[i,n]);Ae.useEffect((()=>{i?o():(s([]),a(!1))}),[i,o]);const d=e=>t.some((t=>t.product_id===e)),u=t.reduce(((e,t)=>{var s;return e+((null==(s=t.products)?void 0:s.price)||0)}),0),p={cartItems:t,loading:r,addToCart:e=>h(void 0,null,(function*(){if(i)try{if(d(e))return void n({title:"Producto ya en el carrito"});const{data:t,error:r}=yield cn.from("cart_items").insert({user_id:i.id,product_id:e}).select("id, product_id, created_at, products (*)").single();if(r)throw r;const a=c(l({},t),{products:c(l({},t.products),{is_featured:t.products.is_paid_featured||t.products.is_performance_featured})});s((e=>[a,...e])),n({title:"¡Añadido al carrito!",description:"El producto se ha añadido a tu carrito."})}catch(t){console.error("Error adding to cart:",t),"23505"===t.code?n({title:"Producto ya en el carrito"}):n({title:"Error",description:"No se pudo añadir el producto al carrito.",variant:"destructive"})}else n({title:"Inicia sesión",description:"Debes iniciar sesión para añadir productos al carrito.",variant:"destructive"})})),removeFromCart:e=>h(void 0,null,(function*(){try{const{error:t}=yield cn.from("cart_items").delete().eq("id",e);if(t)throw t;s((t=>t.filter((t=>t.id!==e)))),n({title:"Eliminado del carrito"})}catch(t){console.error("Error removing from cart:",t),n({title:"Error",description:"No se pudo eliminar el producto del carrito.",variant:"destructive"})}})),cartCount:t.length,isProductInCart:d,clearCart:()=>h(void 0,null,(function*(){if(i)try{const{error:e}=yield cn.from("cart_items").delete().eq("user_id",i.id);if(e)throw e;s([])}catch(e){console.error("Error clearing cart:",e),n({title:"Error",description:"No se pudo vaciar el carrito.",variant:"destructive"})}})),total:u};return m.jsx(mn.Provider,{value:p,children:e})},fn=()=>{const e=Ae.useContext(mn);if(void 0===e)throw new Error("useCart must be used within a CartProvider");return e},xn=Le("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function gn(e){var t=e,{className:s,variant:r}=t,a=d(t,["className","variant"]);return m.jsx("div",l({className:Ue(xn({variant:r}),s)},a))}const vn=({onClick:e})=>{const{cartCount:t}=fn();return m.jsxs(Ve,{onClick:e,variant:"ghost",className:"relative text-white hover:bg-white/10 hover:text-white",children:[m.jsx(Lt,{className:"h-5 w-5"}),t>0&&m.jsx(gn,{className:"absolute -top-2 -right-2 h-5 w-5 justify-center p-0 bg-purple-600 text-white border-2 border-gray-900",children:t}),m.jsx("span",{className:"sr-only",children:"Ver carrito"})]})},yn=({activeSection:e,setActiveSection:t,onLogout:s,isAdmin:r,onUserSelect:a})=>{const[i,n]=Ae.useState(!1),[o,l]=Ae.useState(!1),c=function(){const[e,t]=Ae.useState(void 0);return Ae.useEffect((()=>{const e=window.matchMedia("(max-width: 767px)"),s=()=>{t(window.innerWidth<768)};return e.addEventListener("change",s),t(window.innerWidth<768),()=>e.removeEventListener("change",s)}),[]),!!e}(),d=[{id:"products",label:"Productos",icon:Dt},{id:"user-search",label:"Buscar Usuarios",icon:Rt},{id:"chats",label:"Chats",icon:kt},{id:"sales",label:"Ventas",icon:zt},{id:"top-sellers",label:"Top Ventas",icon:Zt},{id:"videos",label:"Videos",icon:Qt},{id:"my-products",label:"Mis Productos",icon:Ct},{id:"my-videos",label:"Mis Videos",icon:Tt},{id:"profile",label:"Perfil",icon:Xt}];r&&d.push({id:"admin",label:"Admin",icon:$t});return m.jsx("nav",{className:"bg-black/90 backdrop-blur-sm border-b border-gray-800 sticky top-0 z-50",children:m.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:m.jsxs("div",{className:"flex justify-between items-center h-16",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:"flex-shrink-0",children:m.jsx("img",{src:"/lovable-uploads/976e1875-6ba2-49f1-93f2-d5287dfdc6e0.png",alt:"ERDEX - Your Digital Product Marketplace",className:"h-10 w-auto drop-shadow-lg hover:scale-105 transition-transform duration-200"})}),!c&&m.jsx("div",{className:"ml-10 flex items-baseline space-x-3",children:d.map((s=>{const r=s.icon;return m.jsxs("button",{onClick:()=>t(s.id),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center gap-1.5 transition-colors "+(e===s.id?"bg-white/20 text-white":"text-gray-300 hover:bg-white/10 hover:text-white"),children:[m.jsx(r,{className:"w-4 h-4"}),s.label]},s.id)}))})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(vn,{onClick:()=>t("cart")}),!c&&m.jsx(ws,{}),c&&m.jsxs(rs,{open:o,onOpenChange:l,children:[m.jsx(as,{asChild:!0,children:m.jsx(Ve,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-white hover:bg-white/10",children:m.jsx(Nt,{className:"w-6 h-6"})})}),m.jsxs(ls,{side:"right",className:"w-80 bg-gray-900/95 border-gray-700 backdrop-blur-sm",children:[m.jsx(cs,{children:m.jsx(ds,{className:"text-white text-left",children:"Menú"})}),m.jsxs("div",{className:"flex flex-col space-y-4 mt-6",children:[m.jsx("div",{className:"space-y-2",children:d.map((s=>{const r=s.icon;return m.jsxs("button",{onClick:()=>{return e=s.id,t(e),void l(!1);var e},className:"w-full text-left px-4 py-3 rounded-lg text-base font-medium flex items-center gap-3 transition-colors "+(e===s.id?"bg-white/20 text-white":"text-gray-300 hover:bg-white/10 hover:text-white"),children:[m.jsx(r,{className:"w-5 h-5"}),s.label]},s.id)}))}),m.jsx("div",{className:"border-t border-gray-700 pt-4 space-y-3",children:m.jsx(ws,{})})]})]})]})]})]})})})},bn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx("div",l({ref:t,className:Ue("rounded-lg border bg-card text-card-foreground shadow-sm",r)},a))}));bn.displayName="Card";const wn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx("div",l({ref:t,className:Ue("flex flex-col space-y-1.5 p-6",r)},a))}));wn.displayName="CardHeader";const jn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx("h3",l({ref:t,className:Ue("text-2xl font-semibold leading-none tracking-tight",r)},a))}));jn.displayName="CardTitle";const _n=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx("p",l({ref:t,className:Ue("text-sm text-muted-foreground",r)},a))}));_n.displayName="CardDescription";const Nn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx("div",l({ref:t,className:Ue("p-6 pt-0",r)},a))}));Nn.displayName="CardContent";const kn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx("div",l({ref:t,className:Ue("flex items-center p-6 pt-0",r)},a))}));kn.displayName="CardFooter";const Sn=Ae.forwardRef(((e,t)=>{var s=e,{className:r,type:a}=s,i=d(s,["className","type"]);return m.jsx("input",l({type:a,className:Ue("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t},i))}));Sn.displayName="Input";var Cn="Avatar",[En,Tn]=_(Cn),[Pn,An]=En(Cn),Rn=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAvatar:r}=s,a=d(s,["__scopeAvatar"]),[i,n]=Ae.useState("idle");return m.jsx(Pn,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:n,children:m.jsx(N.span,c(l({},a),{ref:t}))})}));Rn.displayName=Cn;var On="AvatarImage",In=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAvatar:r,src:a,onLoadingStatusChange:i=()=>{}}=s,n=d(s,["__scopeAvatar","src","onLoadingStatusChange"]),o=An(On,r),u=function(e,t){const[s,r]=Ae.useState("idle");return S((()=>{if(!e)return void r("error");let s=!0;const a=new window.Image,i=e=>()=>{s&&r(e)};return r("loading"),a.onload=i("loaded"),a.onerror=i("error"),a.src=e,t&&(a.referrerPolicy=t),()=>{s=!1}}),[e,t]),s}(a,n.referrerPolicy),h=k((e=>{i(e),o.onImageLoadingStatusChange(e)}));return S((()=>{"idle"!==u&&h(u)}),[u,h]),"loaded"===u?m.jsx(N.img,c(l({},n),{ref:t,src:a})):null}));In.displayName=On;var $n="AvatarFallback",Dn=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAvatar:r,delayMs:a}=s,i=d(s,["__scopeAvatar","delayMs"]),n=An($n,r),[o,u]=Ae.useState(void 0===a);return Ae.useEffect((()=>{if(void 0!==a){const e=window.setTimeout((()=>u(!0)),a);return()=>window.clearTimeout(e)}}),[a]),o&&"loaded"!==n.imageLoadingStatus?m.jsx(N.span,c(l({},i),{ref:t})):null}));Dn.displayName=$n;var Ln=Rn,Mn=In,Un=Dn;const Fn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(Ln,l({ref:t,className:Ue("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r)},a))}));Fn.displayName=Ln.displayName;const Vn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(Mn,l({ref:t,className:Ue("aspect-square h-full w-full",r)},a))}));Vn.displayName=Mn.displayName;const qn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(Un,l({ref:t,className:Ue("flex h-full w-full items-center justify-center rounded-full bg-muted",r)},a))}));qn.displayName=Un.displayName;const zn=U,Bn=F,Zn=Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a}=s,i=d(s,["className","children"]);return m.jsxs(C,c(l({ref:t,className:Ue("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r)},i),{children:[a,m.jsx(E,{asChild:!0,children:m.jsx(et,{className:"h-4 w-4 opacity-50"})})]}))}));Zn.displayName=C.displayName;const Hn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(T,c(l({ref:t,className:Ue("flex cursor-default items-center justify-center py-1",r)},a),{children:m.jsx(st,{className:"h-4 w-4"})}))}));Hn.displayName=T.displayName;const Kn=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(P,c(l({ref:t,className:Ue("flex cursor-default items-center justify-center py-1",r)},a),{children:m.jsx(et,{className:"h-4 w-4"})}))}));Kn.displayName=P.displayName;const Wn=Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a,position:i="popper"}=s,n=d(s,["className","children","position"]);return m.jsx(A,{children:m.jsxs(R,c(l({ref:t,className:Ue("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:i},n),{children:[m.jsx(Hn,{}),m.jsx(O,{className:Ue("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),m.jsx(Kn,{})]}))})}));Wn.displayName=R.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(I,l({ref:t,className:Ue("py-1.5 pl-8 pr-2 text-sm font-semibold",r)},a))})).displayName=I.displayName;const Gn=Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a}=s,i=d(s,["className","children"]);return m.jsxs($,c(l({ref:t,className:Ue("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r)},i),{children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(D,{children:m.jsx(Qe,{className:"h-4 w-4"})})}),m.jsx(L,{children:a})]}))}));Gn.displayName=$.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(M,l({ref:t,className:Ue("-mx-1 my-1 h-px bg-muted",r)},a))})).displayName=M.displayName;const Jn=()=>{const{toast:e}=ys(),t=()=>h(void 0,null,(function*(){try{const{data:e,error:t}=yield cn.from("product_likes").select("product_id").order("created_at",{ascending:!1});if(t)throw t;const s={};null==e||e.forEach((e=>{s[e.product_id]=(s[e.product_id]||0)+1}));const{data:r,error:a}=yield cn.from("products").select("id, sales").eq("status","active").eq("is_free",!1);if(a)throw a;const i=((null==r?void 0:r.map((e=>({id:e.id,score:2*e.sales+(s[e.id]||0)}))))||[]).filter((e=>e.score>0)).sort(((e,t)=>t.score-e.score)).slice(0,10).map((e=>e.id)),{error:n}=yield cn.from("products").update({is_performance_featured:!1}).eq("is_paid_featured",!1);if(n)throw n;if(i.length>0){const{error:e}=yield cn.from("products").update({is_performance_featured:!0}).in("id",i);if(e)throw e}console.log(`Updated ${i.length} performance-featured products based on metrics`)}catch(t){console.error("Error updating featured products:",t),e({title:"Error",description:"No se pudieron actualizar los productos destacados",variant:"destructive"})}}));return Ae.useEffect((()=>{t();const e=setInterval(t,18e5);return()=>clearInterval(e)}),[]),{updateFeaturedProducts:t}},Xn=Object.freeze(Object.defineProperty({__proto__:null,useFeaturedProducts:Jn},Symbol.toStringTag,{value:"Module"})),Yn=w,Qn=x,eo=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(f,l({ref:t,className:Ue("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r)},a))}));eo.displayName=f.displayName;const to=Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a}=s,i=d(s,["className","children"]);return m.jsxs(Qn,{children:[m.jsx(eo,{}),m.jsxs(g,c(l({ref:t,className:Ue("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r)},i),{children:[a,m.jsxs(v,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[m.jsx(ss,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"Close"})]})]}))]})}));to.displayName=g.displayName;const so=e=>{var t=e,{className:s}=t,r=d(t,["className"]);return m.jsx("div",l({className:Ue("flex flex-col space-y-1.5 text-center sm:text-left",s)},r))};so.displayName="DialogHeader";const ro=e=>{var t=e,{className:s}=t,r=d(t,["className"]);return m.jsx("div",l({className:Ue("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s)},r))};ro.displayName="DialogFooter";const ao=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(y,l({ref:t,className:Ue("text-lg font-semibold leading-none tracking-tight",r)},a))}));ao.displayName=y.displayName;const io=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(b,l({ref:t,className:Ue("text-sm text-muted-foreground",r)},a))}));io.displayName=b.displayName;var no=Ae.forwardRef(((e,t)=>m.jsx(N.label,c(l({},e),{ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null==(s=e.onMouseDown)||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}))));no.displayName="Label";var oo=no;const lo=Le("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),co=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(oo,l({ref:t,className:Ue(lo(),r)},a))}));co.displayName=oo.displayName;const uo=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx("textarea",l({className:Ue("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t},a))}));uo.displayName="Textarea";var ho="Checkbox",[mo,po]=_(ho),[fo,xo]=mo(ho),go=Ae.forwardRef(((e,t)=>{const s=e,{__scopeCheckbox:r,name:a,checked:i,defaultChecked:n,required:o,disabled:u,value:h="on",onCheckedChange:p,form:f}=s,x=d(s,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]),[g,v]=Ae.useState(null),y=V(t,(e=>v(e))),b=Ae.useRef(!1),w=!g||(f||!!g.closest("form")),[j=!1,_]=q({prop:i,defaultProp:n,onChange:p}),k=Ae.useRef(j);return Ae.useEffect((()=>{const e=null==g?void 0:g.form;if(e){const t=()=>_(k.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}}),[g,_]),m.jsxs(fo,{scope:r,state:j,disabled:u,children:[m.jsx(N.button,c(l({type:"button",role:"checkbox","aria-checked":wo(j)?"mixed":j,"aria-required":o,"data-state":jo(j),"data-disabled":u?"":void 0,disabled:u,value:h},x),{ref:y,onKeyDown:z(e.onKeyDown,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:z(e.onClick,(e=>{_((e=>!!wo(e)||!e)),w&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())}))})),w&&m.jsx(bo,{control:g,bubbles:!b.current,name:a,value:h,checked:j,required:o,disabled:u,form:f,style:{transform:"translateX(-100%)"},defaultChecked:!wo(n)&&n})]})}));go.displayName=ho;var vo="CheckboxIndicator",yo=Ae.forwardRef(((e,t)=>{const s=e,{__scopeCheckbox:r,forceMount:a}=s,i=d(s,["__scopeCheckbox","forceMount"]),n=xo(vo,r);return m.jsx(B,{present:a||wo(n.state)||!0===n.state,children:m.jsx(N.span,c(l({"data-state":jo(n.state),"data-disabled":n.disabled?"":void 0},i),{ref:t,style:l({pointerEvents:"none"},e.style)}))})}));yo.displayName=vo;var bo=e=>{const t=e,{control:s,checked:r,bubbles:a=!0,defaultChecked:i}=t,n=d(t,["control","checked","bubbles","defaultChecked"]),o=Ae.useRef(null),u=Z(r),h=H(s);Ae.useEffect((()=>{const e=o.current,t=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(t,"checked").set;if(u!==r&&s){const t=new Event("click",{bubbles:a});e.indeterminate=wo(r),s.call(e,!wo(r)&&r),e.dispatchEvent(t)}}),[u,r,a]);const p=Ae.useRef(!wo(r)&&r);return m.jsx("input",c(l({type:"checkbox","aria-hidden":!0,defaultChecked:null!=i?i:p.current},n),{tabIndex:-1,ref:o,style:c(l(l({},e.style),h),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))};function wo(e){return"indeterminate"===e}function jo(e){return wo(e)?"indeterminate":e?"checked":"unchecked"}var _o=go,No=yo;const ko=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(_o,c(l({ref:t,className:Ue("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r)},a),{children:m.jsx(No,{className:Ue("flex items-center justify-center text-current"),children:m.jsx(Qe,{className:"h-4 w-4"})})}))}));ko.displayName=_o.displayName;const So=new class{constructor(){u(this,"credentials"),u(this,"baseUrl"),u(this,"adminEmail","Mr.federex@gmail.com"),this.credentials={clientId:"BAATromM_MagyjyD2ovjAQ9Z_aVdPPbbcVbVkJ6RptlUscltZ0UPHNsvI3d9p08FOIFrSN5lq3xZiiJZe8",clientSecret:"EHxumjQQwHhCk8eYqLnI7N21CRFItjll1RV0Up1B01ZV4ZWZo-ehY7BNOTF0VNiZLsKbWvkEZ_xfmj6_",mode:"live"},this.baseUrl="sandbox"===this.credentials.mode?"https://api.sandbox.paypal.com":"https://api.paypal.com"}getAccessToken(){return h(this,null,(function*(){const e=btoa(`${this.credentials.clientId}:${this.credentials.clientSecret}`),t=yield fetch(`${this.baseUrl}/v1/oauth2/token`,{method:"POST",headers:{Authorization:`Basic ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:"grant_type=client_credentials"});if(!t.ok)throw new Error("Error obteniendo token de acceso");return(yield t.json()).access_token}))}createPaymentOrder(e){return h(this,null,(function*(){try{const t=yield this.getAccessToken(),s={intent:"CAPTURE",purchase_units:[{amount:{currency_code:e.currency,value:e.amount.toFixed(2)},description:e.productName,custom_id:`product_${e.productId}`}],application_context:{return_url:`${window.location.origin}/?payment=success`,cancel_url:`${window.location.origin}/?payment=cancel`,brand_name:"Digital Emporium Genesis Hub",user_action:"PAY_NOW"}},r=yield fetch(`${this.baseUrl}/v2/checkout/orders`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Error creando orden de pago");const a=(yield r.json()).links.find((e=>"approve"===e.rel));return a?a.href:""}catch(t){throw console.error("Error creando orden de pago:",t),t}}))}captureAndProcessPayment(e,t){return h(this,null,(function*(){try{const s=yield this.getAccessToken(),r=yield fetch(`${this.baseUrl}/v2/checkout/orders/${e}/capture`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!r.ok){const e=yield r.json();throw console.error("Error details capturando el pago:",e),new Error("Error capturando el pago del cliente")}const a=yield r.json();if(console.log("Resultado de captura de pago:",a),"COMPLETED"===a.status){const e=t.amount,r=.2*e,i=.8*e;console.log(`Iniciando pago de comisión de ${i.toFixed(2)} USD al vendedor: ${t.sellerEmail}`);const n={sender_batch_header:{sender_batch_id:`payout_batch_${a.id}`,email_subject:"¡Has recibido un pago por tu venta!",email_message:`Has recibido un pago por la venta de tu producto: "${t.productName}".`},items:[{recipient_type:"EMAIL",amount:{value:i.toFixed(2),currency:t.currency},receiver:t.sellerEmail,note:`Pago del 80% por la venta de "${t.productName}" (ID: ${t.productId})`,sender_item_id:`seller_payout_${t.productId}_${Date.now()}`}]},o=yield fetch(`${this.baseUrl}/v1/payments/payouts`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),l=yield o.json();if(!o.ok)throw console.error("Error de PayPal Payouts:",l),new Error(`El pago del cliente fue exitoso, pero falló la transferencia de comisiones al vendedor. Detalles: ${l.message||"Error desconocido"}`);return console.log("Resultado del Payout (envío a vendedor):",l),{paymentId:a.id,status:"completed",adminPayout:r,sellerPayout:i,transactionId:l.batch_header.payout_batch_id||`TXN_${Date.now()}`}}throw new Error("El pago del cliente no se completó correctamente.")}catch(s){throw console.error("Error en el proceso de pago y comisiones:",s),s}}))}},Co=({isOpen:e,onClose:t,product:s,onPaymentSuccess:r})=>{const[a,i]=Ae.useState(!1),[n,o]=Ae.useState("idle"),[l,c]=Ae.useState(null),[d,u]=Ae.useState(null),{toast:p}=ys(),f=()=>{o("idle"),c(null),i(!1),u(null),t()};return m.jsx(Yn,{open:e,onOpenChange:f,children:m.jsxs(to,{className:"sm:max-w-md bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsxs(so,{children:[m.jsx(ao,{className:"text-white",children:"Procesar Pago"}),m.jsx(io,{className:"text-gray-300",children:"Pago seguro con PayPal - División automática de comisiones"})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx(bn,{className:"bg-white/5 border-white/10",children:m.jsxs(Nn,{className:"p-4",children:[m.jsx("h3",{className:"text-white font-medium",children:s.title}),m.jsxs("p",{className:"text-gray-300 text-sm",children:["Por: ",s.seller]}),m.jsxs("p",{className:"text-2xl font-bold text-white mt-2",children:["$",s.price]})]})}),m.jsx(bn,{className:"bg-white/5 border-white/10",children:m.jsxs(Nn,{className:"p-4",children:[m.jsx("h4",{className:"text-white font-medium mb-3",children:"División de Comisiones"}),m.jsxs("div",{className:"space-y-2 text-sm",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-300",children:"Vendedor (80%):"}),m.jsxs("span",{className:"text-green-400 font-medium",children:["$",(.8*s.price).toFixed(2)]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-300",children:"Plataforma (20%):"}),m.jsxs("span",{className:"text-purple-400 font-medium",children:["$",(.2*s.price).toFixed(2)]})]}),m.jsx("div",{className:"border-t border-white/10 pt-2 mt-2",children:m.jsxs("div",{className:"flex justify-between font-medium",children:[m.jsx("span",{className:"text-white",children:"Total:"}),m.jsxs("span",{className:"text-white",children:["$",s.price]})]})})]})]})}),"idle"===n&&m.jsx(Ve,{onClick:()=>h(void 0,null,(function*(){i(!0),o("processing");try{const e={amount:s.price,currency:"USD",sellerEmail:s.paypalEmail,productName:s.title,productId:s.id},t=yield So.createPaymentOrder(e);if(t){const a=new URLSearchParams(t.split("?")[1]).get("token");u(a);const n=window.open(t,"_blank","width=600,height=700"),l=setInterval((()=>h(void 0,null,(function*(){if(null==n?void 0:n.closed){if(clearInterval(l),a)try{const t=yield So.captureAndProcessPayment(a,e);if("completed"!==t.status)throw new Error('El estado del pago no fue "completed"');c(t),o("success"),p({title:"¡Pago y comisiones procesados!",description:`La compra de "${s.title}" y el reparto de comisiones se completaron.`}),r(t)}catch(t){console.error("Error verificando pago y procesando comisiones:",t),o("error");(t.message||"").includes("falló la transferencia de comisiones")?p({title:"¡Atención, Admin!",description:"El pago del cliente fue exitoso, pero la transferencia automática de comisiones al vendedor falló. Revisa la transacción manualmente.",variant:"destructive",duration:1e4}):p({title:"Pago no completado",description:"No se pudo verificar el pago. Si realizaste el pago, contacta soporte.",variant:"destructive"})}else o("error"),p({title:"Pago cancelado",description:"El pago no se completó.",variant:"destructive"});i(!1)}}))),1e3);setTimeout((()=>{clearInterval(l),(null==n?void 0:n.closed)||(o("error"),i(!1),p({title:"Tiempo agotado",description:"El proceso de pago ha expirado.",variant:"destructive"}))}),6e5)}}catch(e){console.error("Error iniciando pago:",e),o("error"),i(!1),p({title:"Error",description:"No se pudo iniciar el proceso de pago",variant:"destructive"})}})),disabled:a,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:a?m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"w-4 h-4 mr-2 animate-spin"}),"Abriendo PayPal..."]}):m.jsxs(m.Fragment,{children:[m.jsx(lt,{className:"w-4 h-4 mr-2"}),"Pagar con PayPal"]})}),"processing"===n&&m.jsxs("div",{className:"text-center py-4",children:[m.jsx(bt,{className:"w-8 h-8 animate-spin text-blue-400 mx-auto mb-2"}),m.jsx("p",{className:"text-white",children:"Verificando pago..."}),m.jsx("p",{className:"text-gray-400 text-sm",children:"Completa el pago en la ventana de PayPal"})]}),"success"===n&&l&&m.jsxs("div",{className:"text-center py-4",children:[m.jsx(at,{className:"w-8 h-8 text-green-400 mx-auto mb-2"}),m.jsx("p",{className:"text-white font-medium",children:"¡Pago y comisiones procesados!"}),m.jsxs("p",{className:"text-gray-300 text-sm",children:["ID Lote Payout: ",l.transactionId]}),m.jsxs("div",{className:"mt-3 text-xs text-gray-400",children:[m.jsxs("p",{children:["Vendedor recibió: $",l.sellerPayout.toFixed(2)]}),m.jsxs("p",{children:["Comisión plataforma: $",l.adminPayout.toFixed(2)]})]}),m.jsx(Ve,{onClick:f,className:"mt-4 w-full",children:"Continuar"})]}),"error"===n&&m.jsxs("div",{className:"text-center py-4",children:[m.jsx(it,{className:"w-8 h-8 text-red-400 mx-auto mb-2"}),m.jsx("p",{className:"text-white font-medium",children:"Pago no completado"}),m.jsx("p",{className:"text-gray-400 text-sm",children:"El pago no se pudo verificar"}),m.jsx(Ve,{onClick:()=>o("idle"),variant:"outline",className:"mt-4 w-full",children:"Reintentar"})]})]})]})})},Eo=({isOpen:e,onClose:t,onCreateProduct:s})=>{const[r,a]=Ae.useState({title:"",description:"",price:"",category:"",paypalEmail:"",productFile:null,productImage:null,previewImages:[],isFree:!1,makeFeatured:!1}),[i,n]=Ae.useState(null),[o,d]=Ae.useState([]),[u,p]=Ae.useState(!1),[f,x]=Ae.useState(!1),[g,v]=Ae.useState(!1),[y,b]=Ae.useState(null),[w,j]=Ae.useState({scanned:!1,safe:!1,scanning:!1}),{user:_}=hn(),{toast:N}=ys(),{scanFile:k,isScanning:S}=(()=>{const[e,t]=Ae.useState(!1),{toast:s}=ys();return{scanFile:e=>h(void 0,null,(function*(){var r,a,i,n,o,l,c,d,u,h,m,p;if(!e)return s({title:"Error",description:"No se ha proporcionado ningún archivo para escanear",variant:"destructive"}),null;t(!0);try{console.log("Iniciando escaneo de malware para:",e.name);const t=yield new Promise((t=>{const s=new FileReader;s.onload=()=>{const e=s.result;t(e.split(",")[1])},s.readAsDataURL(e)})),{data:f,error:x}=yield cn.functions.invoke("scan-malware",{body:{fileName:e.name,fileData:t,fileSize:e.size,fileType:e.type}});if(x)throw console.error("Error en el escaneo:",x),x;if(console.log("Resultado del escaneo:",f),f.threat_detected){const t=(null==(a=null==(r=f.details)?void 0:r.detected_engines)?void 0:a.length)||(null==(i=f.details)?void 0:i.positives)||0,h=(null==(n=f.details)?void 0:n.total)||0,m=(null==(o=f.details)?void 0:o.percentage)||"0",p=(null==(c=null==(l=f.details)?void 0:l.detected_engines)?void 0:c.slice(0,3).map((e=>e.engine)).join(", "))||"múltiples antivirus";s({title:"⚠️ MALWARE DETECTADO",description:`"${e.name}" detectado por ${t}/${h} antivirus (${m}% - ${p}${(null==(u=null==(d=f.details)?void 0:d.detected_engines)?void 0:u.length)>3?"...":""}). Archivo rechazado por seguridad.`,variant:"destructive"})}else{const t=(null==(h=f.details)?void 0:h.total)||0,r=(null==(m=f.details)?void 0:m.positives)||0,a=(null==(p=f.details)?void 0:p.percentage)||"0";let i="";t>0&&(i=r>0?` (${r}/${t} antivirus reportaron detecciones menores - ${a}% - considerado seguro)`:` (verificado por ${t} antivirus - 0% detecciones)`),s({title:"✅ Archivo seguro",description:`"${e.name}" ha pasado el análisis de seguridad${i}.`})}return f}catch(f){return console.error("Error durante el escaneo:",f),s({title:"⚠️ Error en el escaneo",description:"No se pudo verificar el archivo. El archivo será permitido, pero úsalo bajo tu responsabilidad.",variant:"destructive"}),{is_safe:!0,scan_id:`error_${Date.now()}`,threat_detected:!1,scan_date:(new Date).toISOString(),details:{error:"Error en comunicación con servicio de escaneo"}}}finally{t(!1)}})),isScanning:e}})(),C=bs(),E=e=>h(void 0,null,(function*(){if(!_)return null;try{const t=e.name.split(".").pop(),s=`${_.id}/products/${Date.now()}.${t}`,{error:r}=yield cn.storage.from("uploads").upload(s,e);if(r)throw r;const{data:a}=cn.storage.from("uploads").getPublicUrl(s);return a.publicUrl}catch(t){return console.error("Error uploading image:",t),N({title:"Error",description:"No se pudo subir la imagen",variant:"destructive"}),null}})),T=e=>h(void 0,null,(function*(){var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){a((e=>c(l({},e),{productFile:s}))),j({scanned:!1,safe:!1,scanning:!0}),N({title:"🛡️ Escaneando archivo",description:"Verificando que el archivo no contenga malware..."});const e=yield k(s);j(e?{scanned:!0,safe:e.is_safe,scanning:!1}:{scanned:!1,safe:!1,scanning:!1})}})),P=(e,r=!1)=>h(void 0,null,(function*(){const i=c(l({},e),{is_featured:r});console.log("Creating product with featured status:",r);const o=yield s(i);return o.error||(a({title:"",description:"",price:"",category:"",paypalEmail:"",productFile:null,productImage:null,previewImages:[],isFree:!1,makeFeatured:!1}),n(null),d([]),b(null),j({scanned:!1,safe:!1,scanning:!1}),t()),o}));return m.jsxs(m.Fragment,{children:[m.jsx(Yn,{open:e,onOpenChange:t,children:m.jsxs(to,{className:"bg-white/10 backdrop-blur-lg border-white/20 text-white max-w-md max-h-[90vh] overflow-y-auto",children:[m.jsx(so,{children:m.jsx(ao,{className:"text-white",children:"Publicar Nuevo Producto"})}),m.jsxs("form",{onSubmit:e=>h(void 0,null,(function*(){if(e.preventDefault(),!r.productFile||w.scanned&&w.safe){x(!0),N({title:"🤖 Moderando contenido...",description:"Revisando que tu producto cumpla con nuestras políticas."});try{const{data:e,error:t}=yield cn.functions.invoke("moderate-product",{body:JSON.stringify({title:r.title,description:r.description})});if(t)throw new Error(t.message);const{safe:s,reason:a}=e;if(!s)return N({title:"Producto Rechazado",description:a||"Tu producto no cumple con las políticas de contenido.",variant:"destructive",duration:1e4}),void x(!1);N({title:"Moderación Aprobada",description:"Tu producto ha pasado la revisión. Publicando..."})}catch(s){console.error("Error during moderation:",s),N({title:"Error de Moderación",description:"No se pudo verificar el contenido del producto. Se publicará sin revisión automática.",variant:"default"})}finally{x(!1)}p(!0);try{let e=null,a=null,i=[];if(r.productImage&&(e=yield E(r.productImage),!e))return void p(!1);if(r.previewImages.length>0)for(const t of r.previewImages){const e=yield E(t);e&&i.push(e)}if(r.productFile&&(a=yield(t=r.productFile,h(void 0,null,(function*(){if(!_)return null;try{const e=t.name.split(".").pop(),s=`${_.id}/files/${Date.now()}.${e}`,{error:r}=yield cn.storage.from("uploads").upload(s,t);if(r)throw r;const{data:a}=cn.storage.from("uploads").getPublicUrl(s);return a.publicUrl}catch(s){return console.error("Error uploading file:",s),N({title:"Error",description:"No se pudo subir el archivo",variant:"destructive"}),null}}))),!a))return void p(!1);const n={title:r.title,description:r.description,price:r.isFree?0:parseFloat(r.price)||0,category:r.category,paypal_email:r.isFree?null:r.paypalEmail||null,is_free:r.isFree,status:"active",image_url:e,file_url:a,preview_images:i};console.log("Product data prepared:",n),r.makeFeatured?(b(n),v(!0),p(!1)):(yield P(n,!1),p(!1))}catch(s){console.error("Error creating product:",s),p(!1)}var t}else N({title:"Archivo no seguro",description:"El archivo debe pasar el escaneo de seguridad antes de ser publicado",variant:"destructive"})})),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"title",className:"text-white",children:"Título del Producto"}),m.jsx(Sn,{id:"title",value:r.title,onChange:e=>a((t=>c(l({},t),{title:e.target.value}))),className:"bg-white/10 border-white/20 text-white",required:!0,disabled:u})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"description",className:"text-white",children:"Descripción"}),m.jsx(uo,{id:"description",value:r.description,onChange:e=>a((t=>c(l({},t),{description:e.target.value}))),className:"bg-white/10 border-white/20 text-white",rows:3,required:!0,disabled:u})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{className:"text-white",children:"Imagen Principal del Producto"}),r.productImage?m.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx(vt,{className:"w-8 h-8 text-green-400"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-white font-medium",children:r.productImage.name}),m.jsxs("p",{className:"text-gray-400 text-sm",children:[(r.productImage.size/1048576).toFixed(2)," MB"]})]})]}),m.jsx(Ve,{type:"button",variant:"ghost",size:"sm",onClick:()=>{a((e=>c(l({},e),{productImage:null}))),i&&(URL.revokeObjectURL(i),n(null))},className:"text-gray-400 hover:text-white hover:bg-white/20",disabled:u,children:m.jsx(ss,{className:"w-4 h-4"})})]}),i&&m.jsx("div",{className:"mt-2",children:m.jsx("img",{src:i,alt:"Preview",className:"w-full h-32 object-cover rounded"})})]}):m.jsxs("div",{className:"border-2 border-dashed border-white/20 rounded-lg p-6 text-center hover:border-white/30 transition-colors",children:[m.jsx(vt,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),m.jsx("p",{className:"text-gray-400 mb-2",children:"Sube la imagen principal"}),m.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s&&s.type.startsWith("image/")){a((e=>c(l({},e),{productImage:s})));const e=URL.createObjectURL(s);n(e)}},className:"hidden",id:"image-upload",disabled:u}),m.jsx(Ve,{type:"button",variant:"outline",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",onClick:()=>{var e;return null==(e=document.getElementById("image-upload"))?void 0:e.click()},disabled:u,children:"Seleccionar Imagen"})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{className:"text-white",children:"Imágenes de Vista Previa (máx. 5)"}),m.jsxs("div",{className:"border-2 border-dashed border-white/20 rounded-lg p-4 text-center hover:border-white/30 transition-colors",children:[m.jsx(vt,{className:"w-6 h-6 mx-auto mb-2 text-gray-400"}),m.jsx("p",{className:"text-gray-400 mb-2 text-sm",children:"Sube capturas de pantalla o vistas previas del producto"}),m.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]).filter((e=>e.type.startsWith("image/"))).slice(0,5);a((e=>c(l({},e),{previewImages:t})));const s=t.map((e=>URL.createObjectURL(e)));d(s)},className:"hidden",id:"preview-images-upload",disabled:u}),m.jsx(Ve,{type:"button",variant:"outline",size:"sm",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",onClick:()=>{var e;return null==(e=document.getElementById("preview-images-upload"))?void 0:e.click()},disabled:u,children:"Seleccionar Imágenes"})]}),r.previewImages.length>0&&m.jsx("div",{className:"grid grid-cols-2 gap-3 mt-3",children:o.map(((e,t)=>m.jsxs("div",{className:"relative bg-white/10 rounded-lg p-2 border border-white/20",children:[m.jsx("img",{src:e,alt:`Preview ${t+1}`,className:"w-full h-24 object-cover rounded"}),m.jsx(Ve,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{const t=r.previewImages.filter(((t,s)=>s!==e)),s=o.filter(((t,s)=>s!==e));URL.revokeObjectURL(o[e]),a((e=>c(l({},e),{previewImages:t}))),d(s)})(t),className:"absolute top-1 right-1 h-6 w-6 p-0 bg-black/50 text-white hover:bg-black/70",disabled:u,children:m.jsx(ss,{className:"w-3 h-3"})}),m.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:r.previewImages[t].name})]},t)))})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(ko,{id:"isFree",checked:r.isFree,onCheckedChange:e=>a((t=>c(l({},t),{isFree:e}))),className:"border-white/20",disabled:u}),m.jsx(co,{htmlFor:"isFree",className:"text-white",children:"Producto gratuito"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(ko,{id:"makeFeatured",checked:r.makeFeatured,onCheckedChange:e=>a((t=>c(l({},t),{makeFeatured:e}))),className:"border-white/20",disabled:u}),m.jsxs(co,{htmlFor:"makeFeatured",className:"text-white flex items-center gap-2",children:[m.jsx(Vt,{className:"w-4 h-4 text-yellow-400"}),"Destacar producto (+$20 USD)"]})]}),r.makeFeatured&&m.jsxs("div",{className:"bg-yellow-500/20 border border-yellow-500/30 rounded-lg p-3 ml-6",children:[m.jsx("p",{className:"text-sm text-yellow-300 font-medium",children:"⚠️ PAGO REQUERIDO: Su producto aparecerá destacado SOLO después de completar el pago de $20 USD"}),m.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"Si cancela el pago, el producto se publicará normalmente sin destacar"})]})]}),!r.isFree&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"price",className:"text-white",children:"Precio (USD)"}),m.jsx(Sn,{id:"price",type:"number",step:"0.01",value:r.price,onChange:e=>a((t=>c(l({},t),{price:e.target.value}))),className:"bg-white/10 border-white/20 text-white",required:!0,disabled:u})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"category",className:"text-white",children:"Categoría"}),m.jsxs(zn,{value:r.category,onValueChange:e=>a((t=>c(l({},t),{category:e}))),disabled:u,children:[m.jsx(Zn,{className:"bg-white/10 border-white/20 text-white",children:m.jsx(Bn,{placeholder:"Selecciona una categoría"})}),m.jsxs(Wn,{className:"bg-gray-900 border-white/20",children:[m.jsx(Gn,{value:"Educación",children:"📚 Educación"}),m.jsx(Gn,{value:"Diseño",children:"🎨 Diseño Gráfico"}),m.jsx(Gn,{value:"Desarrollo",children:"💻 Desarrollo & Programación"}),m.jsx(Gn,{value:"Marketing",children:"📈 Marketing Digital"}),m.jsx(Gn,{value:"Video",children:"🎬 Video & Animación"}),m.jsx(Gn,{value:"Audio",children:"🎵 Audio & Música"}),m.jsx(Gn,{value:"Fotografia",children:"📷 Fotografía"}),m.jsx(Gn,{value:"UI/UX",children:"🖼️ UI/UX Design"}),m.jsx(Gn,{value:"3D",children:"🎯 Modelado 3D"}),m.jsx(Gn,{value:"Plantillas",children:"📋 Plantillas & Documentos"}),m.jsx(Gn,{value:"Ilustracion",children:"✏️ Ilustración"}),m.jsx(Gn,{value:"Tipografia",children:"📝 Tipografía & Fuentes"}),m.jsx(Gn,{value:"Iconos",children:"🔷 Iconos & Símbolos"}),m.jsx(Gn,{value:"Presentaciones",children:"📊 Presentaciones"}),m.jsx(Gn,{value:"Logos",children:"🏷️ Logos & Branding"}),m.jsx(Gn,{value:"Gaming",children:"🎮 Gaming & Apps"}),m.jsx(Gn,{value:"Mockups",children:"📱 Mockups"}),m.jsx(Gn,{value:"Herramientas",children:"🛠️ Herramientas & Utilidades"}),m.jsx(Gn,{value:"Negocios",children:"💼 Negocios & Finanzas"}),m.jsx(Gn,{value:"Otros",children:"📦 Otros"})]})]})]}),!r.isFree&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"paypal",className:"text-white",children:"Email de PayPal (para recibir comisiones)"}),m.jsx(Sn,{id:"paypal",type:"email",value:r.paypalEmail,onChange:e=>a((t=>c(l({},t),{paypalEmail:e.target.value}))),className:"bg-white/10 border-white/20 text-white",placeholder:"tu@paypal.com",required:!0,disabled:u})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(co,{htmlFor:"file",className:"text-white flex items-center gap-2",children:[m.jsx(ft,{className:"w-4 h-4"}),"Archivo del Producto",C&&m.jsxs("div",{className:"flex items-center gap-1 text-blue-400",children:[m.jsx(Ut,{className:"w-4 h-4"}),m.jsx("span",{className:"text-xs",children:"Android: Cualquier archivo"})]}),w.scanning&&m.jsxs("div",{className:"flex items-center gap-1 text-blue-400",children:[m.jsx($t,{className:"w-4 h-4 animate-spin"}),m.jsx("span",{className:"text-xs",children:"Escaneando..."})]}),w.scanned&&w.safe&&m.jsxs("div",{className:"flex items-center gap-1 text-green-400",children:[m.jsx($t,{className:"w-4 h-4"}),m.jsx("span",{className:"text-xs",children:"Seguro"})]}),w.scanned&&!w.safe&&m.jsxs("div",{className:"flex items-center gap-1 text-red-400",children:[m.jsx(Bt,{className:"w-4 h-4"}),m.jsx("span",{className:"text-xs",children:"Malware detectado"})]})]}),C?m.jsxs("div",{className:"border-2 border-dashed border-white/20 rounded-lg p-4 text-center hover:border-white/30 transition-colors",children:[m.jsx(ft,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),m.jsx("p",{className:"text-gray-400 mb-2",children:"Sube cualquier archivo (APK, ZIP, PDF, etc.)"}),m.jsx("input",{type:"file",onChange:T,className:"hidden",id:"file-upload",disabled:u||S}),m.jsxs(Ve,{type:"button",variant:"outline",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",onClick:()=>{var e;return null==(e=document.getElementById("file-upload"))?void 0:e.click()},disabled:u||S,children:[m.jsx(Ht,{className:"w-4 h-4 mr-2"}),"Seleccionar Archivo"]})]}):m.jsx(Sn,{id:"file",type:"file",onChange:T,className:"bg-white/10 border-white/20 text-white file:bg-white/20 file:border-0 file:text-white",accept:".zip,.pdf,.png,.jpg,.jpeg,.mp4,.mov",required:!0,disabled:u||S}),r.productFile&&m.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx(ft,{className:"w-6 h-6 text-blue-400"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-white font-medium",children:r.productFile.name}),m.jsxs("p",{className:"text-gray-400 text-sm",children:[(r.productFile.size/1048576).toFixed(2)," MB"]}),m.jsxs("p",{className:"text-gray-400 text-xs",children:["Tipo: ",r.productFile.type||"Archivo"]})]})]}),m.jsx(Ve,{type:"button",variant:"ghost",size:"sm",onClick:()=>a((e=>c(l({},e),{productFile:null}))),className:"text-gray-400 hover:text-white hover:bg-white/20",disabled:u,children:m.jsx(ss,{className:"w-4 h-4"})})]}),w.scanned&&!w.safe&&m.jsx("div",{className:"mt-2 p-2 bg-red-500/20 border border-red-500/30 rounded",children:m.jsx("p",{className:"text-red-300 text-xs",children:"⚠️ Este archivo puede contener malware. Se recomienda no subirlo."})})]}),C&&m.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3",children:[m.jsx("p",{className:"text-blue-300 text-sm font-medium",children:"📱 Android: Puedes subir cualquier tipo de archivo"}),m.jsx("p",{className:"text-blue-400 text-xs mt-1",children:"APK, ZIP, PDF, documentos, imágenes, videos, etc."})]})]}),m.jsxs(ro,{children:[m.jsx(Ve,{type:"button",variant:"ghost",onClick:t,className:"text-white hover:bg-white/20",disabled:u||S||f,children:"Cancelar"}),m.jsx(Ve,{type:"submit",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",disabled:u||S||f||r.productFile&&(!w.scanned||!w.safe),children:u?"Subiendo...":S?"Escaneando...":f?"Moderando...":"Publicar Producto"})]})]})]})}),g&&y&&m.jsx(Co,{isOpen:g,onClose:()=>{console.log("Payment cancelled, creating product without featured status"),y&&P(y,!1),v(!1),b(null),p(!1)},product:{id:Date.now(),title:`Destacar: ${y.title}`,price:20,seller:"Digital Emporium Genesis Hub",paypalEmail:"Mr.federex@gmail.com"},onPaymentSuccess:e=>h(void 0,null,(function*(){console.log("Featured payment successful:",e),y&&(N({title:"Pago confirmado",description:"Tu producto será destacado después de la publicación"}),yield P(y,!0),v(!1))}))})]})},To=({product:e,onBack:t,onBuy:s,onDownload:r,isPurchased:a})=>{const[i,n]=Ae.useState(""),[o,d]=Ae.useState(5),[u,p]=Ae.useState(!1),[f,x]=Ae.useState(a),[g,v]=Ae.useState(!1),{user:y}=hn(),{comments:b,loading:w,createComment:j,deleteComment:_}=(e=>{const[t,s]=Ae.useState([]),[r,a]=Ae.useState(!0),{user:i}=hn(),{toast:n}=ys(),o=()=>h(void 0,null,(function*(){try{const{data:t,error:r}=yield cn.from("product_comments").select("*").eq("product_id",e).order("created_at",{ascending:!1});if(r)throw r;if(t&&t.length>0){const e=[...new Set(t.map((e=>e.user_id)))],{data:r}=yield cn.from("profiles").select("id, username, avatar_url").in("id",e),a=t.map((e=>c(l({},e),{profiles:(null==r?void 0:r.find((t=>t.id===e.user_id)))||null})));s(a)}else s([])}catch(t){console.error("Error fetching comments:",t),n({title:"Error",description:"No se pudieron cargar los comentarios",variant:"destructive"}),s([])}finally{a(!1)}}));return Ae.useEffect((()=>{e&&o()}),[e]),{comments:t,loading:r,createComment:(t,r=5)=>h(void 0,null,(function*(){if(!i)return n({title:"Error",description:"Debes estar autenticado para comentar",variant:"destructive"}),{error:new Error("User not authenticated")};try{const{data:a,error:o}=yield cn.from("product_comments").insert([{product_id:e,user_id:i.id,comment:t,rating:r}]).select().single();if(o)throw o;const{data:d}=yield cn.from("profiles").select("username, avatar_url").eq("id",i.id).single(),u=c(l({},a),{profiles:d||null});return s((e=>[u,...e])),n({title:"¡Comentario publicado!",description:"Tu comentario ha sido publicado exitosamente"}),{data:u,error:null}}catch(a){return console.error("Error creating comment:",a),n({title:"Error",description:"No se pudo publicar el comentario",variant:"destructive"}),{error:a}}})),deleteComment:e=>h(void 0,null,(function*(){if(!i)return n({title:"Error",description:"Debes estar autenticado para eliminar comentarios",variant:"destructive"}),{error:new Error("User not authenticated")};try{const{error:t}=yield cn.from("product_comments").delete().eq("id",e).eq("user_id",i.id);if(t)throw t;return s((t=>t.filter((t=>t.id!==e)))),n({title:"Comentario eliminado",description:"Tu comentario ha sido eliminado exitosamente"}),{error:null}}catch(t){return console.error("Error deleting comment:",t),n({title:"Error",description:"No se pudo eliminar el comentario",variant:"destructive"}),{error:t}}})),refreshComments:o}})(e.id),{isLiked:N,likesCount:k,toggleLike:S}=(e=>{const[t,s]=Ae.useState(!1),[r,a]=Ae.useState(0),[i,n]=Ae.useState(!0),{user:o}=hn(),{toast:l}=ys(),c=()=>h(void 0,null,(function*(){try{const{count:t,error:r}=yield cn.from("product_likes").select("*",{count:"exact"}).eq("product_id",e);if(r)throw r;if(a(t||0),o){const{data:t,error:r}=yield cn.from("product_likes").select("id").eq("product_id",e).eq("user_id",o.id).single();if(r&&"PGRST116"!==r.code)throw r;s(!!t)}}catch(t){console.error("Error fetching likes:",t)}finally{n(!1)}}));return Ae.useEffect((()=>{e&&c()}),[e,o]),{isLiked:t,likesCount:r,loading:i,toggleLike:()=>h(void 0,null,(function*(){if(o)try{if(t){const{error:t}=yield cn.from("product_likes").delete().eq("product_id",e).eq("user_id",o.id);if(t)throw t;s(!1),a((e=>e-1))}else{const{error:t}=yield cn.from("product_likes").insert([{product_id:e,user_id:o.id}]);if(t)throw t;s(!0),a((e=>e+1))}setTimeout((()=>h(void 0,null,(function*(){try{const{useFeaturedProducts:e}=yield _s((()=>h(void 0,null,(function*(){const{useFeaturedProducts:e}=yield Promise.resolve().then((()=>Xn));return{useFeaturedProducts:e}}))),void 0,import.meta.url)}catch(e){console.error("Error updating featured products:",e)}}))),500)}catch(r){console.error("Error toggling like:",r),l({title:"Error",description:"No se pudo procesar el like",variant:"destructive"})}else l({title:"Error",description:"Debes estar autenticado para dar like",variant:"destructive"})})),refreshLikes:c}})(e.id),C=e.is_free||f&&g;return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsxs(Ve,{variant:"ghost",onClick:t,className:"text-white hover:bg-white/20",children:[m.jsx(He,{className:"w-4 h-4 mr-2"}),"Volver"]}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:e.title}),m.jsx("p",{className:"text-gray-300",children:"Detalles del producto"})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[m.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsxs(Nn,{className:"p-0",children:[m.jsxs("div",{className:"aspect-video bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-t-lg flex items-center justify-center relative",children:[e.image_url?m.jsx("img",{src:e.image_url,alt:e.title,className:"w-full h-full object-cover rounded-t-lg"}):m.jsx(Ct,{className:"w-16 h-16 text-white/50"}),e.is_featured&&m.jsx(gn,{className:"absolute top-4 left-4 bg-yellow-500/20 text-yellow-200 border-yellow-500/30",children:"Destacado"}),e.is_free&&m.jsx(gn,{className:"absolute top-4 right-4 bg-green-500/20 text-green-200 border-green-500/30",children:"GRATIS"})]}),m.jsxs("div",{className:"p-4",children:[m.jsx("h3",{className:"text-white font-semibold mb-3",children:"Vista previa del producto"}),m.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:e.preview_images&&e.preview_images.length>0?e.preview_images.map(((e,t)=>m.jsx("div",{className:"aspect-square bg-white/5 rounded-lg border border-white/10 overflow-hidden",children:m.jsx("img",{src:e,alt:`Vista previa ${t+1}`,className:"w-full h-full object-cover hover:scale-105 transition-transform cursor-pointer"})},t))):[1,2,3].map((e=>m.jsx("div",{className:"aspect-square bg-white/5 rounded-lg border border-white/10 flex items-center justify-center",children:m.jsx(vt,{className:"w-6 h-6 text-white/30"})},e)))}),m.jsx("p",{className:"text-gray-400 text-xs mt-2",children:e.preview_images&&e.preview_images.length>0?`${e.preview_images.length} imagen(es) de vista previa disponible(s)`:"* Las imágenes de vista previa son ejemplos del contenido incluido"})]})]})}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsx(jn,{className:"text-white",children:"Descripción"})}),m.jsx(Nn,{children:m.jsx("p",{className:"text-gray-300 leading-relaxed",children:e.description||"Sin descripción disponible"})})]}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsxs(jn,{className:"text-white flex items-center",children:[m.jsx(St,{className:"w-5 h-5 mr-2"}),"Comentarios (",b.length,")"]})}),m.jsxs(Nn,{className:"space-y-4",children:[y?m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[m.jsx("span",{className:"text-white text-sm",children:"Calificación:"}),m.jsx("div",{className:"flex",children:[1,2,3,4,5].map((e=>m.jsx(Vt,{className:"w-4 h-4 cursor-pointer "+(e<=o?"text-yellow-400 fill-current":"text-gray-500"),onClick:()=>d(e)},e)))})]}),m.jsx(uo,{placeholder:"Escribe tu comentario...",value:i,onChange:e=>n(e.target.value),className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400"}),m.jsx(Ve,{onClick:()=>h(void 0,null,(function*(){if(i.trim()){(yield j(i,o)).error||(n(""),d(5))}})),disabled:!i.trim(),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:"Enviar Comentario"})]}):m.jsx("p",{className:"text-gray-400 text-sm",children:"Inicia sesión para comentar"}),m.jsx("div",{className:"space-y-4",children:w?m.jsx("p",{className:"text-gray-400 text-sm",children:"Cargando comentarios..."}):b.length>0?b.map((e=>{var t,s;return m.jsxs("div",{className:"bg-white/5 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("div",{className:"w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:m.jsx("span",{className:"text-white text-xs font-bold",children:(null==(t=e.profiles)?void 0:t.username)?e.profiles.username.substring(0,1).toUpperCase():"U"})}),m.jsx("span",{className:"text-white font-medium text-sm",children:(null==(s=e.profiles)?void 0:s.username)||"Usuario"})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("div",{className:"flex",children:[...Array(5)].map(((t,s)=>m.jsx(Vt,{className:"w-3 h-3 "+(s<e.rating?"text-yellow-400 fill-current":"text-gray-500")},s)))}),m.jsx("span",{className:"text-gray-400 text-xs",children:new Date(e.created_at).toLocaleDateString()}),y&&e.user_id===y.id&&m.jsx(Ve,{variant:"ghost",size:"sm",className:"text-red-400 hover:text-red-300 hover:bg-red-500/10 p-1 h-auto",onClick:()=>{return t=e.id,h(void 0,null,(function*(){yield _(t)}));var t},children:m.jsx(qt,{className:"w-3 h-3"})})]})]}),m.jsx("p",{className:"text-gray-300 text-sm",children:e.comment})]},e.id)})):m.jsx("p",{className:"text-gray-400 text-sm",children:"No hay comentarios aún"})})]})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-6",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-3xl font-bold text-white",children:e.is_free?"GRATIS":`$${e.price}`}),m.jsxs(Ve,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20 "+(N?"text-red-400":""),onClick:S,disabled:!y,children:[m.jsx(gt,{className:"w-4 h-4 "+(N?"fill-current":"")}),m.jsx("span",{className:"ml-1 text-sm",children:k})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(gn,{variant:"secondary",className:"bg-purple-500/20 text-purple-200 border-purple-500/30",children:e.category}),m.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-400",children:[m.jsxs("span",{children:["★ ",e.rating]}),m.jsxs("span",{children:[e.sales," ventas"]}),m.jsxs("span",{children:[e.views," vistas"]})]})]}),!e.is_free&&m.jsxs("div",{className:"p-3 bg-white/5 rounded text-xs",children:[m.jsx("p",{className:"text-gray-400 mb-1",children:"División automática:"}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-green-400",children:"Vendedor (80%):"}),m.jsxs("span",{className:"text-green-400",children:["$",(.8*e.price).toFixed(2)]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-purple-400",children:"Plataforma (20%):"}),m.jsxs("span",{className:"text-purple-400",children:["$",(.2*e.price).toFixed(2)]})]})]})]}),m.jsx("div",{className:"space-y-3",children:C?m.jsxs(Ve,{className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700",onClick:()=>{(f&&g||e.is_free)&&r(e)},children:[m.jsx(ut,{className:"w-4 h-4 mr-2"}),"Descargar Producto"]}):m.jsxs(Ve,{className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",onClick:()=>{e.is_free?(x(!0),v(!0),s(e)):p(!0)},children:[m.jsx(Lt,{className:"w-4 h-4 mr-2"}),"Comprar $",e.price]})}),m.jsxs("div",{className:"border-t border-white/20 pt-4 space-y-2 text-sm",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-400",children:"Creado:"}),m.jsx("span",{className:"text-white",children:new Date(e.created_at).toLocaleDateString()})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-400",children:"Actualizado:"}),m.jsx("span",{className:"text-white",children:new Date(e.updated_at).toLocaleDateString()})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-400",children:"Estado:"}),m.jsx("span",{className:"text-green-400",children:e.status})]})]})]})})}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsx(jn,{className:"text-white text-lg",children:"Vendedor"})}),m.jsxs(Nn,{children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:m.jsx("span",{className:"text-white font-bold",children:e.user_id.substring(0,2).toUpperCase()})}),m.jsxs("div",{children:[m.jsx("p",{className:"text-white font-medium",children:"Vendedor"}),m.jsx("p",{className:"text-gray-400 text-sm",children:"Miembro desde 2024"})]})]}),m.jsx(Ve,{variant:"outline",className:"w-full mt-4 border-white/20 text-white hover:bg-white/10",children:"Ver Perfil"})]})]})]})]}),u&&!e.is_free&&m.jsx(Co,{isOpen:u,onClose:()=>p(!1),product:{id:parseInt(e.id),title:e.title,price:e.price,seller:"Vendedor",paypalEmail:e.paypal_email||"seller@example.com"},onPaymentSuccess:t=>{console.log("Payment successful:",t),t&&"completed"===t.status&&t.paymentId&&(x(!0),v(!0),p(!1),s(e))}})]})},Po=({onUserSelect:e})=>{const[t,s]=Ae.useState(""),[r,a]=Ae.useState("all"),[i,n]=Ae.useState(null),[o,u]=Ae.useState(!1),[p,f]=Ae.useState({}),[x,g]=Ae.useState(new Set),{products:v,loading:y,createProduct:b}=(()=>{const[e,t]=Ae.useState([]),[s,r]=Ae.useState(!0),{user:a}=hn(),{toast:i}=ys(),{updateFeaturedProducts:n}=Jn(),o=()=>h(void 0,null,(function*(){try{const{data:e,error:s}=yield cn.from("products").select("*").eq("status","active").order("created_at",{ascending:!1});if(s)throw s;const r=(e||[]).map((e=>c(l({},e),{is_featured:e.is_paid_featured||e.is_performance_featured,preview_images:Array.isArray(e.preview_images)?e.preview_images.filter((e=>"string"==typeof e)):[]}))).sort(((e,t)=>e.is_featured&&!t.is_featured?-1:!e.is_featured&&t.is_featured?1:new Date(t.created_at).getTime()-new Date(e.created_at).getTime()));t(r)}catch(e){console.error("Error fetching products:",e),i({title:"Error",description:"No se pudieron cargar los productos",variant:"destructive"})}finally{r(!1)}}));return Ae.useEffect((()=>{o()}),[]),{products:e,loading:s,createProduct:e=>h(void 0,null,(function*(){if(!a)return i({title:"Error",description:"Debes estar autenticado para crear productos",variant:"destructive"}),{error:new Error("User not authenticated")};try{console.log("Creating product with data:",e);const s=e,{is_featured:r}=s,o=d(s,["is_featured"]),u=c(l({},o),{user_id:a.id,preview_images:e.preview_images||[],is_paid_featured:!0===r,is_performance_featured:!1});console.log("Formatted data for insert:",u);const{data:h,error:m}=yield cn.from("products").insert([u]).select().single();if(m)throw console.error("Supabase insert error:",m),m;console.log("Product created successfully:",h);const p=c(l({},h),{is_featured:h.is_paid_featured||h.is_performance_featured,preview_images:Array.isArray(h.preview_images)?h.preview_images.filter((e=>"string"==typeof e)):[]});t((e=>[p,...e].sort(((e,t)=>e.is_featured&&!t.is_featured?-1:!e.is_featured&&t.is_featured?1:new Date(t.created_at).getTime()-new Date(e.created_at).getTime())))),setTimeout((()=>{n()}),1e3);const f=h.is_paid_featured?"Tu producto ha sido publicado y destacado exitosamente":"Tu producto ha sido publicado exitosamente";return i({title:"¡Producto publicado!",description:f}),{data:p,error:null}}catch(s){return console.error("Error creating product:",s),i({title:"Error",description:"No se pudo publicar el producto. Intenta de nuevo.",variant:"destructive"}),{error:s}}})),refreshProducts:o}})(),{user:w}=hn(),{toast:j}=ys(),{addToCart:_,isProductInCart:N}=fn(),k=v.filter((e=>{var s;const a=e.title.toLowerCase().includes(t.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(t.toLowerCase())),i="all"===r||e.category===r;return a&&i})),S=k.filter((e=>e.is_featured)),C=k.filter((e=>!e.is_featured)),E=e=>h(void 0,null,(function*(){try{const{error:t}=yield cn.from("products").update({views:e.views+1}).eq("id",e.id);if(t)throw t;n(c(l({},e),{views:e.views+1}))}catch(t){console.error("Error updating product views:",t),n(e)}}));Ae.useEffect((()=>{h(void 0,null,(function*(){if(0===k.length)return;const e=[...new Set(k.map((e=>e.user_id)))];try{const{data:t,error:s}=yield cn.from("profiles").select("id, username, avatar_url").in("id",e);if(s)throw s;const r=(null==t?void 0:t.reduce(((e,t)=>(e[t.id]=t,e)),{}))||{};f(r)}catch(t){console.error("Error fetching user profiles:",t)}}))}),[k]);const T=t=>{e&&e(t)},P=e=>h(void 0,null,(function*(){try{g((t=>new Set([...t,e.id])));const{error:t}=yield cn.from("products").update({sales:e.sales+1}).eq("id",e.id);if(t)throw t;j({title:"¡Compra exitosa!",description:`Has adquirido "${e.title}" exitosamente. Ahora puedes descargarlo.`})}catch(t){console.error("Error processing purchase:",t),j({title:"Error",description:"Hubo un problema procesando la compra.",variant:"destructive"})}})),A=e=>h(void 0,null,(function*(){try{if(e.file_url){const t=document.createElement("a");t.href=e.file_url,t.download=`${e.title}.zip`,document.body.appendChild(t),t.click(),document.body.removeChild(t),j({title:"Descarga iniciada",description:`Descargando "${e.title}"...`})}else{j({title:"Descarga simulada",description:`"${e.title}" se está descargando (archivo de demostración)`});const t=`Producto: ${e.title}\nDescripción: ${e.description}\nPrecio: $${e.price}\n\nEste es un archivo de demostración.\nEn un sistema real, aquí estaría el producto digital real.`,s=new Blob([t],{type:"text/plain"}),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`${e.title}_demo.txt`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r)}}catch(t){console.error("Error downloading product:",t),j({title:"Error",description:"No se pudo descargar el producto.",variant:"destructive"})}})),R=(e,t=!1)=>{const s=p[e.user_id],r=x.has(e.id)||e.is_free,a=N(e.id),i=w&&w.id===e.user_id;return m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20 hover:bg-white/15 transition-all duration-300 group "+(t?"ring-2 ring-yellow-400/50":""),children:[m.jsxs("div",{className:"aspect-video bg-gray-800 rounded-t-lg overflow-hidden cursor-pointer relative",onClick:()=>E(e),children:[e.image_url?m.jsx("img",{src:e.image_url,alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):m.jsx("div",{className:"w-full h-full flex items-center justify-center",children:m.jsx(Dt,{className:"w-12 h-12 text-gray-400"})}),t&&m.jsx("div",{className:"absolute top-2 right-2",children:m.jsxs(gn,{className:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white",children:[m.jsx(Vt,{className:"w-3 h-3 mr-1"}),"Destacado"]})})]}),m.jsxs(Nn,{className:"p-4",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsxs(Fn,{className:"w-6 h-6 cursor-pointer",onClick:()=>T(e.user_id),children:[m.jsx(Vn,{src:null==s?void 0:s.avatar_url}),m.jsx(qn,{className:"bg-purple-500/20 text-white text-xs",children:m.jsx(Xt,{className:"w-3 h-3"})})]}),m.jsx("span",{className:"text-gray-300 text-sm cursor-pointer hover:text-white transition-colors",onClick:()=>T(e.user_id),children:(null==s?void 0:s.username)||"Usuario"})]}),m.jsx("h3",{className:"font-semibold text-white mb-2 line-clamp-1 cursor-pointer",onClick:()=>E(e),children:e.title}),m.jsx("p",{className:"text-gray-300 text-sm mb-3 line-clamp-2",children:e.description}),m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsx("div",{className:"flex items-center gap-2",children:e.is_free?m.jsx(gn,{variant:"secondary",className:"bg-green-500/20 text-green-400",children:"Gratis"}):m.jsxs("span",{className:"text-lg font-bold text-white",children:["$",e.price]})}),!r&&!i&&m.jsxs(Ve,{size:"sm",variant:a?"outline":"default",onClick:t=>{t.stopPropagation(),_(e.id)},disabled:a,className:(a?"border-purple-500 text-purple-400 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white")+" transition-all",children:[m.jsx(Lt,{className:"w-4 h-4 mr-2"}),a?"Añadido":"Añadir"]})]}),m.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-400",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(gt,{className:"w-4 h-4"}),m.jsx("span",{children:e.rating})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(zt,{className:"w-4 h-4"}),m.jsx("span",{children:e.sales})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(pt,{className:"w-4 h-4"}),m.jsx("span",{children:e.views})]})]}),m.jsx(gn,{variant:"outline",className:"border-white/20 text-gray-300",children:e.category})]})]})]},e.id)};return i?m.jsx(To,{product:i,onBack:()=>n(null),onBuy:P,onDownload:A,isPurchased:x.has(i.id)||i.is_free}):m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Productos Digitales"}),m.jsx("p",{className:"text-gray-300",children:"Descubre y compra productos digitales únicos"})]}),m.jsxs(Ve,{onClick:()=>u(!0),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[m.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Publicar Producto"]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[m.jsxs("div",{className:"relative flex-1",children:[m.jsx(Rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),m.jsx(Sn,{placeholder:"Buscar productos...",value:t,onChange:e=>s(e.target.value),className:"pl-10 bg-white/10 border-white/20 text-white placeholder:text-gray-400"})]}),m.jsxs(zn,{value:r,onValueChange:a,children:[m.jsxs(Zn,{className:"w-48 bg-white/10 border-white/20 text-white",children:[m.jsx(xt,{className:"w-4 h-4 mr-2"}),m.jsx(Bn,{})]}),m.jsx(Wn,{children:["all","templates","graphics","music","videos","software","other"].map((e=>m.jsx(Gn,{value:e,children:"all"===e?"Todas las categorías":e.charAt(0).toUpperCase()+e.slice(1)},e)))})]})]}),y?m.jsx("div",{className:"text-center text-white",children:"Cargando productos..."}):m.jsxs("div",{className:"space-y-8",children:[S.length>0&&m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[m.jsx(Vt,{className:"w-5 h-5 text-yellow-400"}),m.jsx("h2",{className:"text-xl font-semibold text-white",children:"Productos Destacados"})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:S.map((e=>R(e,!0)))})]}),C.length>0&&m.jsxs("div",{children:[S.length>0&&m.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Todos los Productos"}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:C.map((e=>R(e,!1)))})]}),0===k.length&&m.jsxs("div",{className:"text-center py-12",children:[m.jsx(Dt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No se encontraron productos"}),m.jsx("p",{className:"text-gray-400",children:"Intenta con otros términos de búsqueda o categorías"})]})]}),m.jsx(Eo,{isOpen:o,onClose:()=>u(!1),onCreateProduct:e=>h(void 0,null,(function*(){const t=yield b(e);return t.error||u(!1),t}))})]})},Ao=()=>{const[e,t]=Ae.useState([{id:"TXN_1703123456789",productId:1,productName:"Curso de Diseño Web",totalPrice:49.99,adminCommission:9.99,sellerCommission:39.99,sellerPayPal:"webmaster@example.com",buyerEmail:"cliente@example.com",status:"completed",date:"2024-01-15",paymentId:"PAYID-123456"},{id:"TXN_1703123456790",productId:2,productName:"Pack de Iconos UI",totalPrice:19.99,adminCommission:3.99,sellerCommission:15.99,sellerPayPal:"designpro@example.com",buyerEmail:"cliente2@example.com",status:"pending",date:"2024-01-14"}]),[s,r]=Ae.useState({totalSales:0,totalCommissions:0,productsSold:0,uniqueCustomers:0});Ae.useEffect((()=>{const t=e.filter((e=>"completed"===e.status)),s={totalSales:t.reduce(((e,t)=>e+t.totalPrice),0),totalCommissions:t.reduce(((e,t)=>e+t.adminCommission),0),productsSold:t.length,uniqueCustomers:new Set(t.map((e=>e.buyerEmail))).size};r(s)}),[e]);return m.jsxs("div",{className:"space-y-6",children:[m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsxs(wn,{children:[m.jsx(jn,{className:"text-white",children:"Reporte Semanal - Sistema Automático"}),m.jsx(_n,{className:"text-gray-300",children:"Comisiones procesadas automáticamente via PayPal Business API"})]}),m.jsx(Nn,{children:m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[m.jsxs("div",{className:"text-center",children:[m.jsxs("p",{className:"text-2xl font-bold text-green-400",children:["$",s.totalSales.toFixed(2)]}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Ventas Totales"})]}),m.jsxs("div",{className:"text-center",children:[m.jsxs("p",{className:"text-2xl font-bold text-purple-400",children:["$",s.totalCommissions.toFixed(2)]}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Mis Comisiones (20%)"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-2xl font-bold text-blue-400",children:s.productsSold}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Productos Vendidos"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-2xl font-bold text-pink-400",children:s.uniqueCustomers}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Clientes Únicos"})]})]})})]}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsxs(wn,{children:[m.jsx(jn,{className:"text-white",children:"Configuración PayPal - Comisiones Automáticas"}),m.jsx(_n,{className:"text-gray-300",children:"Sistema integrado con PayPal Business API para división automática de pagos"})]}),m.jsx(Nn,{children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-green-500/30",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx(dt,{className:"w-5 h-5 text-green-400"}),m.jsx("span",{className:"text-white",children:"Mi comisión (Admin)"})]}),m.jsx(gn,{className:"bg-green-500/20 text-green-300",children:"20% Automático"})]}),m.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-blue-500/30",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx(Xt,{className:"w-5 h-5 text-blue-400"}),m.jsx("span",{className:"text-white",children:"Comisión del vendedor"})]}),m.jsx(gn,{className:"bg-blue-500/20 text-blue-300",children:"80% Automático"})]}),m.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-purple-500/30",children:[m.jsx("div",{className:"flex items-center space-x-3",children:m.jsx("span",{className:"text-white",children:"Mi PayPal (Comisiones)"})}),m.jsxs("div",{className:"text-right",children:[m.jsx("span",{className:"text-purple-300 font-medium",children:"Mr.federex@gmail.com"}),m.jsx("p",{className:"text-xs text-gray-400",children:"Configurado ✓"})]})]}),m.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-orange-500/30",children:[m.jsx("div",{className:"flex items-center space-x-3",children:m.jsx("span",{className:"text-white",children:"Modo de API"})}),m.jsx(gn,{className:"bg-orange-500/20 text-orange-300",children:"Sandbox (Pruebas)"})]})]})})]}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsxs(wn,{children:[m.jsx(jn,{className:"text-white",children:"Transacciones con Comisiones Automáticas"}),m.jsx(_n,{className:"text-gray-300",children:"Historial de pagos procesados con división automática via PayPal"})]}),m.jsx(Nn,{children:m.jsx("div",{className:"space-y-4",children:e.map((s=>m.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsxs("div",{children:[m.jsx("h4",{className:"text-white font-medium",children:s.productName}),m.jsxs("p",{className:"text-gray-400 text-sm",children:["ID: ",s.id]}),s.paymentId&&m.jsxs("p",{className:"text-gray-400 text-sm",children:["PayPal ID: ",s.paymentId]}),m.jsxs("p",{className:"text-gray-400 text-sm",children:["Fecha: ",s.date]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs(gn,{variant:"completed"===s.status?"default":"pending"===s.status?"secondary":"destructive",className:"completed"===s.status?"bg-green-500/20 text-green-300 border-green-500/30":"pending"===s.status?"bg-yellow-500/20 text-yellow-300 border-yellow-500/30":"bg-red-500/20 text-red-300 border-red-500/30",children:["completed"===s.status&&m.jsx(at,{className:"w-3 h-3 mr-1"}),"pending"===s.status&&m.jsx(rt,{className:"w-3 h-3 mr-1"}),"completed"===s.status?"Completado":"pending"===s.status?"Pendiente":"Fallido"]}),s.paymentId&&m.jsx(Ve,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs",children:m.jsx(mt,{className:"w-3 h-3"})})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Precio Total"}),m.jsxs("p",{className:"text-white font-medium",children:["$",s.totalPrice]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Mi Comisión (20%)"}),m.jsxs("p",{className:"text-green-400 font-medium",children:["$",s.adminCommission," → Mr.federex@gmail.com"]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Comisión Vendedor (80%)"}),m.jsxs("p",{className:"text-blue-400 font-medium",children:["$",s.sellerCommission," → ",s.sellerPayPal]})]})]}),m.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[m.jsxs("p",{className:"text-gray-400 text-sm",children:["Comprador: ",s.buyerEmail]}),"completed"===s.status&&m.jsx("p",{className:"text-green-400 text-sm",children:"✓ Comisiones transferidas automáticamente"})]}),"pending"===s.status&&m.jsx("div",{className:"mt-3",children:m.jsx(Ve,{size:"sm",onClick:()=>(s=>{const r=e.find((e=>e.id===s));r&&(console.log("Procesando pago automático con PayPal API:",{transactionId:s,adminPayout:{amount:r.adminCommission,recipient:"Mr.federex@gmail.com"},sellerPayout:{amount:r.sellerCommission,recipient:r.sellerPayPal}}),t((e=>e.map((e=>e.id===s?c(l({},e),{status:"completed",paymentId:`PAYID-${Date.now()}`}):e)))))})(s.id),className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700",children:"Procesar Comisiones Automáticas"})})]},s.id)))})})]})]})},Ro=()=>{const[e,t]=Ae.useState({totalSales:0,totalRevenue:0,totalProducts:0,totalCustomers:0,commissions:0}),[s,r]=Ae.useState([]),[a,i]=Ae.useState(!0),{toast:n}=ys();Ae.useEffect((()=>{h(void 0,null,(function*(){try{i(!0);const{data:e,error:s}=yield cn.from("products").select("*");if(s)throw s;if(e&&Array.isArray(e)){const s=e.reduce(((e,t)=>e+(t.sales||0)),0),a=e.reduce(((e,t)=>e+(t.sales||0)*(t.price||0)),0),i=.8*a,n=Math.floor(.7*s);t({totalSales:s,totalRevenue:a,totalProducts:e.length,totalCustomers:n,commissions:i});const o=e.filter((e=>e.sales>0)).slice(0,5).map(((e,t)=>({id:`sale-${e.id}-${t}`,product:e.title,buyer:`Cliente ${t+1}`,amount:e.price,commission:.8*e.price,date:new Date(Date.now()-24*t*60*60*1e3).toISOString().split("T")[0],status:0===t?"Procesando":"Completado"})));r(o)}}catch(e){console.error("Error fetching sales data:",e),n({title:"Error",description:"No se pudieron cargar los datos de ventas",variant:"destructive"})}finally{i(!1)}}))}),[]);const o=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"USD"}).format(e),l=(e,t=0)=>{if(0===t)return"+0%";const s=(e-t)/t*100;return`${s>0?"+":""}${s.toFixed(1)}%`},c=[{title:"Ventas Totales",value:o(e.totalRevenue),change:l(e.totalRevenue),icon:dt,color:"text-green-400"},{title:"Productos Vendidos",value:e.totalSales.toString(),change:l(e.totalSales),icon:Ct,color:"text-blue-400"},{title:"Mis Comisiones (80%)",value:o(e.commissions),change:l(e.commissions),icon:zt,color:"text-purple-400"},{title:"Clientes",value:e.totalCustomers.toString(),change:l(e.totalCustomers),icon:Yt,color:"text-pink-400"}];return a?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Ventas y Comisiones"}),m.jsx("p",{className:"text-gray-300",children:"Cargando datos de ventas..."})]}),m.jsx("div",{className:"flex items-center justify-center h-64",children:m.jsx("div",{className:"text-white text-xl",children:"Cargando..."})})]}):m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Ventas y Comisiones"}),m.jsx("p",{className:"text-gray-300",children:"Panel de control de ventas con sistema de comisiones automático"})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:c.map(((e,t)=>{const s=e.icon;return m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-300 text-sm font-medium",children:e.title}),m.jsx("p",{className:"text-2xl font-bold text-white",children:e.value}),m.jsx("p",{className:`text-sm ${e.color}`,children:e.change})]}),m.jsx("div",{className:`p-3 rounded-lg bg-white/10 ${e.color}`,children:m.jsx(s,{className:"w-6 h-6"})})]})})},t)}))}),m.jsx(Ao,{}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsxs(wn,{children:[m.jsx(jn,{className:"text-white",children:"Ventas Recientes"}),m.jsx(_n,{className:"text-gray-300",children:"Tus últimas transacciones"})]}),m.jsx(Nn,{children:s.length>0?m.jsx("div",{className:"space-y-4",children:s.map((e=>m.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg border border-white/10",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("h4",{className:"text-white font-medium",children:e.product}),m.jsxs("p",{className:"text-gray-400 text-sm",children:["Comprador: ",e.buyer]}),m.jsx("p",{className:"text-gray-400 text-sm",children:e.date})]}),m.jsxs("div",{className:"text-right",children:[m.jsx("p",{className:"text-white font-medium",children:o(e.amount)}),m.jsxs("p",{className:"text-green-400 text-sm",children:["Comisión: ",o(e.commission)]}),m.jsx(gn,{variant:"Completado"===e.status?"default":"secondary",className:"Completado"===e.status?"bg-green-500/20 text-green-300 border-green-500/30":"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",children:e.status})]})]},e.id)))}):m.jsxs("div",{className:"text-center py-8",children:[m.jsx(Ct,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No hay ventas registradas"}),m.jsx("p",{className:"text-gray-400 text-sm",children:"¡Publica productos para comenzar a vender!"})]})})]})]})};var Oo="AlertDialog",[Io,$o]=_(Oo,[K]),Do=K(),Lo=e=>{const t=e,{__scopeAlertDialog:s}=t,r=d(t,["__scopeAlertDialog"]),a=Do(s);return m.jsx(w,c(l(l({},a),r),{modal:!0}))};Lo.displayName=Oo;var Mo=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAlertDialog:r}=s,a=d(s,["__scopeAlertDialog"]),i=Do(r);return m.jsx(j,c(l(l({},i),a),{ref:t}))}));Mo.displayName="AlertDialogTrigger";var Uo=e=>{const t=e,{__scopeAlertDialog:s}=t,r=d(t,["__scopeAlertDialog"]),a=Do(s);return m.jsx(x,l(l({},a),r))};Uo.displayName="AlertDialogPortal";var Fo=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAlertDialog:r}=s,a=d(s,["__scopeAlertDialog"]),i=Do(r);return m.jsx(f,c(l(l({},i),a),{ref:t}))}));Fo.displayName="AlertDialogOverlay";var Vo="AlertDialogContent",[qo,zo]=Io(Vo),Bo=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAlertDialog:r,children:a}=s,i=d(s,["__scopeAlertDialog","children"]),n=Do(r),o=Ae.useRef(null),u=V(t,o),h=Ae.useRef(null);return m.jsx(W,{contentName:Vo,titleName:Zo,docsSlug:"alert-dialog",children:m.jsx(qo,{scope:r,cancelRef:h,children:m.jsxs(g,c(l(l({role:"alertdialog"},n),i),{ref:u,onOpenAutoFocus:z(i.onOpenAutoFocus,(e=>{var t;e.preventDefault(),null==(t=h.current)||t.focus({preventScroll:!0})})),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[m.jsx(G,{children:a}),m.jsx(Yo,{contentRef:o})]}))})})}));Bo.displayName=Vo;var Zo="AlertDialogTitle",Ho=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAlertDialog:r}=s,a=d(s,["__scopeAlertDialog"]),i=Do(r);return m.jsx(y,c(l(l({},i),a),{ref:t}))}));Ho.displayName=Zo;var Ko="AlertDialogDescription",Wo=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAlertDialog:r}=s,a=d(s,["__scopeAlertDialog"]),i=Do(r);return m.jsx(b,c(l(l({},i),a),{ref:t}))}));Wo.displayName=Ko;var Go=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAlertDialog:r}=s,a=d(s,["__scopeAlertDialog"]),i=Do(r);return m.jsx(v,c(l(l({},i),a),{ref:t}))}));Go.displayName="AlertDialogAction";var Jo="AlertDialogCancel",Xo=Ae.forwardRef(((e,t)=>{const s=e,{__scopeAlertDialog:r}=s,a=d(s,["__scopeAlertDialog"]),{cancelRef:i}=zo(Jo,r),n=Do(r),o=V(t,i);return m.jsx(v,c(l(l({},n),a),{ref:o}))}));Xo.displayName=Jo;var Yo=({contentRef:e})=>{const t=`\`${Vo}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${Vo}\` by passing a \`${Ko}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Vo}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return Ae.useEffect((()=>{var s;document.getElementById(null==(s=e.current)?void 0:s.getAttribute("aria-describedby"))||console.warn(t)}),[t,e]),null},Qo=Fo,el=Bo,tl=Go,sl=Xo,rl=Ho,al=Wo;const il=Lo,nl=Mo,ol=Uo,ll=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(Qo,c(l({className:Ue("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r)},a),{ref:t}))}));ll.displayName=Qo.displayName;const cl=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsxs(ol,{children:[m.jsx(ll,{}),m.jsx(el,l({ref:t,className:Ue("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r)},a))]})}));cl.displayName=el.displayName;const dl=e=>{var t=e,{className:s}=t,r=d(t,["className"]);return m.jsx("div",l({className:Ue("flex flex-col space-y-2 text-center sm:text-left",s)},r))};dl.displayName="AlertDialogHeader";const ul=e=>{var t=e,{className:s}=t,r=d(t,["className"]);return m.jsx("div",l({className:Ue("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s)},r))};ul.displayName="AlertDialogFooter";const hl=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(rl,l({ref:t,className:Ue("text-lg font-semibold",r)},a))}));hl.displayName=rl.displayName;const ml=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(al,l({ref:t,className:Ue("text-sm text-muted-foreground",r)},a))}));ml.displayName=al.displayName;const pl=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(tl,l({ref:t,className:Ue(Fe(),r)},a))}));pl.displayName=tl.displayName;const fl=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(sl,l({ref:t,className:Ue(Fe({variant:"outline"}),"mt-2 sm:mt-0",r)},a))}));fl.displayName=sl.displayName;const xl=({backgroundUrl:e,videoUrl:t,onBackgroundChange:s,onVideoChange:r,isEditing:a})=>{const[i,n]=Ae.useState(!1),[o,l]=Ae.useState(!1),{user:c}=hn(),{toast:d}=ys();return a?m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsxs(wn,{children:[m.jsx(jn,{className:"text-white",children:"Personalización del Perfil"}),m.jsx(_n,{className:"text-gray-300",children:"Haz tu perfil más atractivo con fondos personalizados y videos de presentación"})]}),m.jsxs(Nn,{className:"space-y-6",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsx(co,{className:"text-white text-lg font-semibold",children:"Imagen de Fondo"}),e?m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"w-full h-32 bg-cover bg-center rounded-lg border border-white/20",style:{backgroundImage:`url(${e})`}}),m.jsx(Ve,{size:"sm",variant:"destructive",onClick:()=>{s(""),d({title:"Fondo removido",description:"Se ha removido la imagen de fondo"})},className:"absolute top-2 right-2",children:m.jsx(ss,{className:"w-4 h-4"})})]}):m.jsxs("div",{className:"border-2 border-dashed border-white/30 rounded-lg p-8 text-center",children:[m.jsx(vt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-300 mb-4",children:"Sube una imagen de fondo para tu perfil"}),m.jsx("input",{type:"file",accept:"image/*",onChange:e=>h(void 0,null,(function*(){var t;const r=null==(t=e.target.files)?void 0:t[0];if(r&&c)if(r.type.startsWith("image/")){n(!0);try{const e=r.name.split(".").pop(),t=`${c.id}/background.${e}`,{error:a}=yield cn.storage.from("profile-media").upload(t,r,{upsert:!0});if(a)throw a;const{data:i}=cn.storage.from("profile-media").getPublicUrl(t);s(i.publicUrl),d({title:"Fondo actualizado",description:"Tu imagen de fondo se ha actualizado correctamente"})}catch(a){console.error("Error uploading background:",a),d({title:"Error",description:"No se pudo subir la imagen de fondo",variant:"destructive"})}finally{n(!1)}}else d({title:"Error",description:"Por favor selecciona una imagen válida",variant:"destructive"})})),className:"hidden",id:"background-upload",disabled:i}),m.jsx("label",{htmlFor:"background-upload",children:m.jsx(Ve,{size:"sm",disabled:i,className:"bg-purple-600 hover:bg-purple-700",asChild:!0,children:m.jsxs("span",{className:"cursor-pointer",children:[m.jsx(Ht,{className:"w-4 h-4 mr-2"}),i?"Subiendo...":"Seleccionar Imagen"]})})})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx(co,{className:"text-white text-lg font-semibold",children:"Video de Presentación"}),t?m.jsxs("div",{className:"relative",children:[m.jsx("video",{src:t,className:"w-full h-48 object-cover rounded-lg border border-white/20",controls:!0,preload:"metadata"}),m.jsx(Ve,{size:"sm",variant:"destructive",onClick:()=>{r(""),d({title:"Video removido",description:"Se ha removido el video de presentación"})},className:"absolute top-2 right-2",children:m.jsx(ss,{className:"w-4 h-4"})})]}):m.jsxs("div",{className:"border-2 border-dashed border-white/30 rounded-lg p-8 text-center",children:[m.jsx(Qt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-300 mb-2",children:"Sube un video de presentación"}),m.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Máximo 50MB - Formatos: MP4, WebM, MOV"}),m.jsx("input",{type:"file",accept:"video/*",onChange:e=>h(void 0,null,(function*(){var t;const s=null==(t=e.target.files)?void 0:t[0];if(s&&c)if(s.type.startsWith("video/"))if(s.size>52428800)d({title:"Error",description:"El video es muy grande. Máximo 50MB permitidos",variant:"destructive"});else{l(!0);try{const e=s.name.split(".").pop(),t=`${c.id}/presentation.${e}`,{error:a}=yield cn.storage.from("profile-media").upload(t,s,{upsert:!0});if(a)throw a;const{data:i}=cn.storage.from("profile-media").getPublicUrl(t);r(i.publicUrl),d({title:"Video actualizado",description:"Tu video de presentación se ha actualizado correctamente"})}catch(a){console.error("Error uploading video:",a),d({title:"Error",description:"No se pudo subir el video de presentación",variant:"destructive"})}finally{l(!1)}}else d({title:"Error",description:"Por favor selecciona un video válido",variant:"destructive"})})),className:"hidden",id:"video-upload",disabled:o}),m.jsx("label",{htmlFor:"video-upload",children:m.jsx(Ve,{size:"sm",disabled:o,className:"bg-purple-600 hover:bg-purple-700",asChild:!0,children:m.jsxs("span",{className:"cursor-pointer",children:[m.jsx(Ht,{className:"w-4 h-4 mr-2"}),o?"Subiendo...":"Seleccionar Video"]})})})]})]})]})]}):null},gl=({onClose:e})=>m.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in overflow-auto",children:m.jsxs(bn,{className:"max-w-lg w-[90vw] text-white relative",children:[m.jsxs(wn,{children:[m.jsx(jn,{children:m.jsxs("span",{className:"flex items-center gap-2",children:[m.jsx(Dt,{className:"w-6 h-6 text-purple-400"}),"¿Cómo publicar tu primer producto?"]})}),m.jsx(_n,{className:"text-gray-300",children:"Te guiamos paso a paso para publicar en Digital Emporium Genesis Hub."})]}),m.jsxs(Nn,{children:[m.jsxs("ol",{className:"list-decimal list-inside space-y-5 text-base text-gray-200 mb-6",children:[m.jsxs("li",{children:[m.jsxs("span",{className:"font-semibold text-white",children:["Haz clic en ",m.jsx(Pt,{className:"inline w-4 h-4 align-middle text-pink-400"})," “Publicar Producto”."]}),m.jsx("br",{}),"Encuentra el botón en la esquina superior derecha de la sección ",m.jsx("span",{className:"font-semibold text-purple-200",children:"Productos Digitales"}),"."]}),m.jsxs("li",{children:[m.jsx("span",{className:"font-semibold text-white",children:"Llena el formulario."}),m.jsx("br",{}),"Escribe el título, descripción y categoría de tu producto. Sube imágenes llamativas para tu producto."]}),m.jsxs("li",{children:[m.jsx("span",{className:"font-semibold text-white",children:"Agrega el archivo digital y precio."}),m.jsx("br",{}),"Sube tu archivo (PDF, ZIP, etc.) y pon precio. También puedes marcar tu curso como ",m.jsx("span",{className:"font-semibold text-green-400",children:"gratis"}),"."]}),m.jsxs("li",{children:[m.jsx("span",{className:"font-semibold text-white",children:"Haz clic en “Publicar Producto”."}),m.jsx("br",{}),"¡Tu producto será visible para otros usuarios!"]}),m.jsxs("li",{children:[m.jsx("span",{className:"font-semibold text-white",children:"Sigue tu progreso."}),m.jsx("br",{}),"Desde tu perfil, puedes ver tus productos, ventas y estadísticas."]})]}),m.jsx("div",{className:"flex flex-col items-center mt-2",children:m.jsxs(Ve,{onClick:e,className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white",children:[m.jsx(at,{className:"w-4 h-4 mr-2"})," ¡Entendido!"]})})]})]})}),vl=({onLogout:e})=>{const[t,s]=Ae.useState(!1),[r,a]=Ae.useState(!1),[i,n]=Ae.useState(!1),[o,d]=Ae.useState(!1),[u,p]=Ae.useState(!1),[f,x]=Ae.useState(!1),[g,v]=Ae.useState(!1),{user:y}=hn(),{toast:b}=ys(),w=bs(),[j,_]=Ae.useState({username:"",email:"",description:"",avatar_url:"",phone:"",background_url:"",presentation_video_url:""}),[N,k]=Ae.useState({currentPassword:"",newPassword:"",confirmPassword:""});Ae.useEffect((()=>{h(void 0,null,(function*(){if(y)try{const{data:e,error:t}=yield cn.from("profiles").select("*").eq("id",y.id).maybeSingle();if(t)return console.error("Error loading profile:",t),void b({title:"Error",description:"No se pudo cargar el perfil",variant:"destructive"});_(e?{username:e.username||"",email:e.email||y.email||"",description:e.description||"",avatar_url:e.avatar_url||"",phone:e.phone||"",background_url:e.background_url||"",presentation_video_url:e.presentation_video_url||""}:e=>{var t;return c(l({},e),{email:y.email||"",username:(null==(t=y.email)?void 0:t.split("@")[0])||""})})}catch(e){console.error("Error loading profile:",e),b({title:"Error",description:"No se pudo cargar el perfil",variant:"destructive"})}}))}),[y]);const S=()=>h(void 0,null,(function*(){if(N.currentPassword&&N.newPassword)if(N.newPassword===N.confirmPassword)if(N.newPassword.length<6)b({title:"Error",description:"La nueva contraseña debe tener al menos 6 caracteres",variant:"destructive"});else{p(!0);try{const{error:e}=yield cn.auth.updateUser({password:N.newPassword});if(e)throw e;b({title:"Contraseña actualizada",description:"Tu contraseña se ha cambiado correctamente"}),k({currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){console.error("Error changing password:",e),b({title:"Error",description:"No se pudo cambiar la contraseña",variant:"destructive"})}finally{p(!1)}}else b({title:"Error",description:"Las contraseñas no coinciden",variant:"destructive"});else b({title:"Error",description:"Por favor completa todos los campos",variant:"destructive"})})),C=()=>h(void 0,null,(function*(){if(!f&&e)try{console.log("Iniciando proceso de cierre de sesión..."),x(!0),yield e(),console.log("Cierre de sesión completado")}catch(t){console.error("Error durante el cierre de sesión:",t)}finally{x(!1)}}));return o?m.jsxs("div",{className:"space-y-6 min-h-screen relative",style:{backgroundImage:j.background_url?`url(${j.background_url})`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:[j.background_url&&m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),m.jsxs("div",{className:"relative z-10",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Configuración"}),m.jsx("p",{className:"text-gray-300",children:"Gestiona la seguridad de tu cuenta"})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx(Ve,{onClick:()=>d(!1),variant:"outline",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:"Volver al Perfil"}),m.jsxs(il,{children:[m.jsx(nl,{asChild:!0,children:m.jsxs(Ve,{variant:"destructive",className:"bg-red-600 hover:bg-red-700 border-red-600 text-white",disabled:f,children:[m.jsx(wt,{className:"w-4 h-4 mr-2"}),f?"Cerrando...":"Cerrar Sesión"]})}),m.jsxs(cl,{className:"bg-gray-900 border-gray-700",children:[m.jsxs(dl,{children:[m.jsx(hl,{className:"text-white",children:"¿Cerrar sesión?"}),m.jsx(ml,{className:"text-gray-300",children:"¿Estás seguro de que quieres cerrar tu sesión? Tendrás que iniciar sesión nuevamente para acceder a tu cuenta."})]}),m.jsxs(ul,{children:[m.jsx(fl,{className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:"Cancelar"}),m.jsx(pl,{onClick:C,disabled:f,className:"bg-red-600 hover:bg-red-700 text-white",children:f?"Cerrando...":"Cerrar Sesión"})]})]})]})]})]}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20 max-w-lg mx-auto",children:[m.jsxs(wn,{children:[m.jsx(jn,{className:"text-white",children:"Cambiar Contraseña"}),m.jsx(_n,{className:"text-gray-300",children:"Actualiza tu contraseña para mantener tu cuenta segura"})]}),m.jsxs(Nn,{className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"current-password",className:"text-white",children:"Contraseña Actual"}),m.jsx(Sn,{id:"current-password",type:"password",value:N.currentPassword,onChange:e=>k((t=>c(l({},t),{currentPassword:e.target.value}))),placeholder:"Ingresa tu contraseña actual",className:"border-white/20 text-white bg-slate-50"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"new-password",className:"text-white",children:"Nueva Contraseña"}),m.jsx(Sn,{id:"new-password",type:"password",value:N.newPassword,onChange:e=>k((t=>c(l({},t),{newPassword:e.target.value}))),placeholder:"Ingresa tu nueva contraseña",className:"border-white/20 text-white bg-slate-50"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"confirm-password",className:"text-white",children:"Confirmar Nueva Contraseña"}),m.jsx(Sn,{id:"confirm-password",type:"password",value:N.confirmPassword,onChange:e=>k((t=>c(l({},t),{confirmPassword:e.target.value}))),placeholder:"Confirma tu nueva contraseña",className:"border-white/20 text-white bg-slate-50"})]}),m.jsx(Ve,{onClick:S,disabled:u,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:u?"Cambiando...":"Cambiar Contraseña"})]})]}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsx(jn,{className:"text-white",children:"Información de Seguridad"})}),m.jsx(Nn,{children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[m.jsx("p",{className:"text-lg font-bold text-white",children:"Última sesión"}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Hace 2 minutos"})]}),m.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[m.jsx("p",{className:"text-lg font-bold text-white",children:"Dispositivos activos"}),m.jsx("p",{className:"text-gray-300 text-sm",children:"1 dispositivo"})]}),m.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[m.jsx("p",{className:"text-lg font-bold text-white",children:"Cuenta creada"}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Hace 30 días"})]})]})})]})]})]}):m.jsxs("div",{className:"space-y-6 min-h-screen relative",style:{backgroundImage:j.background_url?`url(${j.background_url})`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:[j.background_url&&m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),m.jsxs("div",{className:"relative z-10",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Mi Perfil"}),m.jsx("p",{className:"text-gray-300",children:"Gestiona tu información personal"})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx(Ve,{variant:"outline",className:"bg-white/10 border-purple-400 text-purple-300 hover:bg-purple-800 hover:text-white",onClick:()=>v(!0),children:"Tutorial"}),m.jsx(Ve,{onClick:()=>t?h(void 0,null,(function*(){if(y){n(!0);try{const{error:e}=yield cn.from("profiles").upsert({id:y.id,username:j.username,email:j.email,description:j.description,avatar_url:j.avatar_url,phone:j.phone,background_url:j.background_url,presentation_video_url:j.presentation_video_url,updated_at:(new Date).toISOString()});if(e)throw e;s(!1),b({title:"Perfil actualizado",description:"Tu información se ha guardado correctamente"})}catch(e){console.error("Error saving profile:",e),b({title:"Error",description:"No se pudo guardar el perfil",variant:"destructive"})}finally{n(!1)}}})):s(!0),disabled:i,size:w?"sm":"lg",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 shadow-lg hover:shadow-xl transition-all duration-200 "+(w?"px-4 py-2 text-sm font-medium":"px-8 py-4 text-lg font-semibold"),children:t?m.jsxs(m.Fragment,{children:[m.jsx(At,{className:""+(w?"w-4 h-4 mr-2":"w-6 h-6 mr-3")}),i?"Guardando...":"Guardar Cambios"]}):m.jsxs(m.Fragment,{children:[m.jsx(Ft,{className:""+(w?"w-4 h-4 mr-2":"w-6 h-6 mr-3")}),"Editar Perfil"]})}),m.jsxs(il,{children:[m.jsx(nl,{asChild:!0,children:m.jsxs(Ve,{variant:"destructive",size:"lg",className:"bg-red-600 hover:bg-red-700 border-red-600 text-white px-8 py-4 text-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-200",disabled:f,children:[m.jsx(wt,{className:"w-6 h-6 mr-3"}),f?"Cerrando...":"Cerrar Sesión"]})}),m.jsxs(cl,{className:"bg-gray-900 border-gray-700",children:[m.jsxs(dl,{children:[m.jsx(hl,{className:"text-white",children:"¿Cerrar sesión?"}),m.jsx(ml,{className:"text-gray-300",children:"¿Estás seguro de que quieres cerrar tu sesión? Tendrás que iniciar sesión nuevamente para acceder a tu cuenta."})]}),m.jsxs(ul,{children:[m.jsx(fl,{className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:"Cancelar"}),m.jsx(pl,{onClick:C,disabled:f,className:"bg-red-600 hover:bg-red-700 text-white",children:f?"Cerrando...":"Cerrar Sesión"})]})]})]})]})]}),j.presentation_video_url&&!t&&m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsx(jn,{className:"text-white",children:"Video de Presentación"})}),m.jsx(Nn,{children:m.jsx("video",{src:j.presentation_video_url,className:"w-full max-w-2xl mx-auto rounded-lg",controls:!0,preload:"metadata"})})]}),m.jsx(xl,{backgroundUrl:j.background_url,videoUrl:j.presentation_video_url,onBackgroundChange:e=>_((t=>c(l({},t),{background_url:e}))),onVideoChange:e=>_((t=>c(l({},t),{presentation_video_url:e}))),isEditing:t}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsx(jn,{className:"text-white",children:"Foto de Perfil"})}),m.jsxs(Nn,{className:"flex flex-col items-center space-y-4",children:[m.jsxs("div",{className:"relative",children:[m.jsxs(Fn,{className:"w-32 h-32",children:[m.jsx(Vn,{src:j.avatar_url,alt:j.username}),m.jsx(qn,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white text-2xl",children:j.username?j.username.substring(0,2).toUpperCase():"U"})]}),t&&m.jsxs(m.Fragment,{children:[m.jsx("input",{type:"file",accept:"image/*",onChange:e=>h(void 0,null,(function*(){var t;const s=null==(t=e.target.files)?void 0:t[0];if(s&&y){a(!0);try{const e=s.name.split(".").pop(),t=`${y.id}/avatar.${e}`,{error:r}=yield cn.storage.from("avatars").upload(t,s,{upsert:!0});if(r)throw r;const{data:a}=cn.storage.from("avatars").getPublicUrl(t);_((e=>c(l({},e),{avatar_url:a.publicUrl}))),b({title:"Foto actualizada",description:"Tu foto de perfil se ha actualizado correctamente"})}catch(r){console.error("Error uploading avatar:",r),b({title:"Error",description:"No se pudo subir la foto de perfil",variant:"destructive"})}finally{a(!1)}}})),className:"hidden",id:"avatar-upload",disabled:r}),m.jsx("label",{htmlFor:"avatar-upload",children:m.jsx(Ve,{size:"sm",className:"absolute bottom-0 right-0 rounded-full w-8 h-8 p-0 bg-purple-600 hover:bg-purple-700",disabled:r,asChild:!0,children:m.jsx("span",{className:"cursor-pointer",children:m.jsx(Ye,{className:"w-4 h-4"})})})})]})]}),m.jsx("p",{className:"text-gray-300 text-sm text-center",children:t?r?"Subiendo imagen...":"Haz clic en el ícono para cambiar tu foto":"Tu foto de perfil actual"})]})]}),m.jsxs(bn,{className:"lg:col-span-2 bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsxs(wn,{children:[m.jsx(jn,{className:"text-white",children:"Información Personal"}),m.jsx(_n,{className:"text-gray-300",children:"Actualiza tu información de perfil"})]}),m.jsxs(Nn,{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"username",className:"text-white",children:"Nombre de Usuario"}),m.jsx(Sn,{id:"username",value:j.username,onChange:e=>_(c(l({},j),{username:e.target.value})),disabled:!t,placeholder:"Tu nombre de usuario",className:"border-white/20 text-white disabled:opacity-50 bg-slate-950"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"email",className:"text-white",children:"Email"}),m.jsx(Sn,{id:"email",type:"email",value:j.email,onChange:e=>_(c(l({},j),{email:e.target.value})),disabled:!t,placeholder:"tu@email.com",className:"border-white/20 text-white disabled:opacity-50 bg-slate-950"})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"phone",className:"text-white",children:"Teléfono"}),m.jsx(Sn,{id:"phone",value:j.phone,onChange:e=>_(c(l({},j),{phone:e.target.value})),disabled:!t,placeholder:"+1234567890",className:"border-white/20 text-white disabled:opacity-50 bg-slate-950"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"description",className:"text-white",children:"Descripción"}),m.jsx(uo,{id:"description",value:j.description,onChange:e=>_(c(l({},j),{description:e.target.value})),disabled:!t,rows:4,className:"bg-white/10 border-white/20 text-white disabled:opacity-50 resize-none",placeholder:"Cuéntanos sobre ti y tus productos..."})]})]})]})]}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsx(jn,{className:"text-white",children:"Estadísticas de la Cuenta"})}),m.jsx(Nn,{children:m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-2xl font-bold text-white",children:"24"}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Productos"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-2xl font-bold text-white",children:"156"}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Ventas"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-2xl font-bold text-white",children:"4.8"}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Rating"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-2xl font-bold text-white",children:"$2,847"}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Ingresos"})]})]})})]})]}),g&&m.jsx(gl,{onClose:()=>v(!1)})]})},yl=({onUserSelect:e})=>{const{topSellers:t,loading:s}=(()=>{const[e,t]=Ae.useState([]),[s,r]=Ae.useState(!0),{toast:a}=ys(),i=()=>h(void 0,null,(function*(){try{r(!0);const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0),{data:i,error:n}=yield cn.from("products").select("\n          user_id,\n          sales,\n          price,\n          created_at\n        ").eq("status","active").gte("created_at",s.toISOString()).lte("created_at",a.toISOString()).gt("sales",0);if(n)throw n;const o=new Map;null==i||i.forEach((e=>{const t=e.user_id,s=o.get(t)||{totalSales:0,totalRevenue:0,totalProducts:0};o.set(t,{totalSales:s.totalSales+e.sales,totalRevenue:s.totalRevenue+e.sales*e.price,totalProducts:s.totalProducts+1})}));const d=Array.from(o.keys());if(0===d.length)return void t([]);const{data:u,error:h}=yield cn.from("profiles").select("id, username, avatar_url").in("id",d);if(h)throw h;const m=((null==u?void 0:u.map((e=>{const t=o.get(e.id);return l({id:e.id,username:e.username||"Vendedor Anónimo",avatar_url:e.avatar_url},t)})))||[]).sort(((e,t)=>t.totalSales-e.totalSales)).slice(0,10).map(((e,t)=>c(l({},e),{rank:t+1})));t(m)}catch(e){console.error("Error fetching top sellers:",e),a({title:"Error",description:"No se pudieron cargar los vendedores destacados",variant:"destructive"})}finally{r(!1)}}));return Ae.useEffect((()=>{i()}),[]),{topSellers:e,loading:s,refreshTopSellers:i}})(),r=e=>{switch(e){case 1:return m.jsx(Zt,{className:"w-6 h-6 text-yellow-400"});case 2:return m.jsx(_t,{className:"w-6 h-6 text-gray-300"});case 3:return m.jsx(Ke,{className:"w-6 h-6 text-amber-600"});default:return m.jsx("div",{className:"w-6 h-6 flex items-center justify-center text-lg font-bold text-white",children:e})}},a=e=>{switch(e){case 1:return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";case 2:return"bg-gray-500/20 text-gray-300 border-gray-500/30";case 3:return"bg-amber-600/20 text-amber-300 border-amber-600/30";default:return"bg-blue-500/20 text-blue-300 border-blue-500/30"}},i=()=>(new Date).toLocaleDateString("es-ES",{month:"long",year:"numeric"}),n=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"USD"}).format(e);return s?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"🏆 Ranking del Mes"}),m.jsx("p",{className:"text-gray-300",children:"Cargando vendedores destacados..."})]}),m.jsx("div",{className:"flex items-center justify-center h-64",children:m.jsx("div",{className:"text-white text-xl",children:"Cargando..."})})]}):m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-3xl font-bold text-white mb-2",children:["🏆 Ranking de Vendedores - ",i()]}),m.jsx("p",{className:"text-gray-300",children:"Los vendedores más exitosos del mes actual"})]}),0===t.length?m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsxs(Nn,{className:"p-8 text-center",children:[m.jsx(zt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Sin ventas este mes"}),m.jsxs("p",{className:"text-gray-400",children:["Aún no hay vendedores con ventas registradas en ",i()]})]})}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((t=>m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20 hover:bg-white/15 transition-all duration-300 cursor-pointer "+(t.rank<=3?"ring-2 ring-yellow-500/30":""),onClick:()=>null==e?void 0:e(t.id),children:[m.jsx(wn,{className:"pb-3",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[r(t.rank),m.jsxs(gn,{className:a(t.rank),children:["#",t.rank]})]}),1===t.rank&&m.jsx("div",{className:"text-xs font-bold text-yellow-400 bg-yellow-500/20 px-2 py-1 rounded",children:"¡CAMPEÓN!"})]})}),m.jsxs(Nn,{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs(Fn,{className:"w-12 h-12",children:[m.jsx(Vn,{src:t.avatar_url}),m.jsx(qn,{className:"bg-purple-500/20 text-white",children:t.username.charAt(0).toUpperCase()})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-white font-semibold",children:t.username}),m.jsx("p",{className:"text-gray-400 text-sm",children:"Vendedor estrella"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[m.jsx(Ct,{className:"w-4 h-4"}),m.jsx("span",{className:"text-sm",children:"Productos vendidos"})]}),m.jsx("span",{className:"text-white font-bold",children:t.totalSales})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[m.jsx(dt,{className:"w-4 h-4"}),m.jsx("span",{className:"text-sm",children:"Ingresos totales"})]}),m.jsx("span",{className:"text-green-400 font-bold",children:n(t.totalRevenue)})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[m.jsx(zt,{className:"w-4 h-4"}),m.jsx("span",{className:"text-sm",children:"Productos activos"})]}),m.jsx("span",{className:"text-blue-400 font-bold",children:t.totalProducts})]})]}),m.jsx("div",{className:"pt-3 border-t border-white/10",children:m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-gray-400 text-xs",children:"Promedio por producto"}),m.jsx("p",{className:"text-white font-bold",children:n(t.totalRevenue/t.totalProducts)})]})})]})]},t.id)))})]})},bl=e=>{const[t,s]=Ae.useState(!1),[r,a]=Ae.useState(0),[i,n]=Ae.useState(!1),{user:o}=hn(),{toast:l}=ys();return Ae.useEffect((()=>{e&&(h(void 0,null,(function*(){if(o&&e)try{const{data:t,error:r}=yield cn.from("video_likes").select("id").eq("video_id",e).eq("user_id",o.id).single();if(r&&"PGRST116"!==r.code)throw r;s(!!t)}catch(t){console.error("Error checking like status:",t)}})),h(void 0,null,(function*(){try{const{data:t,error:s}=yield cn.from("videos").select("likes").eq("id",e).single();if(s)throw s;a((null==t?void 0:t.likes)||0)}catch(t){console.error("Error getting likes count:",t)}})))}),[e,o]),{isLiked:t,likesCount:r,loading:i,toggleLike:()=>h(void 0,null,(function*(){if(o&&!i){n(!0);try{if(t){const{error:t}=yield cn.from("video_likes").delete().eq("video_id",e).eq("user_id",o.id);if(t)throw t;s(!1),a((e=>e-1))}else{const{error:t}=yield cn.from("video_likes").insert([{video_id:e,user_id:o.id}]);if(t)throw t;s(!0),a((e=>e+1))}}catch(r){console.error("Error toggling like:",r),l({title:"Error",description:"No se pudo procesar el like",variant:"destructive"})}finally{n(!1)}}}))}},wl=e=>{const[t,s]=Ae.useState([]),[r,a]=Ae.useState(!0),{user:i}=hn(),{toast:n}=ys(),o=()=>h(void 0,null,(function*(){if(e)try{const{data:t,error:r}=yield cn.from("video_comments").select("*").eq("video_id",e).order("created_at",{ascending:!1});if(r)throw r;s(t||[])}catch(t){console.error("Error fetching comments:",t),s([])}finally{a(!1)}else a(!1)}));return Ae.useEffect((()=>{o()}),[e]),{comments:t,loading:r,addComment:t=>h(void 0,null,(function*(){if(i&&e)try{const{error:s}=yield cn.from("video_comments").insert([{video_id:e,user_id:i.id,comment:t.trim()}]);if(s)throw s;n({title:"Comentario añadido",description:"Tu comentario se ha publicado correctamente"}),yield o()}catch(s){console.error("Error adding comment:",s),n({title:"Error",description:"No se pudo añadir el comentario",variant:"destructive"})}})),deleteComment:e=>h(void 0,null,(function*(){if(i)try{const{error:t}=yield cn.from("video_comments").delete().eq("id",e).eq("user_id",i.id);if(t)throw t;n({title:"Comentario eliminado",description:"El comentario se ha eliminado correctamente"}),yield o()}catch(t){console.error("Error deleting comment:",t),n({title:"Error",description:"No se pudo eliminar el comentario",variant:"destructive"})}})),refreshComments:o}},jl=()=>{const[e,t]=Ae.useState([]),[s,r]=Ae.useState(!0),[a,i]=Ae.useState(null),{user:n}=hn(),{toast:o}=ys(),d=()=>h(void 0,null,(function*(){try{r(!0),i(null);const{data:e,error:s}=yield cn.from("videos").select("*").eq("status","active").order("created_at",{ascending:!1});if(s)throw console.error("Error fetching videos:",s),s;console.log("Videos fetched successfully:",(null==e?void 0:e.length)||0),t(e||[])}catch(e){console.error("Error in fetchVideos:",e),i("Error al cargar videos"),t([])}finally{r(!1)}}));return Ae.useEffect((()=>{d()}),[]),{videos:e,loading:s,error:a,createVideo:e=>h(void 0,null,(function*(){if(!n)return console.error("No user authenticated for video creation"),o({title:"Error",description:"Debes estar autenticado para crear videos",variant:"destructive"}),{error:"Not authenticated"};try{console.log("Creating video with data:",c(l({},e),{user_id:n.id}));const t=c(l({},e),{user_id:n.id,likes:0,comments:0,views:0});console.log("Inserting video data:",t);const{data:s,error:r}=yield cn.from("videos").insert([t]).select().single();if(r)throw console.error("Database insert error:",r),r;return console.log("Video created successfully in database:",s),o({title:"¡Video creado!",description:"Tu video se ha publicado correctamente"}),yield d(),{data:s,error:null}}catch(t){return console.error("Error in createVideo:",t),o({title:"Error",description:`No se pudo crear el video: ${t.message||"Error desconocido"}`,variant:"destructive"}),{error:t}}})),uploadVideoFile:e=>h(void 0,null,(function*(){if(!n)return console.error("No user authenticated for video upload"),null;try{console.log("Starting video upload:",{fileName:e.name,fileSize:e.size,fileType:e.type,userId:n.id});const t=e.name.split(".").pop(),s=`${n.id}/videos/${Date.now()}.${t}`;console.log("Uploading to storage path:",s);const{data:r,error:a}=yield cn.storage.from("videos").upload(s,e,{cacheControl:"3600",upsert:!1});if(a)throw console.error("Storage upload error:",a),a;console.log("Upload successful, data:",r);const{data:i}=cn.storage.from("videos").getPublicUrl(s);return console.log("Public URL generated:",i.publicUrl),i.publicUrl}catch(t){return console.error("Error in uploadVideoFile:",t),o({title:"Error de subida",description:`No se pudo subir el video: ${t.message||"Error desconocido"}`,variant:"destructive"}),null}})),uploadThumbnail:e=>h(void 0,null,(function*(){if(!n)return console.error("No user authenticated for thumbnail upload"),null;try{console.log("Starting thumbnail upload:",{fileName:e.name,fileSize:e.size,fileType:e.type,userId:n.id});const t=e.name.split(".").pop(),s=`${n.id}/thumbnails/${Date.now()}.${t}`;console.log("Uploading thumbnail to storage path:",s);const{data:r,error:a}=yield cn.storage.from("videos").upload(s,e,{cacheControl:"3600",upsert:!1});if(a)throw console.error("Thumbnail storage upload error:",a),a;console.log("Thumbnail upload successful, data:",r);const{data:i}=cn.storage.from("videos").getPublicUrl(s);return console.log("Thumbnail public URL generated:",i.publicUrl),i.publicUrl}catch(t){return console.error("Error in uploadThumbnail:",t),o({title:"Error de subida",description:`No se pudo subir la portada: ${t.message||"Error desconocido"}`,variant:"destructive"}),null}})),incrementViews:e=>h(void 0,null,(function*(){try{const{data:t}=yield cn.from("videos").select("views").eq("id",e).single();t&&(yield cn.from("videos").update({views:t.views+1}).eq("id",e))}catch(t){console.error("Error incrementing views:",t)}})),refreshVideos:d}},_l=({video:e,autoplay:t=!1})=>{const[s,r]=Ae.useState(!1),[a,i]=Ae.useState(!1),[n,o]=Ae.useState(!1),[l,c]=Ae.useState(""),[d,u]=Ae.useState(!1),[p,f]=Ae.useState(!1),[x,g]=Ae.useState(!1),v=Ae.useRef(null),y=Ae.useRef(null),{user:b}=hn(),{incrementViews:w}=jl(),{isLiked:j,likesCount:_,toggleLike:N}=bl(e.id),{comments:k,loading:S,addComment:C,deleteComment:E}=wl(e.id),T=()=>{v.current&&!p&&(s?v.current.pause():(v.current.play().catch((e=>{console.error("Error playing video:",e),f(!0)})),d||(w(e.id),u(!0))),r(!s))},P=()=>h(void 0,null,(function*(){l.trim()&&(yield C(l),c(""))}));return Ae.useEffect((()=>{const e=()=>{const e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement);g(e)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("msfullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("msfullscreenchange",e)}}),[]),Ae.useEffect((()=>{t&&v.current&&!p&&(v.current.play().catch((e=>{console.error("Autoplay failed:",e),f(!0)})),r(!0),d||(w(e.id),u(!0)))}),[t,p]),!e.video_url||p?m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-6",children:m.jsx("div",{className:"aspect-video bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-lg flex items-center justify-center",children:m.jsx("p",{className:"text-white text-lg",children:p?"Error al cargar el video":"Video no disponible"})})})}):m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20 overflow-hidden",children:m.jsxs(Nn,{className:"p-0",children:[m.jsxs("div",{ref:y,className:"relative aspect-video bg-black group "+(x?"fixed inset-0 z-50 bg-black flex items-center justify-center":""),children:[m.jsx("video",{ref:v,src:e.video_url,poster:e.thumbnail_url||void 0,className:(x?"max-w-full max-h-full object-contain":"w-full h-full object-cover")+" cursor-pointer",onClick:()=>{T()},onPlay:()=>r(!0),onPause:()=>r(!1),onError:()=>{console.error("Video failed to load"),f(!0)},loop:!0,playsInline:!0,preload:"metadata",muted:a}),m.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center",children:m.jsx(Ve,{variant:"ghost",size:"lg",onClick:T,className:"bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-3 md:p-4",children:s?m.jsx(Et,{className:"w-6 h-6 md:w-8 md:h-8 text-white"}):m.jsx(Tt,{className:"w-6 h-6 md:w-8 md:h-8 text-white fill-white"})})}),m.jsxs("div",{className:"absolute top-2 md:top-4 right-2 md:right-4 opacity-0 group-hover:opacity-100 transition-opacity flex gap-2",children:[m.jsx(Ve,{variant:"ghost",size:"sm",onClick:()=>{v.current&&!p&&(v.current.muted=!a,i(!a))},className:"bg-black/50 hover:bg-black/70 text-white p-2",children:a?m.jsx(ts,{className:"w-3 h-3 md:w-4 md:h-4"}):m.jsx(es,{className:"w-3 h-3 md:w-4 md:h-4"})}),m.jsx(Ve,{variant:"ghost",size:"sm",onClick:()=>h(void 0,null,(function*(){if(y.current)try{x?document.exitFullscreen?yield document.exitFullscreen():document.webkitExitFullscreen?yield document.webkitExitFullscreen():document.msExitFullscreen&&(yield document.msExitFullscreen()):y.current.requestFullscreen?yield y.current.requestFullscreen():y.current.webkitRequestFullscreen?yield y.current.webkitRequestFullscreen():y.current.msRequestFullscreen&&(yield y.current.msRequestFullscreen())}catch(e){console.error("Error toggling fullscreen:",e)}})),className:"bg-black/50 hover:bg-black/70 text-white p-2",children:m.jsx(jt,{className:"w-3 h-3 md:w-4 md:h-4"})})]})]}),!x&&m.jsxs("div",{className:"p-3 md:p-4 space-y-3 md:space-y-4",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-white font-semibold text-base md:text-lg mb-2",children:e.title}),e.description&&m.jsx("p",{className:"text-gray-300 text-sm",children:e.description})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center space-x-3 md:space-x-4",children:[m.jsxs(Ve,{variant:"ghost",size:"sm",onClick:N,className:(j?"text-red-400 hover:text-red-300":"text-gray-400 hover:text-white")+" hover:bg-white/10 transition-colors p-2",children:[m.jsx(gt,{className:"w-4 h-4 md:w-5 md:h-5 mr-1 "+(j?"fill-current":"")}),m.jsx("span",{className:"text-sm",children:_})]}),m.jsxs(Ve,{variant:"ghost",size:"sm",onClick:()=>o(!n),className:"text-gray-400 hover:text-white hover:bg-white/10 p-2",children:[m.jsx(kt,{className:"w-4 h-4 md:w-5 md:h-5 mr-1"}),m.jsx("span",{className:"text-sm",children:k.length})]}),m.jsx(Ve,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white hover:bg-white/10 p-2",children:m.jsx(It,{className:"w-4 h-4 md:w-5 md:h-5"})})]}),m.jsxs("span",{className:"text-gray-500 text-xs md:text-sm",children:[e.views.toLocaleString()," vistas"]})]}),n&&m.jsxs("div",{className:"space-y-3 md:space-y-4 pt-3 md:pt-4 border-t border-white/10",children:[b&&m.jsxs("div",{className:"flex space-x-2",children:[m.jsx(Sn,{placeholder:"Añade un comentario...",value:l,onChange:e=>c(e.target.value),className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400 text-sm",onKeyPress:e=>"Enter"===e.key&&P()}),m.jsx(Ve,{size:"sm",onClick:P,disabled:!l.trim(),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-3",children:m.jsx(Ot,{className:"w-3 h-3 md:w-4 md:h-4"})})]}),m.jsx("div",{className:"space-y-2 md:space-y-3 max-h-48 md:max-h-60 overflow-y-auto",children:S?m.jsx("p",{className:"text-gray-400 text-sm",children:"Cargando comentarios..."}):0===k.length?m.jsx("p",{className:"text-gray-400 text-sm",children:"No hay comentarios aún"}):k.map((e=>m.jsxs("div",{className:"flex space-x-2 md:space-x-3",children:[m.jsx(Fn,{className:"w-6 h-6 md:w-8 md:h-8 flex-shrink-0",children:m.jsx(qn,{className:"bg-purple-500/20 text-white text-xs",children:m.jsx(Xt,{className:"w-3 h-3 md:w-4 md:h-4"})})}),m.jsxs("div",{className:"flex-1 space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("span",{className:"text-white text-xs md:text-sm font-medium",children:"Usuario"}),m.jsx("span",{className:"text-gray-400 text-xs",children:new Date(e.created_at).toLocaleDateString()})]}),b&&b.id===e.user_id&&m.jsx(Ve,{variant:"ghost",size:"sm",onClick:()=>E(e.id),className:"text-gray-400 hover:text-red-400 hover:bg-white/10 p-1 h-auto",children:m.jsx(qt,{className:"w-3 h-3"})})]}),m.jsx("p",{className:"text-gray-300 text-xs md:text-sm",children:e.comment})]})]},e.id)))})]})]})]})})};function Nl(...e){const t=e[0];if(1===e.length)return t;const s=()=>{const s=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const r=s.reduce(((t,{useScope:s,scopeName:r})=>{const a=s(e)[`__scope${r}`];return l(l({},t),a)}),{});return Ae.useMemo((()=>({[`__scope${t.scopeName}`]:r})),[r])}};return s.scopeName=t.scopeName,s}var kl="Progress",Sl=100,[Cl,El]=function(e,t=[]){let s=[];const r=()=>{const t=s.map((e=>Ae.createContext(e)));return function(s){const r=(null==s?void 0:s[e])||t;return Ae.useMemo((()=>({[`__scope${e}`]:c(l({},s),{[e]:r})})),[s,r])}};return r.scopeName=e,[function(t,r){const a=Ae.createContext(r),i=s.length;function n(t){const s=t,{scope:r,children:n}=s,o=d(s,["scope","children"]),l=(null==r?void 0:r[e][i])||a,c=Ae.useMemo((()=>o),Object.values(o));return m.jsx(l.Provider,{value:c,children:n})}return s=[...s,r],n.displayName=t+"Provider",[n,function(s,n){const o=(null==n?void 0:n[e][i])||a,l=Ae.useContext(o);if(l)return l;if(void 0!==r)return r;throw new Error(`\`${s}\` must be used within \`${t}\``)}]},Nl(r,...t)]}(kl),[Tl,Pl]=Cl(kl),Al=Ae.forwardRef(((e,t)=>{const s=e,{__scopeProgress:r,value:a=null,max:i,getValueLabel:n=Il}=s,o=d(s,["__scopeProgress","value","max","getValueLabel"]);!i&&0!==i||Ll(i)||console.error(`Invalid prop \`max\` of value \`${`${i}`}\` supplied to \`${"Progress"}\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`);const u=Ll(i)?i:Sl;null===a||Ml(a,u)||console.error(function(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:\n  - a positive number\n  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)\n  - \`null\` or \`undefined\` if the progress is indeterminate.\n\nDefaulting to \`null\`.`}(`${a}`,"Progress"));const h=Ml(a,u)?a:null,p=Dl(h)?n(h,u):void 0;return m.jsx(Tl,{scope:r,value:h,max:u,children:m.jsx(N.div,c(l({"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":Dl(h)?h:void 0,"aria-valuetext":p,role:"progressbar","data-state":$l(h,u),"data-value":null!=h?h:void 0,"data-max":u},o),{ref:t}))})}));Al.displayName=kl;var Rl="ProgressIndicator",Ol=Ae.forwardRef(((e,t)=>{var s;const r=e,{__scopeProgress:a}=r,i=d(r,["__scopeProgress"]),n=Pl(Rl,a);return m.jsx(N.div,c(l({"data-state":$l(n.value,n.max),"data-value":null!=(s=n.value)?s:void 0,"data-max":n.max},i),{ref:t}))}));function Il(e,t){return`${Math.round(e/t*100)}%`}function $l(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function Dl(e){return"number"==typeof e}function Ll(e){return Dl(e)&&!isNaN(e)&&e>0}function Ml(e,t){return Dl(e)&&!isNaN(e)&&e<=t&&e>=0}Ol.displayName=Rl;var Ul=Al,Fl=Ol;const Vl=Ae.forwardRef(((e,t)=>{var s=e,{className:r,value:a}=s,i=d(s,["className","value"]);return m.jsx(Ul,c(l({ref:t,className:Ue("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r)},i),{children:m.jsx(Fl,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}))}));Vl.displayName=Ul.displayName;const ql=({isOpen:e,onClose:t,onCreateVideo:s})=>{const[r,a]=Ae.useState(""),[i,n]=Ae.useState(""),[o,l]=Ae.useState(null),[c,d]=Ae.useState(null),[u,p]=Ae.useState(null),[f,x]=Ae.useState(!1),[g,v]=Ae.useState(0),{createVideo:y,uploadVideoFile:b,uploadThumbnail:w}=jl(),{toast:j}=ys(),{user:_}=hn(),N=bs();return m.jsx(Yn,{open:e,onOpenChange:t,children:m.jsxs(to,{className:"sm:max-w-md bg-white/10 backdrop-blur-lg border-white/20 text-white max-h-[90vh] overflow-y-auto",children:[m.jsx(so,{children:m.jsxs(ao,{className:"text-white flex items-center space-x-2",children:[N?m.jsx(ft,{className:"w-5 h-5"}):m.jsx(Qt,{className:"w-5 h-5"}),m.jsx("span",{children:N?"Crear Contenido":"Crear Video"})]})}),m.jsxs("form",{onSubmit:e=>h(void 0,null,(function*(){if(e.preventDefault(),console.log("Starting video submission process..."),console.log("User authenticated:",!!_),console.log("Form data:",{title:r,description:i,hasVideo:!!o,hasThumbnail:!!c}),_)if(r.trim()&&i.trim())if(o){x(!0),v(10);try{console.log("Step 1: Getting video duration..."),v(20);const e=yield(m=o,new Promise((e=>{const t=document.createElement("video");t.preload="metadata",t.onloadedmetadata=()=>{window.URL.revokeObjectURL(t.src),e(t.duration)},t.onerror=()=>{console.warn("Could not determine video duration"),e(0)},t.src=URL.createObjectURL(m)})));console.log("Video duration:",e,"seconds"),console.log("Step 2: Uploading video file..."),v(40);const f=yield b(o);if(console.log("Video upload result:",f),!f)throw new Error("Failed to upload video file - no URL returned");v(70);let x=null;c&&(console.log("Step 3: Uploading thumbnail..."),v(80),x=yield w(c),console.log("Thumbnail upload result:",x)),v(90),console.log("Step 4: Creating video record in database...");const g={title:r.trim(),description:i.trim(),video_url:f,thumbnail_url:x,duration:(h=e,`${Math.floor(h/60)}:${Math.floor(h%60).toString().padStart(2,"0")}`),product_id:null,status:"active"};console.log("Video data to insert:",g);const j=yield y(g);if(console.log("Create video result:",j),j.error)throw new Error(j.error.message||"Failed to create video record");v(100),console.log("Video creation completed successfully!"),a(""),n(""),l(null),d(null),u&&(URL.revokeObjectURL(u),p(null)),v(0),t(),s&&s(g)}catch(f){console.error("Error during video submission:",f),j({title:"Error",description:`No se pudo subir el video: ${f.message||"Error desconocido"}`,variant:"destructive"})}finally{x(!1),v(0)}var h,m}else j({title:"Video requerido",description:"Por favor selecciona un archivo de video",variant:"destructive"});else j({title:"Campos requeridos",description:"Por favor completa el título y la descripción",variant:"destructive"});else j({title:"Error de autenticación",description:"Debes estar logueado para publicar videos",variant:"destructive"})})),className:"space-y-4",children:[f&&m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center space-x-2 text-blue-400",children:[m.jsx(rt,{className:"w-4 h-4"}),m.jsx("span",{className:"text-sm",children:N?"Subiendo archivo...":"Subiendo video..."})]}),m.jsx(Vl,{value:g,className:"h-2"}),m.jsxs("p",{className:"text-xs text-gray-400",children:[g,"% completado"]})]}),!_&&m.jsx("div",{className:"p-3 bg-yellow-500/20 border border-yellow-500/30 rounded-lg",children:m.jsx("p",{className:"text-yellow-200 text-sm",children:"⚠️ Debes estar logueado para publicar videos"})}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(co,{htmlFor:"title",className:"text-white",children:[N?"Título del Contenido":"Título del Video"," *"]}),m.jsx(Sn,{id:"title",value:r,onChange:e=>a(e.target.value),placeholder:N?"Ej: Mi nuevo contenido increíble":"Ej: Mi nuevo video increíble",className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400",required:!0,disabled:f,maxLength:100}),m.jsxs("p",{className:"text-xs text-gray-400",children:[r.length,"/100 caracteres"]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"description",className:"text-white",children:"Descripción *"}),m.jsx(uo,{id:"description",value:i,onChange:e=>n(e.target.value),placeholder:N?"Describe tu contenido...":"Describe tu video...",className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400 min-h-[80px]",required:!0,disabled:f,maxLength:500}),m.jsxs("p",{className:"text-xs text-gray-400",children:[i.length,"/500 caracteres"]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(co,{className:"text-white flex items-center gap-2",children:[m.jsx(ft,{className:"w-4 h-4"}),N?"Archivo":"Archivo de Video"," *",N&&m.jsxs("div",{className:"flex items-center gap-1 text-blue-400",children:[m.jsx(Ut,{className:"w-4 h-4"}),m.jsx("span",{className:"text-xs",children:"Android: Cualquier archivo"})]})]}),o?m.jsx("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx(ft,{className:"w-8 h-8 text-blue-400"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-white font-medium",children:o.name}),m.jsxs("p",{className:"text-gray-400 text-sm",children:[(o.size/1048576).toFixed(2)," MB"]}),m.jsxs("p",{className:"text-gray-400 text-xs",children:["Tipo: ",o.type||"Archivo"]})]})]}),m.jsx(Ve,{type:"button",variant:"ghost",size:"sm",onClick:()=>{l(null)},className:"text-gray-400 hover:text-white hover:bg-white/20",disabled:f,children:m.jsx(ss,{className:"w-4 h-4"})})]})}):m.jsxs("div",{className:"border-2 border-dashed border-white/20 rounded-lg p-6 text-center hover:border-white/30 transition-colors",children:[m.jsx(Ht,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),m.jsx("p",{className:"text-gray-400 mb-2",children:N?"Sube cualquier archivo (máx. 100MB)":"Sube tu video (máx. 100MB)"}),!N&&m.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Formatos: MP4, MOV, AVI, WebM"}),N&&m.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"APK, ZIP, PDF, documentos, etc."}),m.jsx("input",{type:"file",accept:N?void 0:"video/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){if(console.log("Video file selected:",{name:s.name,size:s.size,type:s.type}),s.size>104857600)return void j({title:"Archivo muy grande",description:"El archivo no puede superar los 100MB",variant:"destructive"});if(!N&&!s.type.startsWith("video/"))return void j({title:"Formato no válido",description:"Por favor selecciona un archivo de video válido",variant:"destructive"});l(s)}},className:"hidden",id:"video-upload",disabled:f}),m.jsxs(Ve,{type:"button",variant:"outline",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",onClick:()=>{var e;return null==(e=document.getElementById("video-upload"))?void 0:e.click()},disabled:f,children:["Seleccionar ",N?"Archivo":"Video"]})]}),N&&m.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3",children:[m.jsx("p",{className:"text-blue-300 text-sm font-medium",children:"📱 Android: Puedes subir cualquier tipo de archivo"}),m.jsx("p",{className:"text-blue-400 text-xs mt-1",children:"APK, ZIP, PDF, documentos, imágenes, videos, etc."})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{className:"text-white",children:"Portada del Video (opcional)"}),c?m.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx(vt,{className:"w-8 h-8 text-green-400"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-white font-medium",children:c.name}),m.jsxs("p",{className:"text-gray-400 text-sm",children:[(c.size/1048576).toFixed(2)," MB"]})]})]}),m.jsx(Ve,{type:"button",variant:"ghost",size:"sm",onClick:()=>{d(null),u&&(URL.revokeObjectURL(u),p(null))},className:"text-gray-400 hover:text-white hover:bg-white/20",disabled:f,children:m.jsx(ss,{className:"w-4 h-4"})})]}),u&&m.jsx("div",{className:"mt-2",children:m.jsx("img",{src:u,alt:"Preview",className:"w-full h-32 object-cover rounded"})})]}):m.jsxs("div",{className:"border-2 border-dashed border-white/20 rounded-lg p-6 text-center hover:border-white/30 transition-colors",children:[m.jsx(vt,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),m.jsx("p",{className:"text-gray-400 mb-2",children:"Sube una portada (máx. 5MB)"}),m.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){if(console.log("Thumbnail file selected:",{name:s.name,size:s.size,type:s.type}),s.size>5242880)return void j({title:"Imagen muy grande",description:"La portada no puede superar los 5MB",variant:"destructive"});if(s.type.startsWith("image/")){d(s);const e=URL.createObjectURL(s);p(e)}}},className:"hidden",id:"thumbnail-upload",disabled:f}),m.jsx(Ve,{type:"button",variant:"outline",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",onClick:()=>{var e;return null==(e=document.getElementById("thumbnail-upload"))?void 0:e.click()},disabled:f,children:"Seleccionar Portada"})]})]}),m.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[m.jsx(Ve,{type:"button",variant:"ghost",onClick:t,className:"text-white hover:bg-white/20",disabled:f,children:"Cancelar"}),m.jsx(Ve,{type:"submit",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",disabled:!_||!r.trim()||!i.trim()||!o||f,children:f?"Subiendo...":N?"Publicar Contenido":"Publicar Video"})]})]})]})})},zl=()=>{const[e,t]=Ae.useState(null),[s,r]=Ae.useState([]),[a,i]=Ae.useState({totalSales:0,totalProducts:0,totalLikes:0}),[n,o]=Ae.useState(!1),{toast:d}=ys();return{profile:e,products:s,stats:a,loading:n,fetchUserProfile:e=>h(void 0,null,(function*(){if(e){o(!0);try{const{data:s,error:a}=yield cn.from("profiles").select("*").eq("id",e).single();if(a)throw a;const{data:n,error:o}=yield cn.from("products").select("*").eq("user_id",e).eq("status","active").order("created_at",{ascending:!1});if(o)throw o;const d=(n||[]).map((e=>c(l({},e),{is_featured:e.is_paid_featured||e.is_performance_featured,preview_images:Array.isArray(e.preview_images)?e.preview_images.filter((e=>"string"==typeof e)):[]}))),u=d.reduce(((e,t)=>e+t.sales),0),h=d.length,{data:m,error:p}=yield cn.from("product_likes").select("product_id").in("product_id",d.map((e=>e.id))),f=(null==m?void 0:m.length)||0,{data:x,error:g}=yield cn.from("user_follows").select("follower_id").eq("following_id",e),{data:v,error:y}=yield cn.from("user_follows").select("following_id").eq("follower_id",e),b=(null==x?void 0:x.length)||0,w=(null==v?void 0:v.length)||0,j=c(l({},s),{followers_count:b,following_count:w});t(j),r(d),i({totalSales:u,totalProducts:h,totalLikes:f}),console.log("Profile loaded with followers:",b,"following:",w)}catch(s){console.error("Error fetching user profile:",s),d({title:"Error",description:"No se pudo cargar el perfil del usuario",variant:"destructive"})}finally{o(!1)}}})),clearProfile:()=>{t(null),r([]),i({totalSales:0,totalProducts:0,totalLikes:0})}}},Bl=({onBack:e,onUserSelect:t})=>{const{videos:s,incrementViews:r}=jl(),{user:a}=hn(),[i,n]=Ae.useState(0),[o,d]=Ae.useState(!1),[u,p]=Ae.useState(!1),[f,x]=Ae.useState(""),[g,v]=Ae.useState(new Set),[y,b]=Ae.useState({}),w=Ae.useRef(null),j=Ae.useRef(null),_=s[i],{isLiked:N,likesCount:k,toggleLike:S}=bl((null==_?void 0:_.id)||""),{comments:C,addComment:E}=wl((null==_?void 0:_.id)||""),{fetchUserProfile:T}=zl();Ae.useEffect((()=>{_&&!y[_.user_id]&&T(_.user_id).then((()=>{b((e=>c(l({},e),{[_.user_id]:!0})))}))}),[null==_?void 0:_.user_id]),Ae.useEffect((()=>{w.current&&_&&(w.current.currentTime=0,w.current.play().catch(console.error),g.has(_.id)||(r(_.id),v((e=>new Set([...e,_.id])))))}),[i,null==_?void 0:_.id]);const P=()=>{i<s.length-1&&(n(i+1),p(!1))},A=()=>{i>0&&(n(i-1),p(!1))},R=()=>h(void 0,null,(function*(){f.trim()&&(yield E(f),x(""))}));return Ae.useEffect((()=>{const e=e=>{"ArrowUp"===e.key&&A(),"ArrowDown"===e.key&&P()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[i,s.length]),_?m.jsxs("div",{className:"fixed inset-0 bg-black z-50 overflow-hidden",children:[m.jsx("div",{className:"absolute top-4 left-4 z-20",children:m.jsx(Ve,{onClick:e,variant:"ghost",size:"sm",className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-2",children:m.jsx(He,{className:"w-5 h-5"})})}),m.jsx("div",{className:"absolute top-4 right-4 z-20",children:m.jsxs("div",{className:"bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:[i+1," / ",s.length]})}),m.jsxs("div",{ref:j,className:"relative w-full h-full flex items-center justify-center",children:[m.jsx("video",{ref:w,src:_.video_url||void 0,poster:_.thumbnail_url||void 0,className:"w-full h-full object-contain",loop:!0,playsInline:!0,muted:o,onClick:()=>{var e,t,s;return(null==(e=w.current)?void 0:e.paused)?null==(t=w.current)?void 0:t.play():null==(s=w.current)?void 0:s.pause()}}),m.jsxs("div",{className:"absolute right-4 bottom-20 flex flex-col items-center space-y-6 z-10",children:[m.jsx("div",{className:"flex flex-col items-center",children:m.jsx(Fn,{className:"w-12 h-12 border-2 border-white cursor-pointer hover:scale-110 transition-transform",onClick:()=>{_&&t(_.user_id)},children:m.jsx(qn,{className:"bg-purple-500/80 text-white",children:m.jsx(Xt,{className:"w-6 h-6"})})})}),m.jsxs("div",{className:"flex flex-col items-center",children:[m.jsx(Ve,{variant:"ghost",size:"sm",onClick:S,className:(N?"text-red-400 hover:text-red-300":"text-white hover:text-red-400")+" p-3 rounded-full bg-black/30 hover:bg-black/50 transition-all",children:m.jsx(gt,{className:"w-6 h-6 "+(N?"fill-current":"")})}),m.jsx("span",{className:"text-white text-sm mt-1 font-semibold",children:k})]}),m.jsxs("div",{className:"flex flex-col items-center",children:[m.jsx(Ve,{variant:"ghost",size:"sm",onClick:()=>p(!u),className:"text-white hover:text-blue-400 p-3 rounded-full bg-black/30 hover:bg-black/50 transition-all",children:m.jsx(kt,{className:"w-6 h-6"})}),m.jsx("span",{className:"text-white text-sm mt-1 font-semibold",children:C.length})]}),m.jsx(Ve,{variant:"ghost",size:"sm",className:"text-white hover:text-green-400 p-3 rounded-full bg-black/30 hover:bg-black/50 transition-all",children:m.jsx(It,{className:"w-6 h-6"})}),m.jsx(Ve,{variant:"ghost",size:"sm",onClick:()=>{w.current&&(w.current.muted=!o,d(!o))},className:"text-white hover:text-yellow-400 p-3 rounded-full bg-black/30 hover:bg-black/50 transition-all",children:o?m.jsx(ts,{className:"w-6 h-6"}):m.jsx(es,{className:"w-6 h-6"})})]}),m.jsxs("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 flex flex-col space-y-4",children:[m.jsx(Ve,{variant:"ghost",size:"sm",onClick:A,disabled:0===i,className:"text-white hover:text-blue-400 p-2 rounded-full bg-black/30 hover:bg-black/50 disabled:opacity-30",children:m.jsx(st,{className:"w-6 h-6"})}),m.jsx(Ve,{variant:"ghost",size:"sm",onClick:P,disabled:i===s.length-1,className:"text-white hover:text-blue-400 p-2 rounded-full bg-black/30 hover:bg-black/50 disabled:opacity-30",children:m.jsx(et,{className:"w-6 h-6"})})]}),m.jsx("div",{className:"absolute bottom-20 left-4 right-20 z-10",children:m.jsxs("div",{className:"space-y-2",children:[m.jsx("h3",{className:"text-white font-semibold text-lg",children:_.title}),_.description&&m.jsx("p",{className:"text-gray-300 text-sm",children:_.description}),m.jsxs("p",{className:"text-gray-400 text-xs",children:[_.views.toLocaleString()," vistas"]})]})})]}),u&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/80 backdrop-blur-sm p-4 max-h-96 overflow-hidden z-20",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("h4",{className:"text-white font-semibold",children:["Comentarios (",C.length,")"]}),m.jsx(Ve,{variant:"ghost",size:"sm",onClick:()=>p(!1),className:"text-gray-400 hover:text-white",children:"×"})]}),a&&m.jsxs("div",{className:"flex space-x-2",children:[m.jsx(Sn,{placeholder:"Añade un comentario...",value:f,onChange:e=>x(e.target.value),className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400 text-sm",onKeyPress:e=>"Enter"===e.key&&R()}),m.jsx(Ve,{size:"sm",onClick:R,disabled:!f.trim(),className:"bg-purple-600 hover:bg-purple-700",children:m.jsx(Ot,{className:"w-4 h-4"})})]}),m.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:0===C.length?m.jsx("p",{className:"text-gray-400 text-sm text-center py-4",children:"No hay comentarios aún"}):C.map((e=>m.jsxs("div",{className:"flex space-x-2",children:[m.jsx(Fn,{className:"w-6 h-6 flex-shrink-0",children:m.jsx(qn,{className:"bg-purple-500/20 text-white text-xs",children:m.jsx(Xt,{className:"w-3 h-3"})})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("span",{className:"text-white text-sm font-medium",children:"Usuario"}),m.jsx("span",{className:"text-gray-400 text-xs",children:new Date(e.created_at).toLocaleDateString()})]}),m.jsx("p",{className:"text-gray-300 text-sm",children:e.comment})]})]},e.id)))})]})})]}):m.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:m.jsxs("div",{className:"text-white text-center",children:[m.jsx("h2",{className:"text-2xl mb-4",children:"No hay videos disponibles"}),m.jsxs(Ve,{onClick:e,variant:"outline",className:"text-white border-white",children:[m.jsx(He,{className:"w-4 h-4 mr-2"}),"Volver"]})]})})},Zl=({onUserSelect:e})=>{const{videos:t,loading:s,error:r}=jl(),[a,i]=Ae.useState(""),[n,o]=Ae.useState("created_at"),[l,c]=Ae.useState("desc"),[d,u]=Ae.useState(!1),[h,p]=Ae.useState(!1),f=t=>{e&&e(t)};if(h)return m.jsx(Bl,{onBack:()=>p(!1),onUserSelect:f});if(s)return m.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4",children:m.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[m.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:m.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Videos"})}),m.jsxs("div",{className:"text-center py-12",children:[m.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"}),m.jsx("p",{className:"text-white mt-4",children:"Cargando videos..."})]})]})});if(r)return m.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4",children:m.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[m.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[m.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Videos"}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs(Ve,{onClick:()=>p(!0),className:"bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700",disabled:0===t.length,children:[m.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Ver videos randoms"]}),m.jsxs(Ve,{onClick:()=>u(!0),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[m.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Crear Video"]})]})]}),m.jsxs("div",{className:"text-center py-12",children:[m.jsx(Qt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-400 text-lg mb-4",children:"Error al cargar los videos"}),m.jsx("p",{className:"text-gray-500 text-sm",children:"Intenta recargar la página"})]}),m.jsx(ql,{isOpen:d,onClose:()=>u(!1),onCreateVideo:()=>{}})]})});const x=t.filter((e=>e.title.toLowerCase().includes(a.toLowerCase())||e.description&&e.description.toLowerCase().includes(a.toLowerCase()))).sort(((e,t)=>{let s=e[n],r=t[n];return"created_at"===n&&(s=new Date(s).getTime(),r=new Date(r).getTime()),"asc"===l?s>r?1:-1:s<r?1:-1}));return m.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4 bg-zinc-950",children:m.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto bg-zinc-700",children:[m.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[m.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Videos"}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs(Ve,{onClick:()=>p(!0),className:"bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700",disabled:0===t.length,children:[m.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Ver videos randoms"]}),m.jsxs(Ve,{onClick:()=>u(!0),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[m.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Crear Video"]})]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full",children:[m.jsxs("div",{className:"relative flex-1",children:[m.jsx(Rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),m.jsx(Sn,{placeholder:"Buscar videos...",value:a,onChange:e=>i(e.target.value),className:"pl-10 bg-white/10 border-white/20 text-white placeholder:text-gray-400"})]}),m.jsxs(zn,{value:n,onValueChange:o,children:[m.jsx(Zn,{className:"bg-white/10 border-white/20 text-white w-full sm:w-40",children:m.jsx(Bn,{})}),m.jsxs(Wn,{children:[m.jsx(Gn,{value:"created_at",children:"Fecha"}),m.jsx(Gn,{value:"views",children:"Vistas"}),m.jsx(Gn,{value:"likes",children:"Likes"}),m.jsx(Gn,{value:"title",children:"Título"})]})]}),m.jsx(Ve,{variant:"outline",size:"icon",onClick:()=>c("asc"===l?"desc":"asc"),className:"border-white/20 text-white hover:bg-white/20",children:"asc"===l?"↑":"↓"})]}),0===x.length?m.jsxs("div",{className:"text-center py-12 bg-zinc-800",children:[m.jsx(Qt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-400 text-lg mb-4",children:a?"No se encontraron videos":"No hay videos disponibles"}),m.jsx("p",{className:"text-gray-500 text-sm mb-6",children:a?"Intenta con otros términos de búsqueda":"Sé el primero en compartir un video"}),!a&&m.jsxs(Ve,{onClick:()=>u(!0),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[m.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Crear mi primer video"]})]}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:x.map((e=>m.jsx(_l,{video:e},e.id)))}),m.jsx(ql,{isOpen:d,onClose:()=>u(!1),onCreateVideo:()=>{}})]})})},Hl=()=>{const[e,t]=Ae.useState(""),{myProducts:s,loading:r,deleteProduct:a}=(()=>{const[e,t]=Ae.useState([]),[s,r]=Ae.useState(!0),{user:a}=hn(),{toast:i}=ys(),n=()=>h(void 0,null,(function*(){if(!a)return t([]),void r(!1);try{const{data:e,error:s}=yield cn.from("products").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});if(s)throw s;const r=(e||[]).map((e=>c(l({},e),{is_featured:e.is_paid_featured||e.is_performance_featured,preview_images:Array.isArray(e.preview_images)?e.preview_images.filter((e=>"string"==typeof e)):[]})));t(r)}catch(e){console.error("Error fetching my products:",e),i({title:"Error",description:"No se pudieron cargar tus productos",variant:"destructive"})}finally{r(!1)}}));return Ae.useEffect((()=>{n()}),[a]),{myProducts:e,loading:s,deleteProduct:e=>h(void 0,null,(function*(){if(!a)return i({title:"Error",description:"Debes estar autenticado para eliminar productos",variant:"destructive"}),{error:new Error("User not authenticated")};try{const{error:s}=yield cn.from("products").delete().eq("id",e).eq("user_id",a.id);if(s)throw s;return t((t=>t.filter((t=>t.id!==e)))),i({title:"¡Producto eliminado!",description:"Tu producto ha sido eliminado exitosamente"}),{error:null}}catch(s){return console.error("Error deleting product:",s),i({title:"Error",description:"No se pudo eliminar el producto",variant:"destructive"}),{error:s}}})),refreshMyProducts:n}})(),i=s.filter((t=>t.title.toLowerCase().includes(e.toLowerCase())||t.category.toLowerCase().includes(e.toLowerCase()))),n=s.reduce(((e,t)=>e+t.sales),0),o=s.reduce(((e,t)=>e+t.sales*t.price),0);return r?m.jsx("div",{className:"flex items-center justify-center py-12",children:m.jsx("div",{className:"text-white",children:"Cargando tus productos..."})}):m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"text-center sm:text-left",children:[m.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white mb-2",children:"Mis Productos"}),m.jsx("p",{className:"text-gray-300 text-sm sm:text-base",children:"Gestiona todos los productos que has publicado"})]}),m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-4 sm:p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-300 text-xs sm:text-sm font-medium",children:"Productos Publicados"}),m.jsx("p",{className:"text-xl sm:text-2xl font-bold text-white",children:s.length})]}),m.jsx(Ct,{className:"w-6 h-6 sm:w-8 sm:h-8 text-purple-400"})]})})}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-4 sm:p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-300 text-xs sm:text-sm font-medium",children:"Ventas Totales"}),m.jsx("p",{className:"text-xl sm:text-2xl font-bold text-white",children:n})]}),m.jsx(zt,{className:"w-6 h-6 sm:w-8 sm:h-8 text-green-400"})]})})}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20 sm:col-span-2 lg:col-span-1",children:m.jsx(Nn,{className:"p-4 sm:p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-300 text-xs sm:text-sm font-medium",children:"Ingresos Totales"}),m.jsxs("p",{className:"text-xl sm:text-2xl font-bold text-white",children:["$",o.toFixed(2)]})]}),m.jsx(zt,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-400"})]})})})]}),m.jsx("div",{className:"relative max-w-md mx-auto sm:mx-0",children:m.jsx(Sn,{placeholder:"Buscar mis productos...",value:e,onChange:e=>t(e.target.value),className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400"})}),m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:i.map((e=>m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20 hover:bg-white/15 transition-all duration-300",children:[m.jsx(wn,{className:"p-0",children:m.jsx("div",{className:"aspect-video bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-t-lg flex items-center justify-center",children:m.jsx(Ct,{className:"w-8 h-8 sm:w-12 sm:h-12 text-white/50"})})}),m.jsxs(Nn,{className:"p-3 sm:p-4",children:[m.jsxs("div",{className:"flex items-start justify-between mb-2",children:[m.jsx(gn,{variant:"secondary",className:"text-xs "+("active"===e.status?"bg-green-500/20 text-green-200 border-green-500/30":"bg-yellow-500/20 text-yellow-200 border-yellow-500/30"),children:"active"===e.status?"Activo":"Inactivo"}),m.jsx(gn,{variant:"secondary",className:"bg-purple-500/20 text-purple-200 border-purple-500/30 text-xs",children:e.category})]}),m.jsx(jn,{className:"text-white text-base sm:text-lg mb-2 line-clamp-2",children:e.title}),m.jsx(_n,{className:"text-gray-300 mb-3 text-sm line-clamp-2",children:e.description}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-lg sm:text-2xl font-bold text-white",children:e.is_free?"GRATIS":`$${e.price}`}),m.jsxs("span",{className:"text-yellow-400 text-sm",children:["★ ",e.rating]})]}),m.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[m.jsxs("span",{children:[e.sales," ventas"]}),m.jsxs("span",{children:[e.views," vistas"]})]}),m.jsxs("p",{className:"text-xs text-gray-500",children:["Creado: ",new Date(e.created_at).toLocaleDateString()]})]})]}),m.jsx(kn,{className:"p-3 sm:p-4 pt-0 space-y-2",children:m.jsxs("div",{className:"flex gap-1 w-full",children:[m.jsxs(Ve,{variant:"ghost",size:"sm",className:"flex-1 text-white hover:bg-white/20 text-xs",children:[m.jsx(pt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),"Ver"]}),m.jsxs(Ve,{variant:"ghost",size:"sm",className:"flex-1 text-white hover:bg-white/20 text-xs",children:[m.jsx(Ft,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),"Editar"]}),m.jsx(Ve,{variant:"ghost",size:"sm",className:"text-red-400 hover:bg-red-500/20 px-2",onClick:()=>{return t=e.id,h(void 0,null,(function*(){confirm("¿Estás seguro de que quieres eliminar este producto? Esta acción no se puede deshacer.")&&(yield a(t))}));var t},children:m.jsx(qt,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})})]},e.id)))}),0===i.length&&m.jsxs("div",{className:"text-center py-12",children:[m.jsx(Ct,{className:"w-12 h-12 sm:w-16 sm:h-16 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-white mb-2",children:"No tienes productos publicados"}),m.jsx("p",{className:"text-gray-400 text-sm",children:'¡Publica tu primer producto desde la sección "Productos"!'})]})]})},Kl=()=>{const[e,t]=Ae.useState(""),{myVideos:s,loading:r,deleteVideo:a}=(()=>{const[e,t]=Ae.useState([]),[s,r]=Ae.useState(!0),{user:a}=hn(),{toast:i}=ys(),n=()=>h(void 0,null,(function*(){if(!a)return t([]),void r(!1);try{const{data:e,error:s}=yield cn.from("videos").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});if(s)throw s;t(e||[])}catch(e){console.error("Error fetching my videos:",e),i({title:"Error",description:"No se pudieron cargar tus videos",variant:"destructive"})}finally{r(!1)}}));return Ae.useEffect((()=>{n()}),[a]),{myVideos:e,loading:s,updateVideo:(e,t)=>h(void 0,null,(function*(){if(!a)return{error:"Not authenticated"};try{const{data:s,error:r}=yield cn.from("videos").update(t).eq("id",e).eq("user_id",a.id).select().single();if(r)throw r;return i({title:"Video actualizado",description:"Los cambios se han guardado correctamente"}),yield n(),{data:s,error:null}}catch(s){return console.error("Error updating video:",s),i({title:"Error",description:"No se pudo actualizar el video",variant:"destructive"}),{error:s}}})),deleteVideo:e=>h(void 0,null,(function*(){if(!a)return{error:"Not authenticated"};try{const{error:t}=yield cn.from("videos").delete().eq("id",e).eq("user_id",a.id);if(t)throw t;return i({title:"Video eliminado",description:"El video se ha eliminado correctamente"}),yield n(),{error:null}}catch(t){return console.error("Error deleting video:",t),i({title:"Error",description:"No se pudo eliminar el video",variant:"destructive"}),{error:t}}})),refreshMyVideos:n}})(),i=s.filter((t=>t.title.toLowerCase().includes(e.toLowerCase())||t.description&&t.description.toLowerCase().includes(e.toLowerCase()))),n=s.reduce(((e,t)=>e+t.views),0),o=s.reduce(((e,t)=>e+t.likes),0),l=s.reduce(((e,t)=>e+t.comments),0);return r?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Mis Videos"}),m.jsx("p",{className:"text-gray-300",children:"Gestiona todos los videos promocionales que has creado"})]}),m.jsx("div",{className:"text-center py-12",children:m.jsx("p",{className:"text-white",children:"Cargando tus videos..."})})]}):m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Mis Videos"}),m.jsx("p",{className:"text-gray-300",children:"Gestiona todos los videos promocionales que has creado"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-300 text-sm font-medium",children:"Videos Publicados"}),m.jsx("p",{className:"text-2xl font-bold text-white",children:s.length})]}),m.jsx(Qt,{className:"w-8 h-8 text-purple-400"})]})})}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-300 text-sm font-medium",children:"Total Vistas"}),m.jsx("p",{className:"text-2xl font-bold text-white",children:n.toLocaleString()})]}),m.jsx(pt,{className:"w-8 h-8 text-blue-400"})]})})}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-300 text-sm font-medium",children:"Total Likes"}),m.jsx("p",{className:"text-2xl font-bold text-white",children:o.toLocaleString()})]}),m.jsx(gt,{className:"w-8 h-8 text-red-400"})]})})}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-300 text-sm font-medium",children:"Total Comentarios"}),m.jsx("p",{className:"text-2xl font-bold text-white",children:l.toLocaleString()})]}),m.jsx(St,{className:"w-8 h-8 text-green-400"})]})})})]}),m.jsx("div",{className:"relative max-w-md",children:m.jsx(Sn,{placeholder:"Buscar mis videos...",value:e,onChange:e=>t(e.target.value),className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400"})}),i.length>0?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map((e=>m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20 hover:bg-white/15 transition-all duration-300 group overflow-hidden",children:m.jsxs(Nn,{className:"p-0",children:[m.jsxs("div",{className:"relative aspect-video bg-gradient-to-br from-purple-500/20 to-pink-500/20 cursor-pointer",children:[e.thumbnail_url?m.jsx("img",{src:e.thumbnail_url,alt:e.title,className:"absolute inset-0 w-full h-full object-cover"}):m.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:m.jsx(Tt,{className:"w-8 h-8 text-white/70"})}),m.jsx("div",{className:"absolute bottom-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded",children:e.duration||"1:00"}),m.jsx("div",{className:"absolute top-2 left-2",children:m.jsx(gn,{variant:"secondary",className:""+("active"===e.status?"bg-green-500/20 text-green-200 border-green-500/30":"bg-yellow-500/20 text-yellow-200 border-yellow-500/30"),children:"active"===e.status?"Publicado":"Borrador"})}),m.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-colors"}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:m.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:m.jsx(Tt,{className:"w-8 h-8 text-white ml-1"})})})]}),m.jsxs("div",{className:"p-4 space-y-3",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-white font-semibold text-sm mb-1 line-clamp-2",children:e.title}),e.description&&m.jsx("p",{className:"text-gray-300 text-xs line-clamp-2",children:e.description})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs text-gray-400",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx(pt,{className:"w-3 h-3 mr-1"}),e.views.toLocaleString()]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx(gt,{className:"w-3 h-3 mr-1"}),e.likes]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx(St,{className:"w-3 h-3 mr-1"}),e.comments]})]}),m.jsxs("div",{className:"text-xs text-gray-500",children:["Creado: ",new Date(e.created_at).toLocaleDateString()]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs(Ve,{variant:"ghost",size:"sm",className:"flex-1 text-white hover:bg-white/20 text-xs",children:[m.jsx(pt,{className:"w-3 h-3 mr-1"}),"Ver"]}),m.jsxs(Ve,{variant:"ghost",size:"sm",className:"flex-1 text-white hover:bg-white/20 text-xs",children:[m.jsx(Ft,{className:"w-3 h-3 mr-1"}),"Editar"]}),m.jsx(Ve,{variant:"ghost",size:"sm",className:"text-red-400 hover:bg-red-500/20 text-xs",onClick:()=>{return t=e.id,h(void 0,null,(function*(){confirm("¿Estás seguro de que quieres eliminar este video?")&&(yield a(t))}));var t},children:m.jsx(qt,{className:"w-3 h-3"})})]})]})]})},e.id)))}):m.jsxs("div",{className:"text-center py-12",children:[m.jsx(Qt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:0===s.length?"No has creado videos aún":"No se encontraron videos"}),m.jsx("p",{className:"text-gray-400",children:0===s.length?"Crea tu primer video promocional":"Intenta con otros términos de búsqueda"})]})]})};var Wl="Switch",[Gl,Jl]=_(Wl),[Xl,Yl]=Gl(Wl),Ql=Ae.forwardRef(((e,t)=>{const s=e,{__scopeSwitch:r,name:a,checked:i,defaultChecked:n,required:o,disabled:u,value:h="on",onCheckedChange:p,form:f}=s,x=d(s,["__scopeSwitch","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]),[g,v]=Ae.useState(null),y=V(t,(e=>v(e))),b=Ae.useRef(!1),w=!g||(f||!!g.closest("form")),[j=!1,_]=q({prop:i,defaultProp:n,onChange:p});return m.jsxs(Xl,{scope:r,checked:j,disabled:u,children:[m.jsx(N.button,c(l({type:"button",role:"switch","aria-checked":j,"aria-required":o,"data-state":rc(j),"data-disabled":u?"":void 0,disabled:u,value:h},x),{ref:y,onClick:z(e.onClick,(e=>{_((e=>!e)),w&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())}))})),w&&m.jsx(sc,{control:g,bubbles:!b.current,name:a,value:h,checked:j,required:o,disabled:u,form:f,style:{transform:"translateX(-100%)"}})]})}));Ql.displayName=Wl;var ec="SwitchThumb",tc=Ae.forwardRef(((e,t)=>{const s=e,{__scopeSwitch:r}=s,a=d(s,["__scopeSwitch"]),i=Yl(ec,r);return m.jsx(N.span,c(l({"data-state":rc(i.checked),"data-disabled":i.disabled?"":void 0},a),{ref:t}))}));tc.displayName=ec;var sc=e=>{const t=e,{control:s,checked:r,bubbles:a=!0}=t,i=d(t,["control","checked","bubbles"]),n=Ae.useRef(null),o=Z(r),u=H(s);return Ae.useEffect((()=>{const e=n.current,t=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(t,"checked").set;if(o!==r&&s){const t=new Event("click",{bubbles:a});s.call(e,r),e.dispatchEvent(t)}}),[o,r,a]),m.jsx("input",c(l({type:"checkbox","aria-hidden":!0,defaultChecked:r},i),{tabIndex:-1,ref:n,style:c(l(l({},e.style),u),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))};function rc(e){return e?"checked":"unchecked"}var ac=Ql,ic=tc;const nc=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(ac,c(l({className:Ue("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r)},a),{ref:t,children:m.jsx(ic,{className:Ue("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}))}));nc.displayName=ac.displayName;const oc=({isOpen:e,onClose:t,userId:s,username:r,isCurrentlyBanned:a=!1,onBanComplete:i})=>{const[n,o]=Ae.useState(""),[l,c]=Ae.useState(!1),[d,u]=Ae.useState(""),[p,f]=Ae.useState(!1),{toast:x}=ys();Ae.useEffect((()=>{e&&(o(""),u(""),c(!1),f(!1))}),[e]);const g=()=>{p||t()};return m.jsx(Yn,{open:e,onOpenChange:g,children:m.jsxs(to,{className:"bg-gray-900/95 backdrop-blur-lg border-white/20 text-white",children:[m.jsxs(so,{children:[m.jsx(ao,{children:a?"Desbanear Usuario":"Banear Usuario"}),m.jsx(io,{className:"text-gray-300",children:a?`Vas a desbanear a: ${r}`:`Vas a banear a: ${r}`})]}),a?m.jsx("div",{className:"space-y-4",children:m.jsx("div",{className:"p-4 bg-green-500/10 rounded-lg border border-green-500/20",children:m.jsx("p",{className:"text-green-300 text-sm",children:"Al desbanear a este usuario, podrá volver a acceder a la plataforma inmediatamente."})})}):m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx(co,{htmlFor:"reason",className:"text-white",children:"Razón del ban *"}),m.jsx(uo,{id:"reason",placeholder:"Escribe la razón del ban...",value:n,onChange:e=>o(e.target.value),className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400",rows:3})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(nc,{id:"permanent",checked:l,onCheckedChange:c}),m.jsx(co,{htmlFor:"permanent",className:"text-white",children:"Ban permanente"})]}),!l&&m.jsxs("div",{children:[m.jsx(co,{htmlFor:"bannedUntil",className:"text-white",children:"Baneado hasta *"}),m.jsx(Sn,{id:"bannedUntil",type:"datetime-local",value:d,onChange:e=>u(e.target.value),className:"bg-white/10 border-white/20 text-white",min:(new Date).toISOString().slice(0,16),required:!0}),m.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Selecciona la fecha y hora hasta cuando estará baneado"})]}),m.jsx("div",{className:"p-4 bg-red-500/10 rounded-lg border border-red-500/20",children:m.jsxs("p",{className:"text-red-300 text-sm",children:[m.jsx("strong",{children:"Advertencia:"})," Esta acción es irreversible. El usuario no podrá acceder a la plataforma hasta que sea desbaneado."]})})]}),m.jsxs(ro,{children:[m.jsx(Ve,{variant:"outline",onClick:g,disabled:p,className:"bg-white/10 border-white/20 text-white",children:"Cancelar"}),m.jsx(Ve,{onClick:()=>h(void 0,null,(function*(){if(a){f(!0);try{yield i(s,!1),t(),x({title:"Usuario desbaneado",description:`${r} ha sido desbaneado exitosamente`})}catch(e){console.error("Error unbanning user:",e),x({title:"Error",description:"No se pudo desbanear al usuario",variant:"destructive"})}finally{f(!1)}}else{if(!n.trim())return void x({title:"Error",description:"Debes especificar una razón para el ban",variant:"destructive"});if(!l&&!d.trim())return void x({title:"Error",description:"Debes especificar una fecha de fin para el ban temporal",variant:"destructive"});if(!l&&d.trim()){if(new Date(d)<=new Date)return void x({title:"Error",description:"La fecha de fin del ban debe ser en el futuro",variant:"destructive"})}f(!0);try{const e=!l&&d.trim()?new Date(d):void 0;yield i(s,!0,n,l,e),t(),x({title:"Usuario baneado",description:`${r} ha sido baneado ${l?"permanentemente":"temporalmente"} exitosamente`})}catch(e){console.error("Error banning user:",e),x({title:"Error",description:"No se pudo banear al usuario",variant:"destructive"})}finally{f(!1)}}})),disabled:p||!a&&(!n.trim()||!l&&!d.trim()),className:a?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:p?a?"Desbaneando...":"Baneando...":a?"Desbanear Usuario":"Banear Usuario"})]})]})})};var lc=e=>"checkbox"===e.type,cc=e=>e instanceof Date,dc=e=>null==e;const uc=e=>"object"==typeof e;var hc=e=>!dc(e)&&!Array.isArray(e)&&uc(e)&&!cc(e),mc=e=>hc(e)&&e.target?lc(e.target)?e.target.checked:e.target.value:e,pc=(e,t)=>e.has((e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e)(t)),fc="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function xc(e){let t;const s=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else{if(fc&&(e instanceof Blob||e instanceof FileList)||!s&&!hc(e))return e;if(t=s?[]:{},s||(e=>{const t=e.constructor&&e.constructor.prototype;return hc(t)&&t.hasOwnProperty("isPrototypeOf")})(e))for(const s in e)e.hasOwnProperty(s)&&(t[s]=xc(e[s]));else t=e}return t}var gc=e=>Array.isArray(e)?e.filter(Boolean):[],vc=e=>void 0===e,yc=(e,t,s)=>{if(!t||!hc(e))return s;const r=gc(t.split(/[,[\].]+?/)).reduce(((e,t)=>dc(e)?e:e[t]),e);return vc(r)||r===e?vc(e[t])?s:e[t]:r},bc=e=>"boolean"==typeof e,wc=e=>/^\w*$/.test(e),jc=e=>gc(e.replace(/["|']|\]/g,"").split(/\.|\[/)),_c=(e,t,s)=>{let r=-1;const a=wc(t)?[t]:jc(t),i=a.length,n=i-1;for(;++r<i;){const t=a[r];let i=s;if(r!==n){const s=e[t];i=hc(s)||Array.isArray(s)?s:isNaN(+a[r+1])?{}:[]}if("__proto__"===t)return;e[t]=i,e=e[t]}return e};const Nc="blur",kc="focusout",Sc="change",Cc="onBlur",Ec="onChange",Tc="onSubmit",Pc="onTouched",Ac="all",Rc="max",Oc="min",Ic="maxLength",$c="minLength",Dc="pattern",Lc="required",Mc="validate",Uc=Ie.createContext(null),Fc=()=>Ie.useContext(Uc);var Vc=(e,t,s,r=!0)=>{const a={defaultValues:t._defaultValues};for(const i in e)Object.defineProperty(a,i,{get:()=>{const a=i;return t._proxyFormState[a]!==Ac&&(t._proxyFormState[a]=!r||Ac),s&&(s[a]=!0),e[a]}});return a},qc=e=>hc(e)&&!Object.keys(e).length,zc=(e,t,s,r)=>{s(e);const a=e,{name:i}=a,n=d(a,["name"]);return qc(n)||Object.keys(n).length>=Object.keys(t).length||Object.keys(n).find((e=>t[e]===(!r||Ac)))},Bc=e=>Array.isArray(e)?e:[e],Zc=(e,t,s)=>!e||!t||e===t||Bc(e).some((e=>e&&(s?e===t:e.startsWith(t)||t.startsWith(e))));function Hc(e){const t=Ie.useRef(e);t.current=e,Ie.useEffect((()=>{const s=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}}),[e.disabled])}var Kc=e=>"string"==typeof e,Wc=(e,t,s,r,a)=>Kc(e)?(r&&t.watch.add(e),yc(s,e,a)):Array.isArray(e)?e.map((e=>(r&&t.watch.add(e),yc(s,e)))):(r&&(t.watchAll=!0),s);function Gc(e){const t=Fc(),{name:s,disabled:r,control:a=t.control,shouldUnregister:i}=e,n=pc(a._names.array,s),o=function(e){const t=Fc(),{control:s=t.control,name:r,defaultValue:a,disabled:i,exact:n}=e||{},o=Ie.useRef(r);o.current=r,Hc({disabled:i,subject:s._subjects.values,next:e=>{Zc(o.current,e.name,n)&&c(xc(Wc(o.current,s._names,e.values||s._formValues,!1,a)))}});const[l,c]=Ie.useState(s._getWatch(r,a));return Ie.useEffect((()=>s._removeUnmounted())),l}({control:a,name:s,defaultValue:yc(a._formValues,s,yc(a._defaultValues,s,e.defaultValue)),exact:!0}),d=function(e){const t=Fc(),{control:s=t.control,disabled:r,name:a,exact:i}=e||{},[n,o]=Ie.useState(s._formState),c=Ie.useRef(!0),d=Ie.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),u=Ie.useRef(a);return u.current=a,Hc({disabled:r,next:e=>c.current&&Zc(u.current,e.name,i)&&zc(e,d.current,s._updateFormState)&&o(l(l({},s._formState),e)),subject:s._subjects.state}),Ie.useEffect((()=>(c.current=!0,d.current.isValid&&s._updateValid(!0),()=>{c.current=!1})),[s]),Vc(n,s,d.current,!1)}({control:a,name:s,exact:!0}),u=Ie.useRef(a.register(s,l(c(l({},e.rules),{value:o}),bc(e.disabled)?{disabled:e.disabled}:{})));return Ie.useEffect((()=>{const e=a._options.shouldUnregister||i,t=(e,t)=>{const s=yc(a._fields,e);s&&s._f&&(s._f.mount=t)};if(t(s,!0),e){const e=xc(yc(a._options.defaultValues,s));_c(a._defaultValues,s,e),vc(yc(a._formValues,s))&&_c(a._formValues,s,e)}return()=>{(n?e&&!a._state.action:e)?a.unregister(s):t(s,!1)}}),[s,a,n,i]),Ie.useEffect((()=>{yc(a._fields,s)&&a._updateDisabledField({disabled:r,fields:a._fields,name:s,value:yc(a._fields,s)._f.value})}),[r,s,a]),{field:c(l({name:s,value:o},bc(r)||d.disabled?{disabled:d.disabled||r}:{}),{onChange:Ie.useCallback((e=>u.current.onChange({target:{value:mc(e),name:s},type:Sc})),[s]),onBlur:Ie.useCallback((()=>u.current.onBlur({target:{value:yc(a._formValues,s),name:s},type:Nc})),[s,a]),ref:Ie.useCallback((e=>{const t=yc(a._fields,s);t&&e&&(t._f.ref={focus:()=>e.focus(),select:()=>e.select(),setCustomValidity:t=>e.setCustomValidity(t),reportValidity:()=>e.reportValidity()})}),[a._fields,s])}),formState:d,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!yc(d.errors,s)},isDirty:{enumerable:!0,get:()=>!!yc(d.dirtyFields,s)},isTouched:{enumerable:!0,get:()=>!!yc(d.touchedFields,s)},isValidating:{enumerable:!0,get:()=>!!yc(d.validatingFields,s)},error:{enumerable:!0,get:()=>yc(d.errors,s)}})}}const Jc=e=>e.render(Gc(e));var Xc=(e,t,s,r,a)=>t?c(l({},s[e]),{types:c(l({},s[e]&&s[e].types?s[e].types:{}),{[r]:a||!0})}):{},Yc=e=>({isOnSubmit:!e||e===Tc,isOnBlur:e===Cc,isOnChange:e===Ec,isOnAll:e===Ac,isOnTouch:e===Pc}),Qc=(e,t,s)=>!s&&(t.watchAll||t.watch.has(e)||[...t.watch].some((t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length)))));const ed=(e,t,s,r)=>{for(const a of s||Object.keys(e)){const s=yc(e,a);if(s){const e=s,{_f:i}=e,n=d(e,["_f"]);if(i){if(i.refs&&i.refs[0]&&t(i.refs[0],a)&&!r)return!0;if(i.ref&&t(i.ref,i.name)&&!r)return!0;if(ed(n,t))break}else if(hc(n)&&ed(n,t))break}}};var td=(e,t,s)=>{const r=Bc(yc(e,s));return _c(r,"root",t[s]),_c(e,s,r),e},sd=e=>"file"===e.type,rd=e=>"function"==typeof e,ad=e=>{if(!fc)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},id=e=>Kc(e),nd=e=>"radio"===e.type,od=e=>e instanceof RegExp;const ld={value:!1,isValid:!1},cd={value:!0,isValid:!0};var dd=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter((e=>e&&e.checked&&!e.disabled)).map((e=>e.value));return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!vc(e[0].attributes.value)?vc(e[0].value)||""===e[0].value?cd:{value:e[0].value,isValid:!0}:cd:ld}return ld};const ud={isValid:!1,value:null};var hd=e=>Array.isArray(e)?e.reduce(((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e),ud):ud;function md(e,t,s="validate"){if(id(e)||Array.isArray(e)&&e.every(id)||bc(e)&&!e)return{type:s,message:id(e)?e:"",ref:t}}var pd=e=>hc(e)&&!od(e)?e:{value:e,message:""},fd=(e,t,s,r,a)=>h(void 0,null,(function*(){const{ref:i,refs:n,required:o,maxLength:c,minLength:d,min:u,max:h,pattern:m,validate:p,name:f,valueAsNumber:x,mount:g,disabled:v}=e._f,y=yc(t,f);if(!g||v)return{};const b=n?n[0]:i,w=e=>{r&&b.reportValidity&&(b.setCustomValidity(bc(e)?"":e||""),b.reportValidity())},j={},_=nd(i),N=lc(i),k=_||N,S=(x||sd(i))&&vc(i.value)&&vc(y)||ad(i)&&""===i.value||""===y||Array.isArray(y)&&!y.length,C=Xc.bind(null,f,s,j),E=(e,t,s,r=Ic,a=$c)=>{const n=e?t:s;j[f]=l({type:e?r:a,message:n,ref:i},C(e?r:a,n))};if(a?!Array.isArray(y)||!y.length:o&&(!k&&(S||dc(y))||bc(y)&&!y||N&&!dd(n).isValid||_&&!hd(n).isValid)){const{value:e,message:t}=id(o)?{value:!!o,message:o}:pd(o);if(e&&(j[f]=l({type:Lc,message:t,ref:b},C(Lc,t)),!s))return w(t),j}if(!(S||dc(u)&&dc(h))){let e,t;const r=pd(h),a=pd(u);if(dc(y)||isNaN(y)){const s=i.valueAsDate||new Date(y),n=e=>new Date((new Date).toDateString()+" "+e),o="time"==i.type,l="week"==i.type;Kc(r.value)&&y&&(e=o?n(y)>n(r.value):l?y>r.value:s>new Date(r.value)),Kc(a.value)&&y&&(t=o?n(y)<n(a.value):l?y<a.value:s<new Date(a.value))}else{const s=i.valueAsNumber||(y?+y:y);dc(r.value)||(e=s>r.value),dc(a.value)||(t=s<a.value)}if((e||t)&&(E(!!e,r.message,a.message,Rc,Oc),!s))return w(j[f].message),j}if((c||d)&&!S&&(Kc(y)||a&&Array.isArray(y))){const e=pd(c),t=pd(d),r=!dc(e.value)&&y.length>+e.value,a=!dc(t.value)&&y.length<+t.value;if((r||a)&&(E(r,e.message,t.message),!s))return w(j[f].message),j}if(m&&!S&&Kc(y)){const{value:e,message:t}=pd(m);if(od(e)&&!y.match(e)&&(j[f]=l({type:Dc,message:t,ref:i},C(Dc,t)),!s))return w(t),j}if(p)if(rd(p)){const e=md(yield p(y,t),b);if(e&&(j[f]=l(l({},e),C(Mc,e.message)),!s))return w(e.message),j}else if(hc(p)){let e={};for(const r in p){if(!qc(e)&&!s)break;const a=md(yield p[r](y,t),b,r);a&&(e=l(l({},a),C(r,a.message)),w(a.message),s&&(j[f]=e))}if(!qc(e)&&(j[f]=l({ref:b},e),!s))return j}return w(!0),j}));function xd(e,t){const s=Array.isArray(t)?t:wc(t)?[t]:jc(t),r=1===s.length?e:function(e,t){const s=t.slice(0,-1).length;let r=0;for(;r<s;)e=vc(e)?r++:e[t[r++]];return e}(e,s),a=s.length-1,i=s[a];return r&&delete r[i],0!==a&&(hc(r)&&qc(r)||Array.isArray(r)&&function(e){for(const t in e)if(e.hasOwnProperty(t)&&!vc(e[t]))return!1;return!0}(r))&&xd(e,s.slice(0,-1)),e}var gd=()=>{let e=[];return{get observers(){return e},next:t=>{for(const s of e)s.next&&s.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter((e=>e!==t))}}),unsubscribe:()=>{e=[]}}},vd=e=>dc(e)||!uc(e);function yd(e,t){if(vd(e)||vd(t))return e===t;if(cc(e)&&cc(t))return e.getTime()===t.getTime();const s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(const a of s){const s=e[a];if(!r.includes(a))return!1;if("ref"!==a){const e=t[a];if(cc(s)&&cc(e)||hc(s)&&hc(e)||Array.isArray(s)&&Array.isArray(e)?!yd(s,e):s!==e)return!1}}return!0}var bd=e=>"select-multiple"===e.type,wd=e=>ad(e)&&e.isConnected,jd=e=>{for(const t in e)if(rd(e[t]))return!0;return!1};function _d(e,t={}){const s=Array.isArray(e);if(hc(e)||s)for(const r in e)Array.isArray(e[r])||hc(e[r])&&!jd(e[r])?(t[r]=Array.isArray(e[r])?[]:{},_d(e[r],t[r])):dc(e[r])||(t[r]=!0);return t}function Nd(e,t,s){const r=Array.isArray(e);if(hc(e)||r)for(const a in e)Array.isArray(e[a])||hc(e[a])&&!jd(e[a])?vc(t)||vd(s[a])?s[a]=Array.isArray(e[a])?_d(e[a],[]):l({},_d(e[a])):Nd(e[a],dc(t)?{}:t[a],s[a]):s[a]=!yd(e[a],t[a]);return s}var kd=(e,t)=>Nd(e,t,_d(t)),Sd=(e,{valueAsNumber:t,valueAsDate:s,setValueAs:r})=>vc(e)?e:t?""===e?NaN:e?+e:e:s&&Kc(e)?new Date(e):r?r(e):e;function Cd(e){const t=e.ref;if(!(e.refs?e.refs.every((e=>e.disabled)):t.disabled))return sd(t)?t.files:nd(t)?hd(e.refs).value:bd(t)?[...t.selectedOptions].map((({value:e})=>e)):lc(t)?dd(e.refs).value:Sd(vc(t.value)?e.ref.value:t.value,e)}var Ed=e=>vc(e)?e:od(e)?e.source:hc(e)?od(e.value)?e.value.source:e.value:e;const Td="AsyncFunction";function Pd(e,t,s){const r=yc(e,s);if(r||wc(s))return{error:r,name:s};const a=s.split(".");for(;a.length;){const r=a.join("."),i=yc(t,r),n=yc(e,r);if(i&&!Array.isArray(i)&&s!==r)return{name:s};if(n&&n.type)return{name:r,error:n};a.pop()}return{name:s}}const Ad={mode:Tc,reValidateMode:Ec,shouldFocusError:!0};function Rd(e={}){let t,s=l(l({},Ad),e),r={submitCount:0,isDirty:!1,isLoading:rd(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},a={},i=(hc(s.defaultValues)||hc(s.values))&&xc(s.defaultValues||s.values)||{},n=s.shouldUnregister?{}:xc(i),o={action:!1,mount:!1,watch:!1},u={mount:new Set,unMount:new Set,array:new Set,watch:new Set},m=0;const p={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},f={values:gd(),array:gd(),state:gd()},x=Yc(s.mode),g=Yc(s.reValidateMode),v=s.criteriaMode===Ac,y=t=>h(this,null,(function*(){if(!e.disabled&&(p.isValid||t)){const e=s.resolver?qc((yield N()).errors):yield S(a,!0);e!==r.isValid&&f.state.next({isValid:e})}})),b=(t,s)=>{e.disabled||!p.isValidating&&!p.validatingFields||((t||Array.from(u.mount)).forEach((e=>{e&&(s?_c(r.validatingFields,e,s):xd(r.validatingFields,e))})),f.state.next({validatingFields:r.validatingFields,isValidating:!qc(r.validatingFields)}))},w=(e,t,s,r)=>{const l=yc(a,e);if(l){const a=yc(n,e,vc(s)?yc(i,e):s);vc(a)||r&&r.defaultChecked||t?_c(n,e,t?a:Cd(l._f)):T(e,a),o.mount&&y()}},j=(t,s,n,o,l)=>{let c=!1,d=!1;const u={name:t};if(!e.disabled){const e=!!(yc(a,t)&&yc(a,t)._f&&yc(a,t)._f.disabled);if(!n||o){p.isDirty&&(d=r.isDirty,r.isDirty=u.isDirty=C(),c=d!==u.isDirty);const a=e||yd(yc(i,t),s);d=!(e||!yc(r.dirtyFields,t)),a||e?xd(r.dirtyFields,t):_c(r.dirtyFields,t,!0),u.dirtyFields=r.dirtyFields,c=c||p.dirtyFields&&d!==!a}if(n){const e=yc(r.touchedFields,t);e||(_c(r.touchedFields,t,n),u.touchedFields=r.touchedFields,c=c||p.touchedFields&&e!==n)}c&&l&&f.state.next(u)}return c?u:{}},_=(s,a,i,n)=>{const o=yc(r.errors,s),d=p.isValid&&bc(a)&&r.isValid!==a;var u;if(e.delayError&&i?(u=()=>((e,t)=>{_c(r.errors,e,t),f.state.next({errors:r.errors})})(s,i),t=e=>{clearTimeout(m),m=setTimeout(u,e)},t(e.delayError)):(clearTimeout(m),t=null,i?_c(r.errors,s,i):xd(r.errors,s)),(i?!yd(o,i):o)||!qc(n)||d){const e=c(l(l({},n),d&&bc(a)?{isValid:a}:{}),{errors:r.errors,name:s});r=l(l({},r),e),f.state.next(e)}},N=e=>h(this,null,(function*(){b(e,!0);const t=yield s.resolver(n,s.context,((e,t,s,r)=>{const a={};for(const i of e){const e=yc(t,i);e&&_c(a,i,e._f)}return{criteriaMode:s,names:[...e],fields:a,shouldUseNativeValidation:r}})(e||u.mount,a,s.criteriaMode,s.shouldUseNativeValidation));return b(e),t})),k=e=>h(this,null,(function*(){const{errors:t}=yield N(e);if(e)for(const s of e){const e=yc(t,s);e?_c(r.errors,s,e):xd(r.errors,s)}else r.errors=t;return t})),S=(e,t,...a)=>h(this,[e,t,...a],(function*(e,t,a={valid:!0}){for(const o in e){const l=e[o];if(l){const e=l,{_f:c}=e,h=d(e,["_f"]);if(c){const e=u.array.has(c.name),d=l._f&&!((i=l._f)&&i.validate||!(rd(i.validate)&&i.validate.constructor.name===Td||hc(i.validate)&&Object.values(i.validate).find((e=>e.constructor.name===Td))));d&&p.validatingFields&&b([o],!0);const h=yield fd(l,n,v,s.shouldUseNativeValidation&&!t,e);if(d&&p.validatingFields&&b([o]),h[c.name]&&(a.valid=!1,t))break;!t&&(yc(h,c.name)?e?td(r.errors,h,c.name):_c(r.errors,c.name,h[c.name]):xd(r.errors,c.name))}!qc(h)&&(yield S(h,t,a))}}var i;return a.valid})),C=(t,s)=>!e.disabled&&(t&&s&&_c(n,t,s),!yd($(),i)),E=(e,t,s)=>Wc(e,u,l({},o.mount?n:vc(t)?i:Kc(e)?{[e]:t}:t),s,t),T=(e,t,s={})=>{const r=yc(a,e);let i=t;if(r){const s=r._f;s&&(!s.disabled&&_c(n,e,Sd(t,s)),i=ad(s.ref)&&dc(t)?"":t,bd(s.ref)?[...s.ref.options].forEach((e=>e.selected=i.includes(e.value))):s.refs?lc(s.ref)?s.refs.length>1?s.refs.forEach((e=>(!e.defaultChecked||!e.disabled)&&(e.checked=Array.isArray(i)?!!i.find((t=>t===e.value)):i===e.value))):s.refs[0]&&(s.refs[0].checked=!!i):s.refs.forEach((e=>e.checked=e.value===i)):sd(s.ref)?s.ref.value="":(s.ref.value=i,s.ref.type||f.values.next({name:e,values:l({},n)})))}(s.shouldDirty||s.shouldTouch)&&j(e,i,s.shouldTouch,s.shouldDirty,!0),s.shouldValidate&&I(e)},P=(e,t,s)=>{for(const r in t){const i=t[r],n=`${e}.${r}`,o=yc(a,n);(u.array.has(e)||hc(i)||o&&!o._f)&&!cc(i)?P(n,i,s):T(n,i,s)}},A=(e,t,s={})=>{const c=yc(a,e),d=u.array.has(e),h=xc(t);_c(n,e,h),d?(f.array.next({name:e,values:l({},n)}),(p.isDirty||p.dirtyFields)&&s.shouldDirty&&f.state.next({name:e,dirtyFields:kd(i,n),isDirty:C(e,h)})):!c||c._f||dc(h)?T(e,h,s):P(e,h,s),Qc(e,u)&&f.state.next(l({},r)),f.values.next({name:o.mount?e:void 0,values:l({},n)})},R=i=>h(this,null,(function*(){o.mount=!0;const c=i.target;let d=c.name,h=!0;const m=yc(a,d),w=e=>{h=Number.isNaN(e)||cc(e)&&isNaN(e.getTime())||yd(e,yc(n,d,e))};if(m){let o,k;const C=c.type?Cd(m._f):mc(i),E=i.type===Nc||i.type===kc,T=!(e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate))(m._f)&&!s.resolver&&!yc(r.errors,d)&&!m._f.deps||((e,t,s,r,a)=>!a.isOnAll&&(!s&&a.isOnTouch?!(t||e):(s?r.isOnBlur:a.isOnBlur)?!e:!(s?r.isOnChange:a.isOnChange)||e))(E,yc(r.touchedFields,d),r.isSubmitted,g,x),P=Qc(d,u,E);_c(n,d,C),E?(m._f.onBlur&&m._f.onBlur(i),t&&t(0)):m._f.onChange&&m._f.onChange(i);const A=j(d,C,E,!1),R=!qc(A)||P;if(!E&&f.values.next({name:d,type:i.type,values:l({},n)}),T)return p.isValid&&("onBlur"===e.mode?E&&y():y()),R&&f.state.next(l({name:d},P?{}:A));if(!E&&P&&f.state.next(l({},r)),s.resolver){const{errors:e}=yield N([d]);if(w(C),h){const t=Pd(r.errors,a,d),s=Pd(e,a,t.name||d);o=s.error,d=s.name,k=qc(e)}}else b([d],!0),o=(yield fd(m,n,v,s.shouldUseNativeValidation))[d],b([d]),w(C),h&&(o?k=!1:p.isValid&&(k=yield S(a,!0)));h&&(m._f.deps&&I(m._f.deps),_(d,k,o,A))}})),O=(e,t)=>{if(yc(r.errors,t)&&e.focus)return e.focus(),1},I=(e,...t)=>h(this,[e,...t],(function*(e,t={}){let i,n;const o=Bc(e);if(s.resolver){const t=yield k(vc(e)?e:o);i=qc(t),n=e?!o.some((e=>yc(t,e))):i}else e?(n=(yield Promise.all(o.map((e=>h(this,null,(function*(){const t=yc(a,e);return yield S(t&&t._f?{[e]:t}:t)})))))).every(Boolean),(n||r.isValid)&&y()):n=i=yield S(a);return f.state.next(c(l(l({},!Kc(e)||p.isValid&&i!==r.isValid?{}:{name:e}),s.resolver||!e?{isValid:i}:{}),{errors:r.errors})),t.shouldFocus&&!n&&ed(a,O,e?o:u.mount),n})),$=e=>{const t=l({},o.mount?n:i);return vc(e)?t:Kc(e)?yc(t,e):e.map((e=>yc(t,e)))},D=(e,t)=>({invalid:!!yc((t||r).errors,e),isDirty:!!yc((t||r).dirtyFields,e),error:yc((t||r).errors,e),isValidating:!!yc(r.validatingFields,e),isTouched:!!yc((t||r).touchedFields,e)}),L=(e,t,s)=>{const i=(yc(a,e,{_f:{}})._f||{}).ref,n=yc(r.errors,e)||{},{ref:o,message:u,type:h}=n,m=d(n,["ref","message","type"]);_c(r.errors,e,c(l(l({},m),t),{ref:i})),f.state.next({name:e,errors:r.errors,isValid:!1}),s&&s.shouldFocus&&i&&i.focus&&i.focus()},M=(e,t={})=>{for(const o of e?Bc(e):u.mount)u.mount.delete(o),u.array.delete(o),t.keepValue||(xd(a,o),xd(n,o)),!t.keepError&&xd(r.errors,o),!t.keepDirty&&xd(r.dirtyFields,o),!t.keepTouched&&xd(r.touchedFields,o),!t.keepIsValidating&&xd(r.validatingFields,o),!s.shouldUnregister&&!t.keepDefaultValue&&xd(i,o);f.values.next({values:l({},n)}),f.state.next(l(l({},r),t.keepDirty?{isDirty:C()}:{})),!t.keepIsValid&&y()},U=({disabled:e,name:t,field:s,fields:r,value:a})=>{if(bc(e)&&o.mount||e){const i=e?void 0:vc(a)?Cd(s?s._f:yc(r,t)._f):a;_c(n,t,i),j(t,i,!1,!1,!0)}},F=(t,r={})=>{let n=yc(a,t);const d=bc(r.disabled)||bc(e.disabled);return _c(a,t,c(l({},n||{}),{_f:l(c(l({},n&&n._f?n._f:{ref:{name:t}}),{name:t,mount:!0}),r)})),u.mount.add(t),n?U({field:n,disabled:bc(r.disabled)?r.disabled:e.disabled,name:t,value:r.value}):w(t,!0,r.value),c(l(l({},d?{disabled:r.disabled||e.disabled}:{}),s.progressive?{required:!!r.required,min:Ed(r.min),max:Ed(r.max),minLength:Ed(r.minLength),maxLength:Ed(r.maxLength),pattern:Ed(r.pattern)}:{}),{name:t,onChange:R,onBlur:R,ref:e=>{if(e){F(t,r),n=yc(a,t);const s=vc(e.value)&&e.querySelectorAll&&e.querySelectorAll("input,select,textarea")[0]||e,o=(e=>nd(e)||lc(e))(s),c=n._f.refs||[];if(o?c.find((e=>e===s)):s===n._f.ref)return;_c(a,t,{_f:l(l({},n._f),o?{refs:[...c.filter(wd),s,...Array.isArray(yc(i,t))?[{}]:[]],ref:{type:s.type,name:t}}:{ref:s})}),w(t,!1,void 0,s)}else n=yc(a,t,{}),n._f&&(n._f.mount=!1),(s.shouldUnregister||r.shouldUnregister)&&(!pc(u.array,t)||!o.action)&&u.unMount.add(t)}})},V=()=>s.shouldFocusError&&ed(a,O,u.mount),q=(e,t)=>i=>h(this,null,(function*(){let o;i&&(i.preventDefault&&i.preventDefault(),i.persist&&i.persist());let c=xc(n);if(f.state.next({isSubmitting:!0}),s.resolver){const{errors:e,values:t}=yield N();r.errors=e,c=t}else yield S(a);if(xd(r.errors,"root"),qc(r.errors)){f.state.next({errors:{}});try{yield e(c,i)}catch(d){o=d}}else t&&(yield t(l({},r.errors),i)),V(),setTimeout(V);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:qc(r.errors)&&!o,submitCount:r.submitCount+1,errors:r.errors}),o)throw o})),z=(t,s={})=>{const c=t?xc(t):i,d=xc(c),h=qc(t),m=h?i:d;if(s.keepDefaultValues||(i=c),!s.keepValues){if(s.keepDirtyValues){const e=new Set([...u.mount,...Object.keys(kd(i,n))]);for(const t of Array.from(e))yc(r.dirtyFields,t)?_c(m,t,yc(n,t)):A(t,yc(m,t))}else{if(fc&&vc(t))for(const e of u.mount){const t=yc(a,e);if(t&&t._f){const e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;if(ad(e)){const t=e.closest("form");if(t){t.reset();break}}}}a={}}n=e.shouldUnregister?s.keepDefaultValues?xc(i):{}:xc(m),f.array.next({values:l({},m)}),f.values.next({values:l({},m)})}u={mount:s.keepDirtyValues?u.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!p.isValid||!!s.keepIsValid||!!s.keepDirtyValues,o.watch=!!e.shouldUnregister,f.state.next({submitCount:s.keepSubmitCount?r.submitCount:0,isDirty:!h&&(s.keepDirty?r.isDirty:!(!s.keepDefaultValues||yd(t,i))),isSubmitted:!!s.keepIsSubmitted&&r.isSubmitted,dirtyFields:h?{}:s.keepDirtyValues?s.keepDefaultValues&&n?kd(i,n):r.dirtyFields:s.keepDefaultValues&&t?kd(i,t):s.keepDirty?r.dirtyFields:{},touchedFields:s.keepTouched?r.touchedFields:{},errors:s.keepErrors?r.errors:{},isSubmitSuccessful:!!s.keepIsSubmitSuccessful&&r.isSubmitSuccessful,isSubmitting:!1})},B=(e,t)=>z(rd(e)?e(n):e,t);return{control:{register:F,unregister:M,getFieldState:D,handleSubmit:q,setError:L,_executeSchema:N,_getWatch:E,_getDirty:C,_updateValid:y,_removeUnmounted:()=>{for(const e of u.unMount){const t=yc(a,e);t&&(t._f.refs?t._f.refs.every((e=>!wd(e))):!wd(t._f.ref))&&M(e)}u.unMount=new Set},_updateFieldArray:(t,s=[],l,c,d=!0,u=!0)=>{if(c&&l&&!e.disabled){if(o.action=!0,u&&Array.isArray(yc(a,t))){const e=l(yc(a,t),c.argA,c.argB);d&&_c(a,t,e)}if(u&&Array.isArray(yc(r.errors,t))){const e=l(yc(r.errors,t),c.argA,c.argB);d&&_c(r.errors,t,e),((e,t)=>{!gc(yc(e,t)).length&&xd(e,t)})(r.errors,t)}if(p.touchedFields&&u&&Array.isArray(yc(r.touchedFields,t))){const e=l(yc(r.touchedFields,t),c.argA,c.argB);d&&_c(r.touchedFields,t,e)}p.dirtyFields&&(r.dirtyFields=kd(i,n)),f.state.next({name:t,isDirty:C(t,s),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else _c(n,t,s)},_updateDisabledField:U,_getFieldArray:t=>gc(yc(o.mount?n:i,t,e.shouldUnregister?yc(i,t,[]):[])),_reset:z,_resetDefaultValues:()=>rd(s.defaultValues)&&s.defaultValues().then((e=>{B(e,s.resetOptions),f.state.next({isLoading:!1})})),_updateFormState:e=>{r=l(l({},r),e)},_disableForm:e=>{bc(e)&&(f.state.next({disabled:e}),ed(a,((t,s)=>{const r=yc(a,s);r&&(t.disabled=r._f.disabled||e,Array.isArray(r._f.refs)&&r._f.refs.forEach((t=>{t.disabled=r._f.disabled||e})))}),0,!1))},_subjects:f,_proxyFormState:p,_setErrors:e=>{r.errors=e,f.state.next({errors:r.errors,isValid:!1})},get _fields(){return a},get _formValues(){return n},get _state(){return o},set _state(e){o=e},get _defaultValues(){return i},get _names(){return u},set _names(e){u=e},get _formState(){return r},set _formState(e){r=e},get _options(){return s},set _options(e){s=l(l({},s),e)}},trigger:I,register:F,handleSubmit:q,watch:(e,t)=>rd(e)?f.values.subscribe({next:s=>e(E(void 0,t),s)}):E(e,t,!0),setValue:A,getValues:$,reset:B,resetField:(e,t={})=>{yc(a,e)&&(vc(t.defaultValue)?A(e,xc(yc(i,e))):(A(e,t.defaultValue),_c(i,e,xc(t.defaultValue))),t.keepTouched||xd(r.touchedFields,e),t.keepDirty||(xd(r.dirtyFields,e),r.isDirty=t.defaultValue?C(e,xc(yc(i,e))):C()),t.keepError||(xd(r.errors,e),p.isValid&&y()),f.state.next(l({},r)))},clearErrors:e=>{e&&Bc(e).forEach((e=>xd(r.errors,e))),f.state.next({errors:e?r.errors:{}})},unregister:M,setError:L,setFocus:(e,t={})=>{const s=yc(a,e),r=s&&s._f;if(r){const e=r.refs?r.refs[0]:r.ref;e.focus&&(e.focus(),t.shouldSelect&&e.select())}},getFieldState:D}}const Od=(e,t,s)=>{if(e&&"reportValidity"in e){const r=yc(s,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},Id=(e,t)=>{for(const s in t.fields){const r=t.fields[s];r&&r.ref&&"reportValidity"in r.ref?Od(r.ref,s,e):r.refs&&r.refs.forEach((t=>Od(t,s,e)))}},$d=(e,t)=>{t.shouldUseNativeValidation&&Id(e,t);const s={};for(const r in e){const a=yc(t.fields,r),i=Object.assign(e[r]||{},{ref:a&&a.ref});if(Dd(t.names||Object.keys(e),r)){const e=Object.assign({},yc(s,r));_c(e,"root",i),_c(s,r,e)}else _c(s,r,i)}return s},Dd=(e,t)=>e.some((e=>e.startsWith(t+".")));var Ld,Md,Ud,Fd=function(e,t){for(var s={};e.length;){var r=e[0],a=r.code,i=r.message,n=r.path.join(".");if(!s[n])if("unionErrors"in r){var o=r.unionErrors[0].errors[0];s[n]={message:o.message,type:o.code}}else s[n]={message:i,type:a};if("unionErrors"in r&&r.unionErrors.forEach((function(t){return t.errors.forEach((function(t){return e.push(t)}))})),t){var l=s[n].types,c=l&&l[r.code];s[n]=Xc(n,t,s,a,c?[].concat(c,r.message):r.message)}e.shift()}return s};(Md=Ld||(Ld={})).assertEqual=e=>e,Md.assertIs=function(e){},Md.assertNever=function(e){throw new Error},Md.arrayToEnum=e=>{const t={};for(const s of e)t[s]=s;return t},Md.getValidEnumValues=e=>{const t=Md.objectKeys(e).filter((t=>"number"!=typeof e[e[t]])),s={};for(const r of t)s[r]=e[r];return Md.objectValues(s)},Md.objectValues=e=>Md.objectKeys(e).map((function(t){return e[t]})),Md.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},Md.find=(e,t)=>{for(const s of e)if(t(s))return s},Md.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,Md.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},Md.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(Ud||(Ud={})).mergeShapes=(e,t)=>l(l({},e),t);const Vd=Ld.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),qd=e=>{switch(typeof e){case"undefined":return Vd.undefined;case"string":return Vd.string;case"number":return isNaN(e)?Vd.nan:Vd.number;case"boolean":return Vd.boolean;case"function":return Vd.function;case"bigint":return Vd.bigint;case"symbol":return Vd.symbol;case"object":return Array.isArray(e)?Vd.array:null===e?Vd.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Vd.promise:"undefined"!=typeof Map&&e instanceof Map?Vd.map:"undefined"!=typeof Set&&e instanceof Set?Vd.set:"undefined"!=typeof Date&&e instanceof Date?Vd.date:Vd.object;default:return Vd.unknown}},zd=Ld.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Bd extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},s={_errors:[]},r=e=>{for(const a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(r);else if("invalid_return_type"===a.code)r(a.returnTypeError);else if("invalid_arguments"===a.code)r(a.argumentsError);else if(0===a.path.length)s._errors.push(t(a));else{let e=s,r=0;for(;r<a.path.length;){const s=a.path[r];r===a.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(a))):e[s]=e[s]||{_errors:[]},e=e[s],r++}}};return r(this),s}static assert(e){if(!(e instanceof Bd))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ld.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},s=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}Bd.create=e=>new Bd(e);const Zd=(e,t)=>{let s;switch(e.code){case zd.invalid_type:s=e.received===Vd.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case zd.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,Ld.jsonStringifyReplacer)}`;break;case zd.unrecognized_keys:s=`Unrecognized key(s) in object: ${Ld.joinValues(e.keys,", ")}`;break;case zd.invalid_union:s="Invalid input";break;case zd.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${Ld.joinValues(e.options)}`;break;case zd.invalid_enum_value:s=`Invalid enum value. Expected ${Ld.joinValues(e.options)}, received '${e.received}'`;break;case zd.invalid_arguments:s="Invalid function arguments";break;case zd.invalid_return_type:s="Invalid function return type";break;case zd.invalid_date:s="Invalid date";break;case zd.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:Ld.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case zd.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case zd.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case zd.custom:s="Invalid input";break;case zd.invalid_intersection_types:s="Intersection results could not be merged";break;case zd.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case zd.not_finite:s="Number must be finite";break;default:s=t.defaultError,Ld.assertNever(e)}return{message:s}};let Hd=Zd;function Kd(){return Hd}const Wd=e=>{const{data:t,path:s,errorMaps:r,issueData:a}=e,i=[...s,...a.path||[]],n=c(l({},a),{path:i});if(void 0!==a.message)return c(l({},a),{path:i,message:a.message});let o="";const d=r.filter((e=>!!e)).slice().reverse();for(const l of d)o=l(n,{data:t,defaultError:o}).message;return c(l({},a),{path:i,message:o})};function Gd(e,t){const s=Kd(),r=Wd({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===Zd?void 0:Zd].filter((e=>!!e))});e.common.issues.push(r)}class Jd{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const r of t){if("aborted"===r.status)return Xd;"dirty"===r.status&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static mergeObjectAsync(e,t){return h(this,null,(function*(){const s=[];for(const e of t){const t=yield e.key,r=yield e.value;s.push({key:t,value:r})}return Jd.mergeObjectSync(e,s)}))}static mergeObjectSync(e,t){const s={};for(const r of t){const{key:t,value:a}=r;if("aborted"===t.status)return Xd;if("aborted"===a.status)return Xd;"dirty"===t.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===t.value||void 0===a.value&&!r.alwaysSet||(s[t.value]=a.value)}return{status:e.value,value:s}}}const Xd=Object.freeze({status:"aborted"}),Yd=e=>({status:"dirty",value:e}),Qd=e=>({status:"valid",value:e}),eu=e=>"aborted"===e.status,tu=e=>"dirty"===e.status,su=e=>"valid"===e.status,ru=e=>"undefined"!=typeof Promise&&e instanceof Promise;function au(e,t,s,r){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function iu(e,t,s,r,a){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s}var nu,ou,lu,cu;"function"==typeof SuppressedError&&SuppressedError,(ou=nu||(nu={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},ou.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;class du{constructor(e,t,s,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const uu=(e,t)=>{if(su(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Bd(e.common.issues);return this._error=t,this._error}}};function hu(e){if(!e)return{};const{errorMap:t,invalid_type_error:s,required_error:r,description:a}=e;if(t&&(s||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:a};return{errorMap:(t,a)=>{var i,n;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:a.defaultError}:void 0===a.data?{message:null!==(i=null!=o?o:r)&&void 0!==i?i:a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:null!==(n=null!=o?o:s)&&void 0!==n?n:a.defaultError}},description:a}}class mu{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return qd(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:qd(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Jd,ctx:{common:e.parent.common,data:e.data,parsedType:qd(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ru(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const r={common:{issues:[],async:null!==(s=null==t?void 0:t.async)&&void 0!==s&&s,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:qd(e)},a=this._parseSync({data:e,path:r.path,parent:r});return uu(r,a)}parseAsync(e,t){return h(this,null,(function*(){const s=yield this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}))}safeParseAsync(e,t){return h(this,null,(function*(){const s={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:qd(e)},r=this._parse({data:e,path:s.path,parent:s}),a=yield ru(r)?r:Promise.resolve(r);return uu(s,a)}))}refine(e,t){return this._refinement(((s,r)=>{const a=e(s),i=()=>r.addIssue(l({code:zd.custom},(e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t)(s)));return"undefined"!=typeof Promise&&a instanceof Promise?a.then((e=>!!e||(i(),!1))):!!a||(i(),!1)}))}refinement(e,t){return this._refinement(((s,r)=>!!e(s)||(r.addIssue("function"==typeof t?t(s,r):t),!1)))}_refinement(e){return new rh({schema:this,typeName:hh.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ah.create(this,this._def)}nullable(){return ih.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return qu.create(this,this._def)}promise(){return sh.create(this,this._def)}or(e){return Zu.create([this,e],this._def)}and(e){return Ku.create(this,e,this._def)}transform(e){return new rh(c(l({},hu(this._def)),{schema:this,typeName:hh.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){const t="function"==typeof e?e:()=>e;return new nh(c(l({},hu(this._def)),{innerType:this,defaultValue:t,typeName:hh.ZodDefault}))}brand(){return new ch(l({typeName:hh.ZodBranded,type:this},hu(this._def)))}catch(e){const t="function"==typeof e?e:()=>e;return new oh(c(l({},hu(this._def)),{innerType:this,catchValue:t,typeName:hh.ZodCatch}))}describe(e){return new(0,this.constructor)(c(l({},this._def),{description:e}))}pipe(e){return dh.create(this,e)}readonly(){return uh.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const pu=/^c[^\s-]{8,}$/i,fu=/^[0-9a-z]+$/,xu=/^[0-9A-HJKMNP-TV-Z]{26}$/,gu=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vu=/^[a-z0-9_-]{21}$/i,yu=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bu=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let wu;const ju=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_u=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Nu=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ku="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Su=new RegExp(`^${ku}$`);function Cu(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function Eu(e){let t=`${ku}T${Cu(e)}`;const s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,new RegExp(`^${t}$`)}class Tu extends mu{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==Vd.string){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.string,received:t.parsedType}),Xd}const t=new Jd;let s;for(const n of this._def.checks)if("min"===n.kind)e.data.length<n.value&&(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),t.dirty());else if("max"===n.kind)e.data.length>n.value&&(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),t.dirty());else if("length"===n.kind){const r=e.data.length>n.value,a=e.data.length<n.value;(r||a)&&(s=this._getOrReturnCtx(e,s),r?Gd(s,{code:zd.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):a&&Gd(s,{code:zd.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),t.dirty())}else if("email"===n.kind)bu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"email",code:zd.invalid_string,message:n.message}),t.dirty());else if("emoji"===n.kind)wu||(wu=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),wu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"emoji",code:zd.invalid_string,message:n.message}),t.dirty());else if("uuid"===n.kind)gu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"uuid",code:zd.invalid_string,message:n.message}),t.dirty());else if("nanoid"===n.kind)vu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"nanoid",code:zd.invalid_string,message:n.message}),t.dirty());else if("cuid"===n.kind)pu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"cuid",code:zd.invalid_string,message:n.message}),t.dirty());else if("cuid2"===n.kind)fu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"cuid2",code:zd.invalid_string,message:n.message}),t.dirty());else if("ulid"===n.kind)xu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"ulid",code:zd.invalid_string,message:n.message}),t.dirty());else if("url"===n.kind)try{new URL(e.data)}catch(i){s=this._getOrReturnCtx(e,s),Gd(s,{validation:"url",code:zd.invalid_string,message:n.message}),t.dirty()}else if("regex"===n.kind){n.regex.lastIndex=0;n.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"regex",code:zd.invalid_string,message:n.message}),t.dirty())}else if("trim"===n.kind)e.data=e.data.trim();else if("includes"===n.kind)e.data.includes(n.value,n.position)||(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),t.dirty());else if("toLowerCase"===n.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===n.kind)e.data=e.data.toUpperCase();else if("startsWith"===n.kind)e.data.startsWith(n.value)||(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.invalid_string,validation:{startsWith:n.value},message:n.message}),t.dirty());else if("endsWith"===n.kind)e.data.endsWith(n.value)||(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.invalid_string,validation:{endsWith:n.value},message:n.message}),t.dirty());else if("datetime"===n.kind){Eu(n).test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.invalid_string,validation:"datetime",message:n.message}),t.dirty())}else if("date"===n.kind){Su.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.invalid_string,validation:"date",message:n.message}),t.dirty())}else if("time"===n.kind){new RegExp(`^${Cu(n)}$`).test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.invalid_string,validation:"time",message:n.message}),t.dirty())}else"duration"===n.kind?yu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"duration",code:zd.invalid_string,message:n.message}),t.dirty()):"ip"===n.kind?(r=e.data,("v4"!==(a=n.version)&&a||!ju.test(r))&&("v6"!==a&&a||!_u.test(r))&&(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"ip",code:zd.invalid_string,message:n.message}),t.dirty())):"base64"===n.kind?Nu.test(e.data)||(s=this._getOrReturnCtx(e,s),Gd(s,{validation:"base64",code:zd.invalid_string,message:n.message}),t.dirty()):Ld.assertNever(n);var r,a;return{status:t.value,value:e.data}}_regex(e,t,s){return this.refinement((t=>e.test(t)),l({validation:t,code:zd.invalid_string},nu.errToObj(s)))}_addCheck(e){return new Tu(c(l({},this._def),{checks:[...this._def.checks,e]}))}email(e){return this._addCheck(l({kind:"email"},nu.errToObj(e)))}url(e){return this._addCheck(l({kind:"url"},nu.errToObj(e)))}emoji(e){return this._addCheck(l({kind:"emoji"},nu.errToObj(e)))}uuid(e){return this._addCheck(l({kind:"uuid"},nu.errToObj(e)))}nanoid(e){return this._addCheck(l({kind:"nanoid"},nu.errToObj(e)))}cuid(e){return this._addCheck(l({kind:"cuid"},nu.errToObj(e)))}cuid2(e){return this._addCheck(l({kind:"cuid2"},nu.errToObj(e)))}ulid(e){return this._addCheck(l({kind:"ulid"},nu.errToObj(e)))}base64(e){return this._addCheck(l({kind:"base64"},nu.errToObj(e)))}ip(e){return this._addCheck(l({kind:"ip"},nu.errToObj(e)))}datetime(e){var t,s;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck(l({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(s=null==e?void 0:e.local)&&void 0!==s&&s},nu.errToObj(null==e?void 0:e.message)))}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck(l({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision},nu.errToObj(null==e?void 0:e.message)))}duration(e){return this._addCheck(l({kind:"duration"},nu.errToObj(e)))}regex(e,t){return this._addCheck(l({kind:"regex",regex:e},nu.errToObj(t)))}includes(e,t){return this._addCheck(l({kind:"includes",value:e,position:null==t?void 0:t.position},nu.errToObj(null==t?void 0:t.message)))}startsWith(e,t){return this._addCheck(l({kind:"startsWith",value:e},nu.errToObj(t)))}endsWith(e,t){return this._addCheck(l({kind:"endsWith",value:e},nu.errToObj(t)))}min(e,t){return this._addCheck(l({kind:"min",value:e},nu.errToObj(t)))}max(e,t){return this._addCheck(l({kind:"max",value:e},nu.errToObj(t)))}length(e,t){return this._addCheck(l({kind:"length",value:e},nu.errToObj(t)))}nonempty(e){return this.min(1,nu.errToObj(e))}trim(){return new Tu(c(l({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new Tu(c(l({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new Tu(c(l({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Pu(e,t){const s=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=s>r?s:r;return parseInt(e.toFixed(a).replace(".",""))%parseInt(t.toFixed(a).replace(".",""))/Math.pow(10,a)}Tu.create=e=>{var t;return new Tu(l({checks:[],typeName:hh.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t},hu(e)))};class Au extends mu{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==Vd.number){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.number,received:t.parsedType}),Xd}let t;const s=new Jd;for(const r of this._def.checks)if("int"===r.kind)Ld.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Gd(t,{code:zd.invalid_type,expected:"integer",received:"float",message:r.message}),s.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Gd(t,{code:zd.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Gd(t,{code:zd.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty())}else"multipleOf"===r.kind?0!==Pu(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),Gd(t,{code:zd.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Gd(t,{code:zd.not_finite,message:r.message}),s.dirty()):Ld.assertNever(r);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,nu.toString(t))}gt(e,t){return this.setLimit("min",e,!1,nu.toString(t))}lte(e,t){return this.setLimit("max",e,!0,nu.toString(t))}lt(e,t){return this.setLimit("max",e,!1,nu.toString(t))}setLimit(e,t,s,r){return new Au(c(l({},this._def),{checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:nu.toString(r)}]}))}_addCheck(e){return new Au(c(l({},this._def),{checks:[...this._def.checks,e]}))}int(e){return this._addCheck({kind:"int",message:nu.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:nu.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:nu.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:nu.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:nu.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:nu.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:nu.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:nu.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:nu.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&Ld.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Au.create=e=>new Au(l({checks:[],typeName:hh.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1},hu(e)));class Ru extends mu{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==Vd.bigint){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.bigint,received:t.parsedType}),Xd}let t;const s=new Jd;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Gd(t,{code:zd.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Gd(t,{code:zd.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Gd(t,{code:zd.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):Ld.assertNever(r);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,nu.toString(t))}gt(e,t){return this.setLimit("min",e,!1,nu.toString(t))}lte(e,t){return this.setLimit("max",e,!0,nu.toString(t))}lt(e,t){return this.setLimit("max",e,!1,nu.toString(t))}setLimit(e,t,s,r){return new Ru(c(l({},this._def),{checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:nu.toString(r)}]}))}_addCheck(e){return new Ru(c(l({},this._def),{checks:[...this._def.checks,e]}))}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:nu.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:nu.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:nu.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:nu.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:nu.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Ru.create=e=>{var t;return new Ru(l({checks:[],typeName:hh.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t},hu(e)))};class Ou extends mu{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==Vd.boolean){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.boolean,received:t.parsedType}),Xd}return Qd(e.data)}}Ou.create=e=>new Ou(l({typeName:hh.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1},hu(e)));class Iu extends mu{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==Vd.date){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.date,received:t.parsedType}),Xd}if(isNaN(e.data.getTime())){return Gd(this._getOrReturnCtx(e),{code:zd.invalid_date}),Xd}const t=new Jd;let s;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(s=this._getOrReturnCtx(e,s),Gd(s,{code:zd.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):Ld.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Iu(c(l({},this._def),{checks:[...this._def.checks,e]}))}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:nu.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:nu.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Iu.create=e=>new Iu(l({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:hh.ZodDate},hu(e)));class $u extends mu{_parse(e){if(this._getType(e)!==Vd.symbol){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.symbol,received:t.parsedType}),Xd}return Qd(e.data)}}$u.create=e=>new $u(l({typeName:hh.ZodSymbol},hu(e)));class Du extends mu{_parse(e){if(this._getType(e)!==Vd.undefined){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.undefined,received:t.parsedType}),Xd}return Qd(e.data)}}Du.create=e=>new Du(l({typeName:hh.ZodUndefined},hu(e)));class Lu extends mu{_parse(e){if(this._getType(e)!==Vd.null){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.null,received:t.parsedType}),Xd}return Qd(e.data)}}Lu.create=e=>new Lu(l({typeName:hh.ZodNull},hu(e)));class Mu extends mu{constructor(){super(...arguments),this._any=!0}_parse(e){return Qd(e.data)}}Mu.create=e=>new Mu(l({typeName:hh.ZodAny},hu(e)));class Uu extends mu{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Qd(e.data)}}Uu.create=e=>new Uu(l({typeName:hh.ZodUnknown},hu(e)));class Fu extends mu{_parse(e){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.never,received:t.parsedType}),Xd}}Fu.create=e=>new Fu(l({typeName:hh.ZodNever},hu(e)));class Vu extends mu{_parse(e){if(this._getType(e)!==Vd.undefined){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.void,received:t.parsedType}),Xd}return Qd(e.data)}}Vu.create=e=>new Vu(l({typeName:hh.ZodVoid},hu(e)));class qu extends mu{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==Vd.array)return Gd(t,{code:zd.invalid_type,expected:Vd.array,received:t.parsedType}),Xd;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,a=t.data.length<r.exactLength.value;(e||a)&&(Gd(t,{code:e?zd.too_big:zd.too_small,minimum:a?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(Gd(t,{code:zd.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(Gd(t,{code:zd.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map(((e,s)=>r.type._parseAsync(new du(t,e,t.path,s))))).then((e=>Jd.mergeArray(s,e)));const a=[...t.data].map(((e,s)=>r.type._parseSync(new du(t,e,t.path,s))));return Jd.mergeArray(s,a)}get element(){return this._def.type}min(e,t){return new qu(c(l({},this._def),{minLength:{value:e,message:nu.toString(t)}}))}max(e,t){return new qu(c(l({},this._def),{maxLength:{value:e,message:nu.toString(t)}}))}length(e,t){return new qu(c(l({},this._def),{exactLength:{value:e,message:nu.toString(t)}}))}nonempty(e){return this.min(1,e)}}function zu(e){if(e instanceof Bu){const t={};for(const s in e.shape){const r=e.shape[s];t[s]=ah.create(zu(r))}return new Bu(c(l({},e._def),{shape:()=>t}))}return e instanceof qu?new qu(c(l({},e._def),{type:zu(e.element)})):e instanceof ah?ah.create(zu(e.unwrap())):e instanceof ih?ih.create(zu(e.unwrap())):e instanceof Wu?Wu.create(e.items.map((e=>zu(e)))):e}qu.create=(e,t)=>new qu(l({type:e,minLength:null,maxLength:null,exactLength:null,typeName:hh.ZodArray},hu(t)));class Bu extends mu{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Ld.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Vd.object){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.object,received:t.parsedType}),Xd}const{status:t,ctx:s}=this._processInputParams(e),{shape:r,keys:a}=this._getCached(),i=[];if(!(this._def.catchall instanceof Fu&&"strip"===this._def.unknownKeys))for(const o in s.data)a.includes(o)||i.push(o);const n=[];for(const o of a){const e=r[o],t=s.data[o];n.push({key:{status:"valid",value:o},value:e._parse(new du(s,t,s.path,o)),alwaysSet:o in s.data})}if(this._def.catchall instanceof Fu){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of i)n.push({key:{status:"valid",value:t},value:{status:"valid",value:s.data[t]}});else if("strict"===e)i.length>0&&(Gd(s,{code:zd.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const r=s.data[t];n.push({key:{status:"valid",value:t},value:e._parse(new du(s,r,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then((()=>h(this,null,(function*(){const e=[];for(const t of n){const s=yield t.key,r=yield t.value;e.push({key:s,value:r,alwaysSet:t.alwaysSet})}return e})))).then((e=>Jd.mergeObjectSync(t,e))):Jd.mergeObjectSync(t,n)}get shape(){return this._def.shape()}strict(e){return nu.errToObj,new Bu(l(c(l({},this._def),{unknownKeys:"strict"}),void 0!==e?{errorMap:(t,s)=>{var r,a,i,n;const o=null!==(i=null===(a=(r=this._def).errorMap)||void 0===a?void 0:a.call(r,t,s).message)&&void 0!==i?i:s.defaultError;return"unrecognized_keys"===t.code?{message:null!==(n=nu.errToObj(e).message)&&void 0!==n?n:o}:{message:o}}}:{}))}strip(){return new Bu(c(l({},this._def),{unknownKeys:"strip"}))}passthrough(){return new Bu(c(l({},this._def),{unknownKeys:"passthrough"}))}extend(e){return new Bu(c(l({},this._def),{shape:()=>l(l({},this._def.shape()),e)}))}merge(e){return new Bu({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>l(l({},this._def.shape()),e._def.shape()),typeName:hh.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Bu(c(l({},this._def),{catchall:e}))}pick(e){const t={};return Ld.objectKeys(e).forEach((s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])})),new Bu(c(l({},this._def),{shape:()=>t}))}omit(e){const t={};return Ld.objectKeys(this.shape).forEach((s=>{e[s]||(t[s]=this.shape[s])})),new Bu(c(l({},this._def),{shape:()=>t}))}deepPartial(){return zu(this)}partial(e){const t={};return Ld.objectKeys(this.shape).forEach((s=>{const r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()})),new Bu(c(l({},this._def),{shape:()=>t}))}required(e){const t={};return Ld.objectKeys(this.shape).forEach((s=>{if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof ah;)e=e._def.innerType;t[s]=e}})),new Bu(c(l({},this._def),{shape:()=>t}))}keyof(){return Qu(Ld.objectKeys(this.shape))}}Bu.create=(e,t)=>new Bu(l({shape:()=>e,unknownKeys:"strip",catchall:Fu.create(),typeName:hh.ZodObject},hu(t))),Bu.strictCreate=(e,t)=>new Bu(l({shape:()=>e,unknownKeys:"strict",catchall:Fu.create(),typeName:hh.ZodObject},hu(t))),Bu.lazycreate=(e,t)=>new Bu(l({shape:e,unknownKeys:"strip",catchall:Fu.create(),typeName:hh.ZodObject},hu(t)));class Zu extends mu{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map((e=>h(this,null,(function*(){const s=c(l({},t),{common:c(l({},t.common),{issues:[]}),parent:null});return{result:yield e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}}))))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const s=e.map((e=>new Bd(e.ctx.common.issues)));return Gd(t,{code:zd.invalid_union,unionErrors:s}),Xd}));{let e;const r=[];for(const i of s){const s=c(l({},t),{common:c(l({},t.common),{issues:[]}),parent:null}),a=i._parseSync({data:t.data,path:t.path,parent:s});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:s}),s.common.issues.length&&r.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const a=r.map((e=>new Bd(e)));return Gd(t,{code:zd.invalid_union,unionErrors:a}),Xd}}get options(){return this._def.options}}Zu.create=(e,t)=>new Zu(l({options:e,typeName:hh.ZodUnion},hu(t)));function Hu(e,t){const s=qd(e),r=qd(t);if(e===t)return{valid:!0,data:e};if(s===Vd.object&&r===Vd.object){const s=Ld.objectKeys(t),r=Ld.objectKeys(e).filter((e=>-1!==s.indexOf(e))),a=l(l({},e),t);for(const i of r){const s=Hu(e[i],t[i]);if(!s.valid)return{valid:!1};a[i]=s.data}return{valid:!0,data:a}}if(s===Vd.array&&r===Vd.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let r=0;r<e.length;r++){const a=Hu(e[r],t[r]);if(!a.valid)return{valid:!1};s.push(a.data)}return{valid:!0,data:s}}return s===Vd.date&&r===Vd.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class Ku extends mu{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=(e,r)=>{if(eu(e)||eu(r))return Xd;const a=Hu(e.value,r.value);return a.valid?((tu(e)||tu(r))&&t.dirty(),{status:t.value,value:a.data}):(Gd(s,{code:zd.invalid_intersection_types}),Xd)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Ku.create=(e,t,s)=>new Ku(l({left:e,right:t,typeName:hh.ZodIntersection},hu(s)));class Wu extends mu{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Vd.array)return Gd(s,{code:zd.invalid_type,expected:Vd.array,received:s.parsedType}),Xd;if(s.data.length<this._def.items.length)return Gd(s,{code:zd.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Xd;!this._def.rest&&s.data.length>this._def.items.length&&(Gd(s,{code:zd.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...s.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new du(s,e,s.path,t)):null})).filter((e=>!!e));return s.common.async?Promise.all(r).then((e=>Jd.mergeArray(t,e))):Jd.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new Wu(c(l({},this._def),{rest:e}))}}Wu.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Wu(l({items:e,typeName:hh.ZodTuple,rest:null},hu(t)))};class Gu extends mu{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Vd.map)return Gd(s,{code:zd.invalid_type,expected:Vd.map,received:s.parsedType}),Xd;const r=this._def.keyType,a=this._def.valueType,i=[...s.data.entries()].map((([e,t],i)=>({key:r._parse(new du(s,e,s.path,[i,"key"])),value:a._parse(new du(s,t,s.path,[i,"value"]))})));if(s.common.async){const e=new Map;return Promise.resolve().then((()=>h(this,null,(function*(){for(const s of i){const r=yield s.key,a=yield s.value;if("aborted"===r.status||"aborted"===a.status)return Xd;"dirty"!==r.status&&"dirty"!==a.status||t.dirty(),e.set(r.value,a.value)}return{status:t.value,value:e}}))))}{const e=new Map;for(const s of i){const r=s.key,a=s.value;if("aborted"===r.status||"aborted"===a.status)return Xd;"dirty"!==r.status&&"dirty"!==a.status||t.dirty(),e.set(r.value,a.value)}return{status:t.value,value:e}}}}Gu.create=(e,t,s)=>new Gu(l({valueType:t,keyType:e,typeName:hh.ZodMap},hu(s)));class Ju extends mu{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Vd.set)return Gd(s,{code:zd.invalid_type,expected:Vd.set,received:s.parsedType}),Xd;const r=this._def;null!==r.minSize&&s.data.size<r.minSize.value&&(Gd(s,{code:zd.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&s.data.size>r.maxSize.value&&(Gd(s,{code:zd.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const a=this._def.valueType;function i(e){const s=new Set;for(const r of e){if("aborted"===r.status)return Xd;"dirty"===r.status&&t.dirty(),s.add(r.value)}return{status:t.value,value:s}}const n=[...s.data.values()].map(((e,t)=>a._parse(new du(s,e,s.path,t))));return s.common.async?Promise.all(n).then((e=>i(e))):i(n)}min(e,t){return new Ju(c(l({},this._def),{minSize:{value:e,message:nu.toString(t)}}))}max(e,t){return new Ju(c(l({},this._def),{maxSize:{value:e,message:nu.toString(t)}}))}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ju.create=(e,t)=>new Ju(l({valueType:e,minSize:null,maxSize:null,typeName:hh.ZodSet},hu(t)));class Xu extends mu{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Xu.create=(e,t)=>new Xu(l({getter:e,typeName:hh.ZodLazy},hu(t)));class Yu extends mu{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Gd(t,{received:t.data,code:zd.invalid_literal,expected:this._def.value}),Xd}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Qu(e,t){return new eh(l({values:e,typeName:hh.ZodEnum},hu(t)))}Yu.create=(e,t)=>new Yu(l({value:e,typeName:hh.ZodLiteral},hu(t)));class eh extends mu{constructor(){super(...arguments),lu.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),s=this._def.values;return Gd(t,{expected:Ld.joinValues(s),received:t.parsedType,code:zd.invalid_type}),Xd}if(au(this,lu)||iu(this,lu,new Set(this._def.values)),!au(this,lu).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return Gd(t,{received:t.data,code:zd.invalid_enum_value,options:s}),Xd}return Qd(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eh.create(e,l(l({},this._def),t))}exclude(e,t=this._def){return eh.create(this.options.filter((t=>!e.includes(t))),l(l({},this._def),t))}}lu=new WeakMap,eh.create=Qu;class th extends mu{constructor(){super(...arguments),cu.set(this,void 0)}_parse(e){const t=Ld.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==Vd.string&&s.parsedType!==Vd.number){const e=Ld.objectValues(t);return Gd(s,{expected:Ld.joinValues(e),received:s.parsedType,code:zd.invalid_type}),Xd}if(au(this,cu)||iu(this,cu,new Set(Ld.getValidEnumValues(this._def.values))),!au(this,cu).has(e.data)){const e=Ld.objectValues(t);return Gd(s,{received:s.data,code:zd.invalid_enum_value,options:e}),Xd}return Qd(e.data)}get enum(){return this._def.values}}cu=new WeakMap,th.create=(e,t)=>new th(l({values:e,typeName:hh.ZodNativeEnum},hu(t)));class sh extends mu{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Vd.promise&&!1===t.common.async)return Gd(t,{code:zd.invalid_type,expected:Vd.promise,received:t.parsedType}),Xd;const s=t.parsedType===Vd.promise?t.data:Promise.resolve(t.data);return Qd(s.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}sh.create=(e,t)=>new sh(l({type:e,typeName:hh.ZodPromise},hu(t)));class rh extends mu{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===hh.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:e=>{Gd(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===r.type){const e=r.transform(s.data,a);if(s.common.async)return Promise.resolve(e).then((e=>h(this,null,(function*(){if("aborted"===t.value)return Xd;const r=yield this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===r.status?Xd:"dirty"===r.status||"dirty"===t.value?Yd(r.value):r}))));{if("aborted"===t.value)return Xd;const r=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===r.status?Xd:"dirty"===r.status||"dirty"===t.value?Yd(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,a);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const r=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===r.status?Xd:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then((s=>"aborted"===s.status?Xd:("dirty"===s.status&&t.dirty(),e(s.value).then((()=>({status:t.value,value:s.value}))))))}if("transform"===r.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!su(e))return e;const i=r.transform(e.value,a);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then((e=>su(e)?Promise.resolve(r.transform(e.value,a)).then((e=>({status:t.value,value:e}))):e))}Ld.assertNever(r)}}rh.create=(e,t,s)=>new rh(l({schema:e,typeName:hh.ZodEffects,effect:t},hu(s))),rh.createWithPreprocess=(e,t,s)=>new rh(l({schema:t,effect:{type:"preprocess",transform:e},typeName:hh.ZodEffects},hu(s)));class ah extends mu{_parse(e){return this._getType(e)===Vd.undefined?Qd(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ah.create=(e,t)=>new ah(l({innerType:e,typeName:hh.ZodOptional},hu(t)));class ih extends mu{_parse(e){return this._getType(e)===Vd.null?Qd(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ih.create=(e,t)=>new ih(l({innerType:e,typeName:hh.ZodNullable},hu(t)));class nh extends mu{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===Vd.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}nh.create=(e,t)=>new nh(l({innerType:e,typeName:hh.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default},hu(t)));class oh extends mu{_parse(e){const{ctx:t}=this._processInputParams(e),s=c(l({},t),{common:c(l({},t.common),{issues:[]})}),r=this._def.innerType._parse({data:s.data,path:s.path,parent:l({},s)});return ru(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Bd(s.common.issues)},input:s.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new Bd(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}oh.create=(e,t)=>new oh(l({innerType:e,typeName:hh.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch},hu(t)));class lh extends mu{_parse(e){if(this._getType(e)!==Vd.nan){const t=this._getOrReturnCtx(e);return Gd(t,{code:zd.invalid_type,expected:Vd.nan,received:t.parsedType}),Xd}return{status:"valid",value:e.data}}}lh.create=e=>new lh(l({typeName:hh.ZodNaN},hu(e)));class ch extends mu{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class dh extends mu{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async){return(()=>h(this,null,(function*(){const e=yield this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?Xd:"dirty"===e.status?(t.dirty(),Yd(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})))()}{const e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?Xd:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new dh({in:e,out:t,typeName:hh.ZodPipeline})}}class uh extends mu{_parse(e){const t=this._def.innerType._parse(e),s=e=>(su(e)&&(e.value=Object.freeze(e.value)),e);return ru(t)?t.then((e=>s(e))):s(t)}unwrap(){return this._def.innerType}}var hh,mh;uh.create=(e,t)=>new uh(l({innerType:e,typeName:hh.ZodReadonly},hu(t))),Bu.lazycreate,(mh=hh||(hh={})).ZodString="ZodString",mh.ZodNumber="ZodNumber",mh.ZodNaN="ZodNaN",mh.ZodBigInt="ZodBigInt",mh.ZodBoolean="ZodBoolean",mh.ZodDate="ZodDate",mh.ZodSymbol="ZodSymbol",mh.ZodUndefined="ZodUndefined",mh.ZodNull="ZodNull",mh.ZodAny="ZodAny",mh.ZodUnknown="ZodUnknown",mh.ZodNever="ZodNever",mh.ZodVoid="ZodVoid",mh.ZodArray="ZodArray",mh.ZodObject="ZodObject",mh.ZodUnion="ZodUnion",mh.ZodDiscriminatedUnion="ZodDiscriminatedUnion",mh.ZodIntersection="ZodIntersection",mh.ZodTuple="ZodTuple",mh.ZodRecord="ZodRecord",mh.ZodMap="ZodMap",mh.ZodSet="ZodSet",mh.ZodFunction="ZodFunction",mh.ZodLazy="ZodLazy",mh.ZodLiteral="ZodLiteral",mh.ZodEnum="ZodEnum",mh.ZodEffects="ZodEffects",mh.ZodNativeEnum="ZodNativeEnum",mh.ZodOptional="ZodOptional",mh.ZodNullable="ZodNullable",mh.ZodDefault="ZodDefault",mh.ZodCatch="ZodCatch",mh.ZodPromise="ZodPromise",mh.ZodBranded="ZodBranded",mh.ZodPipeline="ZodPipeline",mh.ZodReadonly="ZodReadonly";const ph=Tu.create;Au.create,lh.create,Ru.create,Ou.create,Iu.create,$u.create,Du.create,Lu.create,Mu.create,Uu.create,Fu.create,Vu.create,qu.create;const fh=Bu.create;Bu.strictCreate,Zu.create,Ku.create,Wu.create,Gu.create,Ju.create,Xu.create,Yu.create,eh.create,th.create,sh.create,rh.create,ah.create,ih.create,rh.createWithPreprocess,dh.create;const xh=e=>{const t=e,{children:s}=t,r=d(t,["children"]);return Ie.createElement(Uc.Provider,{value:r},s)},gh=Ae.createContext({}),vh=e=>{var t=d(e,[]);return m.jsx(gh.Provider,{value:{name:t.name},children:m.jsx(Jc,l({},t))})},yh=()=>{const e=Ae.useContext(gh),t=Ae.useContext(bh),{getFieldState:s,formState:r}=Fc(),a=s(e.name,r);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:i}=t;return l({id:i,name:e.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`},a)},bh=Ae.createContext({}),wh=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);const i=Ae.useId();return m.jsx(bh.Provider,{value:{id:i},children:m.jsx("div",l({ref:t,className:Ue("space-y-2",r)},a))})}));wh.displayName="FormItem";const jh=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);const{error:i,formItemId:n}=yh();return m.jsx(co,l({ref:t,className:Ue(i&&"text-destructive",r),htmlFor:n},a))}));jh.displayName="FormLabel";const _h=Ae.forwardRef(((e,t)=>{var s=d(e,[]);const{error:r,formItemId:a,formDescriptionId:i,formMessageId:n}=yh();return m.jsx(p,l({ref:t,id:a,"aria-describedby":r?`${i} ${n}`:`${i}`,"aria-invalid":!!r},s))}));_h.displayName="FormControl";Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);const{formDescriptionId:i}=yh();return m.jsx("p",l({ref:t,id:i,className:Ue("text-sm text-muted-foreground",r)},a))})).displayName="FormDescription";const Nh=Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a}=s,i=d(s,["className","children"]);const{error:n,formMessageId:o}=yh(),u=n?String(null==n?void 0:n.message):a;return u?m.jsx("p",c(l({ref:t,id:o,className:Ue("text-sm font-medium text-destructive",r)},i),{children:u})):null}));Nh.displayName="FormMessage";const kh=fh({newPassword:ph().min(6,"La contraseña debe tener al menos 6 caracteres").max(50,"La contraseña no puede tener más de 50 caracteres"),confirmPassword:ph()}).refine((e=>e.newPassword===e.confirmPassword),{message:"Las contraseñas no coinciden",path:["confirmPassword"]}),Sh=({isOpen:e,onClose:t,userId:s,username:r})=>{const[a,i]=Ae.useState(!1),{toast:n}=ys(),o=function(e={}){const t=Ie.useRef(),s=Ie.useRef(),[r,a]=Ie.useState({isDirty:!1,isValidating:!1,isLoading:rd(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:rd(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current=c(l({},Rd(e)),{formState:r}));const i=t.current.control;return i._options=e,Hc({subject:i._subjects.state,next:e=>{zc(e,i._proxyFormState,i._updateFormState,!0)&&a(l({},i._formState))}}),Ie.useEffect((()=>i._disableForm(e.disabled)),[i,e.disabled]),Ie.useEffect((()=>{if(i._proxyFormState.isDirty){const e=i._getDirty();e!==r.isDirty&&i._subjects.state.next({isDirty:e})}}),[i,r.isDirty]),Ie.useEffect((()=>{e.values&&!yd(e.values,s.current)?(i._reset(e.values,i._options.resetOptions),s.current=e.values,a((e=>l({},e)))):i._resetDefaultValues()}),[e.values,i]),Ie.useEffect((()=>{e.errors&&i._setErrors(e.errors)}),[e.errors,i]),Ie.useEffect((()=>{i._state.mount||(i._updateValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next(l({},i._formState))),i._removeUnmounted()})),Ie.useEffect((()=>{e.shouldUnregister&&i._subjects.values.next({values:i._getWatch()})}),[e.shouldUnregister,i]),Ie.useEffect((()=>{t.current&&(t.current.watch=t.current.watch.bind({}))}),[r]),t.current.formState=Vc(r,i),t.current}({resolver:(d=kh,void 0===p&&(p={}),function(e,t,s){try{return Promise.resolve(function(t,r){try{var a=Promise.resolve(d["sync"===p.mode?"parse":"parseAsync"](e,u)).then((function(t){return s.shouldUseNativeValidation&&Id({},s),{errors:{},values:p.raw?e:t}}))}catch(i){return r(i)}return a&&a.then?a.then(void 0,r):a}(0,(function(e){if(t=e,Array.isArray(null==t?void 0:t.errors))return{values:{},errors:$d(Fd(e.errors,!s.shouldUseNativeValidation&&"all"===s.criteriaMode),s)};var t;throw e})))}catch(r){return Promise.reject(r)}}),defaultValues:{newPassword:"",confirmPassword:""}});var d,u,p;return m.jsx(Yn,{open:e,onOpenChange:t,children:m.jsxs(to,{className:"sm:max-w-[425px]",children:[m.jsxs(so,{children:[m.jsx(ao,{children:"Cambiar Contraseña"}),m.jsxs(io,{children:["Establecer nueva contraseña para ",r]})]}),m.jsx(xh,c(l({},o),{children:m.jsxs("form",{onSubmit:o.handleSubmit((e=>h(void 0,null,(function*(){i(!0);try{const{data:{session:a},error:i}=yield cn.auth.getSession();if(i||!a)throw new Error("No hay sesión activa");const l=yield fetch("https://esvtnnswavfyweokiyrp.supabase.co/functions/v1/admin-reset-password",{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({userId:s,newPassword:e.newPassword})}),c=yield l.json();if(!l.ok)throw new Error(c.error||"Error al cambiar la contraseña");n({title:"Contraseña actualizada",description:`La contraseña de ${r} ha sido actualizada exitosamente.`}),o.reset(),t()}catch(a){console.error("Error resetting password:",a),n({title:"Error",description:a instanceof Error?a.message:"No se pudo actualizar la contraseña",variant:"destructive"})}finally{i(!1)}})))),className:"space-y-6",children:[m.jsx(vh,{control:o.control,name:"newPassword",render:({field:e})=>m.jsxs(wh,{children:[m.jsx(jh,{children:"Nueva Contraseña"}),m.jsx(_h,{children:m.jsx(Sn,l({type:"password",placeholder:"Ingresa la nueva contraseña"},e))}),m.jsx(Nh,{})]})}),m.jsx(vh,{control:o.control,name:"confirmPassword",render:({field:e})=>m.jsxs(wh,{children:[m.jsx(jh,{children:"Confirmar Contraseña"}),m.jsx(_h,{children:m.jsx(Sn,l({type:"password",placeholder:"Confirma la nueva contraseña"},e))}),m.jsx(Nh,{})]})}),m.jsxs("div",{className:"flex justify-end gap-3",children:[m.jsx(Ve,{type:"button",variant:"outline",onClick:t,disabled:a,children:"Cancelar"}),m.jsx(Ve,{type:"submit",disabled:a,children:a?"Actualizando...":"Actualizar Contraseña"})]})]})}))]})})},Ch=ne,Eh=oe;Ae.forwardRef(((e,t)=>{var s=e,{className:r,inset:a,children:i}=s,n=d(s,["className","inset","children"]);return m.jsxs(J,c(l({ref:t,className:Ue("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",r)},n),{children:[i,m.jsx(tt,{className:"ml-auto h-4 w-4"})]}))})).displayName=J.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(X,l({ref:t,className:Ue("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r)},a))})).displayName=X.displayName;const Th=Ae.forwardRef(((e,t)=>{var s=e,{className:r,sideOffset:a=4}=s,i=d(s,["className","sideOffset"]);return m.jsx(Y,{children:m.jsx(Q,l({ref:t,sideOffset:a,className:Ue("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r)},i))})}));Th.displayName=Q.displayName;const Ph=Ae.forwardRef(((e,t)=>{var s=e,{className:r,inset:a}=s,i=d(s,["className","inset"]);return m.jsx(ee,l({ref:t,className:Ue("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",r)},i))}));Ph.displayName=ee.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a,checked:i}=s,n=d(s,["className","children","checked"]);return m.jsxs(te,c(l({ref:t,className:Ue("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:i},n),{children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(se,{children:m.jsx(Qe,{className:"h-4 w-4"})})}),a]}))})).displayName=te.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a}=s,i=d(s,["className","children"]);return m.jsxs(re,c(l({ref:t,className:Ue("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r)},i),{children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(se,{children:m.jsx(nt,{className:"h-2 w-2 fill-current"})})}),a]}))})).displayName=re.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r,inset:a}=s,i=d(s,["className","inset"]);return m.jsx(ae,l({ref:t,className:Ue("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",r)},i))})).displayName=ae.displayName;const Ah=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(ie,l({ref:t,className:Ue("-mx-1 my-1 h-px bg-muted",r)},a))}));Ah.displayName=ie.displayName;const Rh=({onUserSelect:e})=>{var t;const[s,r]=Ae.useState(""),[a,i]=Ae.useState(null),[n,o]=Ae.useState(""),[d,u]=Ae.useState(!1),[p,f]=Ae.useState(!1),{users:x,loading:g,toggleUserRole:v,toggleUserBan:y}=(()=>{const[e,t]=Ae.useState([]),[s,r]=Ae.useState(!1),{toast:a}=ys(),{user:i}=hn(),n=Ae.useRef(null),o=()=>h(void 0,null,(function*(){r(!0);try{const{data:e,error:s}=yield cn.from("profiles").select("id, email, username, avatar_url, created_at, is_admin").order("created_at",{ascending:!1});if(s)throw s;const r=yield Promise.all((e||[]).map((e=>h(void 0,null,(function*(){const{data:t}=yield cn.rpc("check_user_ban_status",{user_id:e.id}),s=null==t?void 0:t[0];return c(l({},e),{is_banned:(null==s?void 0:s.is_banned)||!1,ban_reason:null==s?void 0:s.reason,banned_until:null==s?void 0:s.banned_until})})))));t(r)}catch(e){console.error("Error fetching users:",e),a({title:"Error",description:"No se pudieron cargar los usuarios",variant:"destructive"})}finally{r(!1)}})),d=(e,s,r=!1,i)=>h(void 0,null,(function*(){var n;try{const{error:o}=yield cn.from("user_bans").insert({user_id:e,banned_by:null==(n=(yield cn.auth.getUser()).data.user)?void 0:n.id,reason:s,is_permanent:r,banned_until:r?null:null==i?void 0:i.toISOString()});if(o)throw o;a({title:"Usuario baneado",description:"El usuario ha sido baneado exitosamente"}),t((t=>t.map((t=>t.id===e?c(l({},t),{is_banned:!0,ban_reason:s,banned_until:r?null:null==i?void 0:i.toISOString()}):t))))}catch(o){console.error("Error banning user:",o),a({title:"Error",description:"No se pudo banear al usuario",variant:"destructive"})}})),u=e=>h(void 0,null,(function*(){try{const{error:s}=yield cn.from("user_bans").delete().eq("user_id",e);if(s)throw s;a({title:"Usuario desbaneado",description:"El usuario ha sido desbaneado exitosamente"}),t((t=>t.map((t=>t.id===e?c(l({},t),{is_banned:!1,ban_reason:void 0,banned_until:void 0}):t))))}catch(s){console.error("Error unbanning user:",s),a({title:"Error",description:"No se pudo desbanear al usuario",variant:"destructive"})}}));return Ae.useEffect((()=>{if(i)return console.log("Setting up realtime subscription for user bans"),n.current&&(console.log("Cleaning up existing user bans channel"),n.current.unsubscribe(),n.current=null),n.current=cn.channel("realtime-user-bans").on("postgres_changes",{event:"INSERT",schema:"public",table:"user_bans"},(e=>h(void 0,null,(function*(){console.log("New ban created via realtime:",e);const s=e.new;t((e=>e.map((e=>e.id===s.user_id?c(l({},e),{is_banned:!0,ban_reason:s.reason,banned_until:s.banned_until}):e)))),a({title:"Usuario baneado",description:"Se ha baneado a un usuario en tiempo real"})})))).on("postgres_changes",{event:"DELETE",schema:"public",table:"user_bans"},(e=>h(void 0,null,(function*(){console.log("Ban removed via realtime:",e);const s=e.old;t((e=>e.map((e=>e.id===s.user_id?c(l({},e),{is_banned:!1,ban_reason:void 0,banned_until:void 0}):e)))),a({title:"Usuario desbaneado",description:"Se ha desbaneado a un usuario en tiempo real"})})))).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles"},(e=>h(void 0,null,(function*(){console.log("Profile updated via realtime:",e);const s=e.new;t((e=>e.map((e=>e.id===s.id?c(l({},e),{username:s.username,email:s.email,avatar_url:s.avatar_url,is_admin:s.is_admin}):e))))})))).subscribe((e=>{console.log("User bans subscription status:",e)})),()=>{n.current&&(console.log("Cleaning up user bans subscription"),n.current.unsubscribe(),n.current=null)}}),[i,a]),Ae.useEffect((()=>{o()}),[]),{users:e,loading:s,banUser:d,unbanUser:u,toggleUserRole:(e,s)=>h(void 0,null,(function*(){try{const{error:r}=yield cn.from("profiles").update({is_admin:s}).eq("id",e);if(r)throw r;return t((t=>t.map((t=>t.id===e?c(l({},t),{is_admin:s}):t)))),!0}catch(r){throw console.error("Error toggling user role:",r),r}})),toggleUserBan:(e,t,s,r,a)=>h(void 0,null,(function*(){try{return t?yield d(e,s||"Sin motivo especificado",r||!1,a):yield u(e),!0}catch(i){throw console.error("Error toggling user ban:",i),i}})),refreshUsers:o}})(),{toast:b}=ys(),w=bs(),j=x.filter((e=>`${e.username||""}`.toLowerCase().includes(s.toLowerCase()))),_=(e,t)=>h(void 0,null,(function*(){try{yield v(e,!t),b({title:"Rol actualizado",description:`El rol del usuario ha sido ${t?"removido":"asignado"} exitosamente.`})}catch(s){console.error("Error toggling user role:",s),b({title:"Error",description:s.message||"No se pudo actualizar el rol del usuario",variant:"destructive"})}})),N=(e,t)=>h(void 0,null,(function*(){i(e),o(t),u(!0)})),k=(e,t)=>{i(e),o(t),f(!0)};return g?m.jsx("div",{className:"min-h-screen p-4 space-y-4",children:m.jsx("div",{className:"text-center text-white",children:"Cargando panel de administración..."})}):m.jsxs("div",{className:"min-h-screen p-2 md:p-4 space-y-4 md:space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4 md:mb-6",children:[m.jsx($t,{className:"w-6 h-6 md:w-8 md:h-8 text-purple-400"}),m.jsx("h1",{className:"text-xl md:text-3xl font-bold text-white",children:"Panel de Administración"})]}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-3 md:p-4",children:m.jsxs("div",{className:"relative",children:[m.jsx(Rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),m.jsx(Sn,{placeholder:"Buscar por nombre de usuario...",value:s,onChange:e=>r(e.target.value),className:"pl-10 bg-white/5 border-white/20 text-white placeholder:text-gray-400 text-sm"})]})})}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{className:"p-3 md:p-6",children:m.jsxs(jn,{className:"text-white flex items-center gap-2 text-lg md:text-xl",children:[m.jsx(Yt,{className:"w-4 h-4 md:w-5 md:h-5"}),"Gestión de Usuarios"]})}),m.jsx(Nn,{className:"p-2 md:p-4",children:m.jsxs("div",{className:"space-y-3 md:space-y-4",children:[j.map((t=>m.jsxs("div",{className:"p-3 md:p-4 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-colors "+(w?"space-y-3":"flex items-center justify-between"),children:[m.jsxs("div",{className:"flex items-center gap-3 md:gap-4 "+(w?"w-full":""),children:[m.jsxs(Fn,{className:"w-10 h-10 md:w-12 md:h-12 cursor-pointer flex-shrink-0",onClick:()=>e(t.id),children:[m.jsx(Vn,{src:t.avatar_url}),m.jsx(qn,{className:"bg-purple-500/20 text-white",children:m.jsx(Yt,{className:"w-4 h-4 md:w-6 md:h-6"})})]}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsx("h3",{className:"text-white font-semibold cursor-pointer hover:text-purple-300 text-sm md:text-base truncate",onClick:()=>e(t.id),children:t.username||"Sin nombre"}),t.is_admin&&m.jsxs(gn,{variant:"secondary",className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30 text-xs",children:[m.jsx(ct,{className:"w-2 h-2 md:w-3 md:h-3 mr-1"}),"Admin"]}),t.is_banned&&m.jsxs(gn,{variant:"secondary",className:"bg-red-500/20 text-red-300 border-red-500/30 text-xs",children:[m.jsx(We,{className:"w-2 h-2 md:w-3 md:h-3 mr-1"}),"Baneado"]})]}),m.jsxs("p",{className:"text-gray-500 text-xs",children:["Registrado: ",new Date(t.created_at).toLocaleDateString("es-ES")]})]})]}),w?m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs(Ve,{variant:"outline",size:"sm",onClick:()=>e(t.id),className:"border-white/20 text-white hover:bg-white/10 text-xs",children:[m.jsx(kt,{className:"w-3 h-3 mr-1"}),"Ver Perfil"]}),m.jsxs(Ch,{children:[m.jsx(Eh,{asChild:!0,children:m.jsx(Ve,{variant:"outline",size:"sm",className:"border-white/20 text-white hover:bg-white/10",children:m.jsx(ht,{className:"w-4 h-4"})})}),m.jsxs(Th,{className:"bg-gray-900/95 backdrop-blur-lg border-white/20 text-white w-56",align:"end",children:[m.jsxs(Ph,{onClick:()=>k(t.id,t.username||t.email),className:"hover:bg-blue-500/20 focus:bg-blue-500/20",children:[m.jsx(yt,{className:"w-4 h-4 mr-2"}),"Cambiar Contraseña"]}),m.jsx(Ah,{className:"bg-white/20"}),m.jsx(Ph,{onClick:()=>_(t.id,t.is_admin||!1),className:t.is_admin?"hover:bg-yellow-500/20 focus:bg-yellow-500/20":"hover:bg-green-500/20 focus:bg-green-500/20",children:t.is_admin?m.jsxs(m.Fragment,{children:[m.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Quitar Admin"]}):m.jsxs(m.Fragment,{children:[m.jsx(Kt,{className:"w-4 h-4 mr-2"}),"Hacer Admin"]})}),m.jsx(Ah,{className:"bg-white/20"}),m.jsx(Ph,{onClick:()=>N(t.id,t.username||t.email),className:t.is_banned?"hover:bg-green-500/20 focus:bg-green-500/20":"hover:bg-red-500/20 focus:bg-red-500/20",children:t.is_banned?m.jsxs(m.Fragment,{children:[m.jsx(Kt,{className:"w-4 h-4 mr-2"}),"Desbanear"]}):m.jsxs(m.Fragment,{children:[m.jsx(We,{className:"w-4 h-4 mr-2"}),"Banear"]})})]})]})]}):m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsxs(Ve,{variant:"outline",size:"sm",onClick:()=>e(t.id),className:"border-white/20 text-white hover:bg-white/10",children:[m.jsx(kt,{className:"w-4 h-4 mr-1"}),"Ver Perfil"]}),m.jsxs(Ve,{variant:"outline",size:"sm",onClick:()=>k(t.id,t.username||t.email),className:"border-blue-500/30 text-blue-300 hover:bg-blue-500/20",children:[m.jsx(yt,{className:"w-4 h-4 mr-1"}),"Cambiar Contraseña"]}),m.jsx(Ve,{variant:"outline",size:"sm",onClick:()=>_(t.id,t.is_admin||!1),className:t.is_admin?"border-yellow-500/30 text-yellow-300 hover:bg-yellow-500/20":"border-green-500/30 text-green-300 hover:bg-green-500/20",children:t.is_admin?m.jsxs(m.Fragment,{children:[m.jsx(Jt,{className:"w-4 h-4 mr-1"}),"Quitar Admin"]}):m.jsxs(m.Fragment,{children:[m.jsx(Kt,{className:"w-4 h-4 mr-1"}),"Hacer Admin"]})}),m.jsx(Ve,{variant:"outline",size:"sm",onClick:()=>N(t.id,t.username||t.email),className:t.is_banned?"border-green-500/30 text-green-300 hover:bg-green-500/20":"border-red-500/30 text-red-300 hover:bg-red-500/20",children:t.is_banned?m.jsxs(m.Fragment,{children:[m.jsx(Kt,{className:"w-4 h-4 mr-1"}),"Desbanear"]}):m.jsxs(m.Fragment,{children:[m.jsx(We,{className:"w-4 h-4 mr-1"}),"Banear"]})})]})]},t.id))),0===j.length&&m.jsxs("div",{className:"text-center text-gray-400 py-8",children:[m.jsx(Yt,{className:"w-12 h-12 md:w-16 md:h-16 mx-auto mb-4 opacity-50"}),m.jsx("p",{className:"text-base md:text-lg",children:"No se encontraron usuarios"}),m.jsx("p",{className:"text-sm",children:"Intenta con otros términos de búsqueda"})]})]})})]}),d&&a&&m.jsx(oc,{isOpen:d,onClose:()=>{u(!1),i(null),o("")},userId:a,username:n,isCurrentlyBanned:(null==(t=x.find((e=>e.id===a)))?void 0:t.is_banned)||!1,onBanComplete:y}),p&&a&&m.jsx(Sh,{isOpen:p,onClose:()=>{f(!1),i(null),o("")},userId:a,username:n})]})},Oh=({userId:e,onBack:t,onStartChat:s})=>{const{user:r}=hn(),{profile:a,products:i,stats:n,loading:o,fetchUserProfile:l}=zl(),{isFollowing:c,loading:d,checkIfFollowing:u,followUser:p,unfollowUser:f}=(()=>{const[e,t]=Ae.useState(!1),[s,r]=Ae.useState(!1),{user:a}=hn(),{toast:i}=ys();return{isFollowing:e,loading:s,checkIfFollowing:e=>h(void 0,null,(function*(){if(a&&e&&a.id!==e)try{const{data:s,error:r}=yield cn.from("user_follows").select("id").eq("follower_id",a.id).eq("following_id",e).single();if(r&&"PGRST116"!==r.code)throw r;t(!!s)}catch(s){console.error("Error checking follow status:",s)}})),followUser:e=>h(void 0,null,(function*(){if(a&&!s){r(!0);try{const{error:s}=yield cn.from("user_follows").insert({follower_id:a.id,following_id:e});if(s)throw s;t(!0),i({title:"Usuario seguido",description:"Ahora sigues a este usuario"})}catch(n){console.error("Error following user:",n),i({title:"Error",description:"No se pudo seguir al usuario",variant:"destructive"})}finally{r(!1)}}})),unfollowUser:e=>h(void 0,null,(function*(){if(a&&!s){r(!0);try{const{error:s}=yield cn.from("user_follows").delete().eq("follower_id",a.id).eq("following_id",e);if(s)throw s;t(!1),i({title:"Usuario no seguido",description:"Ya no sigues a este usuario"})}catch(n){console.error("Error unfollowing user:",n),i({title:"Error",description:"No se pudo dejar de seguir al usuario",variant:"destructive"})}finally{r(!1)}}}))}})();if(Ae.useEffect((()=>{e&&(l(e),r&&r.id!==e&&u(e))}),[e,r]),o)return m.jsxs("div",{className:"min-h-screen p-4 space-y-4",children:[m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs(Ve,{variant:"outline",onClick:t,className:"border-white/20 text-white hover:bg-white/10 text-sm",children:[m.jsx(He,{className:"w-4 h-4 mr-2"}),"Volver"]})}),m.jsx("div",{className:"text-center text-white",children:"Cargando perfil..."})]});if(!a)return m.jsxs("div",{className:"min-h-screen p-4 space-y-4",children:[m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs(Ve,{variant:"outline",onClick:t,className:"border-white/20 text-white hover:bg-white/10 text-sm",children:[m.jsx(He,{className:"w-4 h-4 mr-2"}),"Volver"]})}),m.jsx("div",{className:"text-center text-white",children:"Usuario no encontrado"})]});const x="mr.federex@gmail.com"===a.email,g=(null==r?void 0:r.id)===e;return m.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{backgroundImage:a.background_url?`url(${a.background_url})`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:[a.background_url&&m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),m.jsxs("div",{className:"relative z-10 p-3 sm:p-4 space-y-3 sm:space-y-4 md:space-y-6 max-w-7xl mx-auto",children:[m.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[m.jsxs(Ve,{variant:"outline",onClick:t,className:"border-white/20 text-red-500 bg-black/10 text-xs sm:text-sm md:text-base px-2 sm:px-4",children:[m.jsx(He,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),m.jsx("span",{className:"hidden xs:inline",children:"Volver"})]}),m.jsx("h1",{className:"text-sm sm:text-lg md:text-2xl font-bold text-white truncate",children:"Perfil de Usuario"})]}),x&&m.jsx(bn,{className:"bg-gradient-to-r from-green-500/20 via-blue-500/20 to-green-500/20 backdrop-blur-lg border-green-400/30 shadow-lg",children:m.jsx(Nn,{className:"p-2 sm:p-3 md:p-4 bg-slate-950",children:m.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3",children:[m.jsx($t,{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-green-400"}),m.jsxs("div",{className:"text-center",children:[m.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent",children:"ADMIN"}),m.jsx("p",{className:"text-xs sm:text-sm text-green-300",children:"Administrador del Sistema"})]}),m.jsx($t,{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-blue-400"})]})})}),a.presentation_video_url&&m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{className:"pb-2 sm:pb-4 md:pb-6",children:m.jsxs(jn,{className:"text-white flex items-center gap-2 text-sm sm:text-base md:text-lg",children:[m.jsx(Tt,{className:"w-4 h-4 md:w-5 md:h-5"}),"Video de Presentación"]})}),m.jsx(Nn,{className:"pt-0",children:m.jsx("video",{src:a.presentation_video_url,className:"w-full max-w-2xl mx-auto rounded-lg",controls:!0,preload:"metadata"})})]}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-3 sm:p-4 md:p-6",children:m.jsxs("div",{className:"flex flex-col space-y-4",children:[m.jsx("div",{className:"flex justify-center sm:justify-start",children:m.jsxs(Fn,{className:"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24",children:[m.jsx(Vn,{src:a.avatar_url}),m.jsx(qn,{className:"bg-purple-500/20 text-white text-base sm:text-lg md:text-2xl",children:m.jsx(Xt,{className:"w-6 h-6 sm:w-8 sm:h-8 md:w-12 md:h-12"})})]})}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"text-center sm:text-left space-y-2",children:[m.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white break-words",children:a.username||"Usuario"}),m.jsxs("p",{className:"text-gray-300 text-xs sm:text-sm md:text-base break-all",children:["Usuario desde ",new Date(a.created_at).toLocaleDateString("es-ES")]})]}),!g&&r&&m.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[m.jsxs(Ve,{onClick:()=>h(void 0,null,(function*(){c?yield f(e):yield p(e),l(e)})),disabled:d,className:"flex-1 sm:flex-none text-xs sm:text-sm "+(c?"bg-gray-600 hover:bg-gray-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:[d?m.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):c?m.jsx(Wt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-2"}):m.jsx(Gt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-2"}),c?"Siguiendo":"Seguir"]}),m.jsxs(Ve,{onClick:()=>{s&&s(e)},className:"flex-1 sm:flex-none bg-green-500 hover:bg-green-600 text-white text-xs sm:text-sm",children:[m.jsx(kt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-2"}),"Hablar"]})]}),m.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-4 sm:gap-6",children:[m.jsxs("div",{className:"flex items-center gap-1 text-white",children:[m.jsx(Yt,{className:"w-3 h-3 sm:w-4 sm:h-4 text-blue-400"}),m.jsx("span",{className:"font-semibold text-xs sm:text-sm md:text-base",children:a.followers_count||0}),m.jsx("span",{className:"text-gray-300 text-xs sm:text-sm",children:"Seguidores"})]}),m.jsxs("div",{className:"flex items-center gap-1 text-white",children:[m.jsx(Yt,{className:"w-3 h-3 sm:w-4 sm:h-4 text-green-400"}),m.jsx("span",{className:"font-semibold text-xs sm:text-sm md:text-base",children:a.following_count||0}),m.jsx("span",{className:"text-gray-300 text-xs sm:text-sm",children:"Siguiendo"})]})]}),a.description&&m.jsx("p",{className:"text-gray-300 text-xs sm:text-sm md:text-base text-center sm:text-left break-words leading-relaxed",children:a.description}),m.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-1 sm:gap-2 text-gray-400 text-xs sm:text-sm",children:[m.jsx(Xe,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),m.jsxs("span",{className:"break-words",children:["Miembro desde ",(v=a.created_at,new Date(v).toLocaleDateString("es-ES",{year:"numeric",month:"long"}))]})]})]})]})})}),m.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 md:gap-6",children:[m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-2 sm:p-4 md:p-6",children:m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[m.jsxs("div",{className:"text-center sm:text-left",children:[m.jsx("p",{className:"text-gray-300 text-xs sm:text-sm font-medium",children:"Ventas"}),m.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white",children:n.totalSales})]}),m.jsx(zt,{className:"w-5 h-5 sm:w-6 sm:h-6 md:w-8 md:h-8 text-green-400 mx-auto sm:mx-0 mt-1 sm:mt-0"})]})})}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-2 sm:p-4 md:p-6",children:m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[m.jsxs("div",{className:"text-center sm:text-left",children:[m.jsx("p",{className:"text-gray-300 text-xs sm:text-sm font-medium",children:"Productos"}),m.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white",children:n.totalProducts})]}),m.jsx(Dt,{className:"w-5 h-5 sm:w-6 sm:h-6 md:w-8 md:h-8 text-blue-400 mx-auto sm:mx-0 mt-1 sm:mt-0"})]})})}),m.jsx(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"p-2 sm:p-4 md:p-6",children:m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[m.jsxs("div",{className:"text-center sm:text-left",children:[m.jsx("p",{className:"text-gray-300 text-xs sm:text-sm font-medium",children:"Likes"}),m.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white",children:n.totalLikes})]}),m.jsx(gt,{className:"w-5 h-5 sm:w-6 sm:h-6 md:w-8 md:h-8 text-red-400 mx-auto sm:mx-0 mt-1 sm:mt-0"})]})})})]}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsxs(wn,{className:"pb-2 sm:pb-4 md:pb-6",children:[m.jsx(jn,{className:"text-white text-sm sm:text-base md:text-lg",children:"Productos Públicos"}),m.jsx(_n,{className:"text-gray-300 text-xs sm:text-sm md:text-base",children:"Productos disponibles de este usuario"})]}),m.jsx(Nn,{className:"pt-0",children:i.length>0?m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-6",children:i.map((e=>m.jsxs(bn,{className:"bg-white/5 border-white/10 hover:bg-white/10 transition-colors",children:[m.jsx("div",{className:"aspect-video bg-gray-800 rounded-t-lg overflow-hidden",children:e.image_url?m.jsx("img",{src:e.image_url,alt:e.title,className:"w-full h-full object-cover"}):m.jsx("div",{className:"w-full h-full flex items-center justify-center",children:m.jsx(Dt,{className:"w-6 h-6 sm:w-8 sm:h-8 md:w-12 md:h-12 text-gray-400"})})}),m.jsxs(Nn,{className:"p-2 sm:p-3 md:p-4",children:[m.jsx("h3",{className:"font-semibold text-white mb-2 line-clamp-2 text-xs sm:text-sm md:text-base break-words",children:e.title}),m.jsx("p",{className:"text-gray-300 text-xs sm:text-sm mb-3 line-clamp-2 break-words",children:e.description}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("div",{className:"flex items-center gap-2",children:e.is_free?m.jsx(gn,{variant:"secondary",className:"bg-green-500/20 text-green-400 text-xs",children:"Gratis"}):m.jsxs("span",{className:"text-sm sm:text-base md:text-lg font-bold text-white",children:["$",e.price]})}),m.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-400",children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(gt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),m.jsx("span",{children:e.rating})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(zt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),m.jsx("span",{children:e.sales})]})]})]})]})]},e.id)))}):m.jsxs("div",{className:"text-center py-6 md:py-8",children:[m.jsx(Dt,{className:"w-8 h-8 md:w-12 md:h-12 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-sm sm:text-base md:text-lg font-semibold text-white mb-2",children:"No hay productos públicos"}),m.jsx("p",{className:"text-gray-400 text-xs sm:text-sm",children:"Este usuario aún no ha publicado productos"})]})})]})]})]});var v},Ih=({onUserSelect:e,onBack:t})=>{const[s,r]=Ae.useState(""),{users:a,loading:i,searchUsers:n,clearUsers:o}=(()=>{const[e,t]=Ae.useState([]),[s,r]=Ae.useState(!1),{toast:a}=ys();return{users:e,loading:s,searchUsers:e=>h(void 0,null,(function*(){if(e.trim()){if(!(e.length<2)){r(!0);try{const{data:s,error:r}=yield cn.from("profiles").select("id, email, username, avatar_url, created_at").ilike("username",`%${e}%`).limit(10).order("created_at",{ascending:!1});if(r)throw r;t(s||[])}catch(s){console.error("Error searching users:",s),a({title:"Error",description:"No se pudieron buscar usuarios",variant:"destructive"})}finally{r(!1)}}}else t([])})),clearUsers:()=>{t([])}}})(),l=()=>{s.trim()?n(s):o()};return m.jsxs("div",{className:"space-y-8",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[t&&m.jsx(Ve,{onClick:t,variant:"outline",size:"icon",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:m.jsx(He,{className:"w-4 h-4"})}),m.jsx("h1",{className:"text-4xl font-bold text-white",children:"Buscar Usuarios"})]}),m.jsxs(bn,{className:"bg-gray-900/50 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsx(jn,{className:"text-white text-2xl",children:"Encuentra a otros usuarios"})}),m.jsx(Nn,{className:"space-y-6",children:m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("div",{className:"relative flex-1",children:[m.jsx(Rt,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-6 h-6"}),m.jsx(Sn,{placeholder:"Buscar por nombre de usuario...",value:s,onChange:e=>r(e.target.value),onKeyPress:e=>{"Enter"===e.key&&l()},className:"pl-12 py-4 text-lg bg-white/10 border-white/20 text-white placeholder:text-gray-400 rounded-xl focus:ring-4 focus:ring-purple-500 focus:border-transparent"})]}),m.jsx(Ve,{onClick:l,className:"bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 text-lg rounded-xl",disabled:i,children:i?"Buscando...":"Buscar"})]})})]}),a.length>0&&m.jsxs(bn,{className:"bg-gray-900/50 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsx(jn,{className:"text-white text-xl",children:"Resultados de búsqueda"})}),m.jsx(Nn,{children:m.jsx("div",{className:"space-y-4",children:a.map((t=>{return m.jsxs("div",{onClick:()=>(t=>{e(t.id)})(t),className:"flex items-center space-x-4 p-4 rounded-xl hover:bg-white/10 cursor-pointer transition-colors border border-transparent hover:border-white/20",children:[m.jsxs(Fn,{className:"w-16 h-16",children:[m.jsx(Vn,{src:t.avatar_url}),m.jsx(qn,{className:"bg-purple-500/20 text-white text-lg",children:m.jsx(Xt,{className:"w-8 h-8"})})]}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[m.jsx("p",{className:"text-white font-semibold truncate text-lg",children:t.username||"Usuario"}),(s=t.email,"mr.federex@gmail.com"===s&&m.jsxs(gn,{variant:"destructive",className:"bg-red-600 text-white flex items-center gap-1 text-sm",children:[m.jsx($t,{className:"w-3 h-3"}),"Admin"]}))]}),m.jsxs("p",{className:"text-gray-400 text-base truncate",children:["Usuario desde ",new Date(t.created_at).toLocaleDateString("es-ES")]})]}),m.jsx("div",{className:"text-gray-400",children:m.jsx(He,{className:"w-5 h-5 rotate-180"})})]},t.id);var s}))})})]}),s&&0===a.length&&!i&&m.jsx(bn,{className:"bg-gray-900/50 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"py-12",children:m.jsxs("div",{className:"text-center text-gray-400",children:[m.jsx(Xt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),m.jsx("p",{className:"text-xl",children:"No se encontraron usuarios"}),m.jsx("p",{className:"text-base mt-2",children:"Intenta con otro término de búsqueda"})]})})}),!s&&0===a.length&&m.jsx(bn,{className:"bg-gray-900/50 backdrop-blur-lg border-white/20",children:m.jsx(Nn,{className:"py-12",children:m.jsxs("div",{className:"text-center text-gray-400",children:[m.jsx(Rt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),m.jsx("p",{className:"text-xl",children:"Comienza tu búsqueda"}),m.jsx("p",{className:"text-base mt-2",children:"Escribe el nombre de usuario para encontrar a otros usuarios"})]})})})]})};var $h="ContextMenu",[Dh,Lh]=_($h,[le]),Mh=le(),[Uh,Fh]=Dh($h),Vh=e=>{const{__scopeContextMenu:t,children:s,onOpenChange:r,dir:a,modal:i=!0}=e,[n,o]=Ae.useState(!1),d=Mh(t),u=k(r),h=Ae.useCallback((e=>{o(e),u(e)}),[u]);return m.jsx(Uh,{scope:t,open:n,onOpenChange:h,modal:i,children:m.jsx(ye,c(l({},d),{dir:a,open:n,onOpenChange:h,modal:i,children:s}))})};Vh.displayName=$h;var qh="ContextMenuTrigger",zh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r,disabled:a=!1}=s,i=d(s,["__scopeContextMenu","disabled"]),n=Fh(qh,r),o=Mh(r),u=Ae.useRef({x:0,y:0}),h=Ae.useRef({getBoundingClientRect:()=>DOMRect.fromRect(l({width:0,height:0},u.current))}),p=Ae.useRef(0),f=Ae.useCallback((()=>window.clearTimeout(p.current)),[]),x=e=>{u.current={x:e.clientX,y:e.clientY},n.onOpenChange(!0)};return Ae.useEffect((()=>f),[f]),Ae.useEffect((()=>{a&&f()}),[a,f]),m.jsxs(m.Fragment,{children:[m.jsx(be,c(l({},o),{virtualRef:h})),m.jsx(N.span,c(l({"data-state":n.open?"open":"closed","data-disabled":a?"":void 0},i),{ref:t,style:l({WebkitTouchCallout:"none"},e.style),onContextMenu:a?e.onContextMenu:z(e.onContextMenu,(e=>{f(),x(e),e.preventDefault()})),onPointerDown:a?e.onPointerDown:z(e.onPointerDown,tm((e=>{f(),p.current=window.setTimeout((()=>x(e)),700)}))),onPointerMove:a?e.onPointerMove:z(e.onPointerMove,tm(f)),onPointerCancel:a?e.onPointerCancel:z(e.onPointerCancel,tm(f)),onPointerUp:a?e.onPointerUp:z(e.onPointerUp,tm(f))}))]})}));zh.displayName=qh;var Bh=e=>{const t=e,{__scopeContextMenu:s}=t,r=d(t,["__scopeContextMenu"]),a=Mh(s);return m.jsx(ue,l(l({},a),r))};Bh.displayName="ContextMenuPortal";var Zh="ContextMenuContent",Hh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Fh(Zh,r),n=Mh(r),o=Ae.useRef(!1);return m.jsx(he,c(l(l({},n),a),{ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var s;null==(s=e.onCloseAutoFocus)||s.call(e,t),!t.defaultPrevented&&o.current&&t.preventDefault(),o.current=!1},onInteractOutside:t=>{var s;null==(s=e.onInteractOutside)||s.call(e,t),t.defaultPrevented||i.modal||(o.current=!0)},style:l(l({},e.style),{"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"})}))}));Hh.displayName=Zh;Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(we,c(l(l({},i),a),{ref:t}))})).displayName="ContextMenuGroup";var Kh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(ge,c(l(l({},i),a),{ref:t}))}));Kh.displayName="ContextMenuLabel";var Wh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(me,c(l(l({},i),a),{ref:t}))}));Wh.displayName="ContextMenuItem";var Gh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(pe,c(l(l({},i),a),{ref:t}))}));Gh.displayName="ContextMenuCheckboxItem";Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(je,c(l(l({},i),a),{ref:t}))})).displayName="ContextMenuRadioGroup";var Jh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(xe,c(l(l({},i),a),{ref:t}))}));Jh.displayName="ContextMenuRadioItem";var Xh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(fe,c(l(l({},i),a),{ref:t}))}));Xh.displayName="ContextMenuItemIndicator";var Yh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(ve,c(l(l({},i),a),{ref:t}))}));Yh.displayName="ContextMenuSeparator";Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(_e,c(l(l({},i),a),{ref:t}))})).displayName="ContextMenuArrow";var Qh=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(ce,c(l(l({},i),a),{ref:t}))}));Qh.displayName="ContextMenuSubTrigger";var em=Ae.forwardRef(((e,t)=>{const s=e,{__scopeContextMenu:r}=s,a=d(s,["__scopeContextMenu"]),i=Mh(r);return m.jsx(de,c(l(l({},i),a),{ref:t,style:l(l({},e.style),{"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"})}))}));function tm(e){return t=>"mouse"!==t.pointerType?e(t):void 0}em.displayName="ContextMenuSubContent";var sm=Bh,rm=Hh,am=Kh,im=Wh,nm=Gh,om=Jh,lm=Xh,cm=Yh,dm=Qh,um=em;const hm=Vh,mm=zh;Ae.forwardRef(((e,t)=>{var s=e,{className:r,inset:a,children:i}=s,n=d(s,["className","inset","children"]);return m.jsxs(dm,c(l({ref:t,className:Ue("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",a&&"pl-8",r)},n),{children:[i,m.jsx(tt,{className:"ml-auto h-4 w-4"})]}))})).displayName=dm.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(um,l({ref:t,className:Ue("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r)},a))})).displayName=um.displayName;const pm=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(sm,{children:m.jsx(rm,l({ref:t,className:Ue("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r)},a))})}));pm.displayName=rm.displayName;const fm=Ae.forwardRef(((e,t)=>{var s=e,{className:r,inset:a}=s,i=d(s,["className","inset"]);return m.jsx(im,l({ref:t,className:Ue("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",r)},i))}));fm.displayName=im.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a,checked:i}=s,n=d(s,["className","children","checked"]);return m.jsxs(nm,c(l({ref:t,className:Ue("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:i},n),{children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(lm,{children:m.jsx(Qe,{className:"h-4 w-4"})})}),a]}))})).displayName=nm.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r,children:a}=s,i=d(s,["className","children"]);return m.jsxs(om,c(l({ref:t,className:Ue("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r)},i),{children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(lm,{children:m.jsx(nt,{className:"h-2 w-2 fill-current"})})}),a]}))})).displayName=om.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r,inset:a}=s,i=d(s,["className","inset"]);return m.jsx(am,l({ref:t,className:Ue("px-2 py-1.5 text-sm font-semibold text-foreground",a&&"pl-8",r)},i))})).displayName=am.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(cm,l({ref:t,className:Ue("-mx-1 my-1 h-px bg-border",r)},a))})).displayName=cm.displayName;const xm=["puto","puta","porno","hijo de puta","hijodeputa","cabrón","cabron","joder","mierda","coño","cono","gilipollas","pendejo","maricón","maricon","bolludo","pelotudo","la concha","concha de tu madre","vete a la mierda","que te jodan","follar","verga","chingar","chingas","mamadas","putada","putadas"],gm=()=>{const[e,t]=Ae.useState([]),[s,r]=Ae.useState([]),[a,i]=Ae.useState({}),[n,o]=Ae.useState(!1),{toast:d}=ys(),{user:u}=hn(),m=e=>h(void 0,null,(function*(){if(u)try{const{error:t}=yield cn.from("messages").update({read_at:(new Date).toISOString()}).eq("id",e).eq("receiver_id",u.id);if(t)throw t}catch(t){console.error("Error marking message as read:",t)}}));return{messages:e,conversations:s,unreadCounts:a,loading:n,sendMessage:(e,t)=>h(void 0,null,(function*(){if(!u||!t.trim())return!1;o(!0);try{const s=(e=>{let t=e;return xm.forEach((e=>{const s=new RegExp(`\\b${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi");t=t.replace(s,"####")})),t})(t.trim()),{data:r,error:a}=yield cn.from("messages").insert([{sender_id:u.id,receiver_id:e,content:s}]).select().single();if(a)throw a;return console.log("Message sent successfully:",r),!0}catch(s){return console.error("Error sending message:",s),d({title:"Error",description:"No se pudo enviar el mensaje",variant:"destructive"}),!1}finally{o(!1)}})),deleteMessage:e=>h(void 0,null,(function*(){if(!u)return!1;try{const{error:s}=yield cn.from("messages").delete().eq("id",e).eq("sender_id",u.id);if(s)throw s;return t((t=>t.filter((t=>t.id!==e)))),console.log("Message deleted successfully:",e),d({title:"Mensaje eliminado",description:"El mensaje ha sido eliminado correctamente"}),!0}catch(s){return console.error("Error deleting message:",s),d({title:"Error",description:"No se pudo eliminar el mensaje",variant:"destructive"}),!1}})),loadMessages:e=>h(void 0,null,(function*(){if(u){o(!0);try{const{data:s,error:r}=yield cn.from("messages").select("*").or(`and(sender_id.eq.${u.id},receiver_id.eq.${e}),and(sender_id.eq.${e},receiver_id.eq.${u.id})`).order("created_at",{ascending:!0});if(r)throw r;if(console.log("Messages loaded:",s),t(s||[]),s&&s.length>0){const t=s.filter((t=>t.receiver_id===u.id&&t.sender_id===e&&!t.read_at));for(const e of t)yield m(e.id);i((t=>c(l({},t),{[e]:0})))}}catch(s){console.error("Error loading messages:",s),d({title:"Error",description:"No se pudieron cargar los mensajes",variant:"destructive"})}finally{o(!1)}}})),markAsRead:m,loadConversations:()=>h(void 0,null,(function*(){if(u){o(!0);try{const{data:e,error:t}=yield cn.from("conversations").select("*").or(`user1_id.eq.${u.id},user2_id.eq.${u.id}`).order("last_message_at",{ascending:!1});if(t)throw t;r(e||[]),yield h(void 0,null,(function*(){if(u)try{const{data:e,error:t}=yield cn.from("conversations").select("*").or(`user1_id.eq.${u.id},user2_id.eq.${u.id}`);if(t)throw t;const s={};for(const r of e||[]){const e=r.user1_id===u.id?r.user2_id:r.user1_id,{count:t,error:a}=yield cn.from("messages").select("*",{count:"exact",head:!0}).eq("sender_id",e).eq("receiver_id",u.id).is("read_at",null);a?console.error("Error counting unread messages:",a):s[e]=t||0}i(s)}catch(t){console.error("Error loading unread counts:",t)}}))}catch(e){console.error("Error loading conversations:",e),d({title:"Error",description:"No se pudieron cargar las conversaciones",variant:"destructive"})}finally{o(!1)}}})),subscribeToMessages:e=>{if(!u)return null;console.log("Setting up realtime subscription for messages with user:",e);return cn.channel(`messages-${u.id}-${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},(s=>{console.log("New message received via realtime:",s);const r=s.new;(r.sender_id===u.id&&r.receiver_id===e||r.sender_id===e&&r.receiver_id===u.id)&&(t((e=>e.some((e=>e.id===r.id))?e:(console.log("Adding new message to conversation:",r),[...e,r]))),r.sender_id===e&&r.receiver_id===u.id&&m(r.id))})).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},(s=>{console.log("Message updated via realtime:",s);const r=s.new;(r.sender_id===u.id&&r.receiver_id===e||r.sender_id===e&&r.receiver_id===u.id)&&t((e=>e.map((e=>e.id===r.id?r:e))))})).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},(s=>{console.log("Message deleted via realtime:",s);const r=s.old;(r.sender_id===u.id&&r.receiver_id===e||r.sender_id===e&&r.receiver_id===u.id)&&t((e=>e.filter((e=>e.id!==r.id))))})).subscribe((e=>{console.log("Message subscription status:",e)}))},subscribeToConversations:()=>{if(!u)return null;console.log("Setting up realtime subscription for conversations");return cn.channel(`conversations-${u.id}`).on("postgres_changes",{event:"*",schema:"public",table:"conversations"},(e=>{if(console.log("Conversation updated via realtime:",e),"INSERT"===e.eventType){const t=e.new;t.user1_id!==u.id&&t.user2_id!==u.id||r((e=>e.some((e=>e.id===t.id))?e:[t,...e]))}else if("UPDATE"===e.eventType){const t=e.new;t.user1_id!==u.id&&t.user2_id!==u.id||r((e=>e.map((e=>e.id===t.id?t:e)).sort(((e,t)=>new Date(t.last_message_at).getTime()-new Date(e.last_message_at).getTime()))))}})).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},(e=>{console.log("New message for unread count:",e);const t=e.new;t.receiver_id!==u.id||t.read_at||i((e=>c(l({},e),{[t.sender_id]:(e[t.sender_id]||0)+1})))})).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},(e=>{console.log("Message updated for unread count:",e);const t=e.new,s=e.old;t.receiver_id===u.id&&!s.read_at&&t.read_at&&i((e=>c(l({},e),{[t.sender_id]:Math.max(0,(e[t.sender_id]||1)-1)})))})).subscribe((e=>{console.log("Conversation subscription status:",e)}))}}},vm=()=>{const[e,t]=Ae.useState("default");Ae.useEffect((()=>{"Notification"in window?(t(Notification.permission),console.log("Notification permission status:",Notification.permission)):console.log("Notifications not supported in this browser")}),[]);return{permission:e,requestPermission:()=>h(void 0,null,(function*(){if("Notification"in window){console.log("Requesting notification permission...");const e=yield Notification.requestPermission();return console.log("Permission result:",e),t(e),e}return console.log("Notifications not supported"),"denied"})),showNotification:(t,s)=>{if(console.log("Attempting to show notification:",{title:t,permission:e,hidden:document.hidden}),"Notification"in window&&"granted"===e){const e=new Notification(t,l({icon:"/favicon.ico",badge:"/favicon.ico",tag:"chat-message",requireInteraction:!1},s));return console.log("Notification created successfully"),setTimeout((()=>{e.close()}),5e3),e.onclick=()=>{window.focus(),e.close()},e}return console.log("Cannot show notification:",{hasNotificationAPI:"Notification"in window,permission:e,windowHidden:document.hidden}),null},isSupported:"Notification"in window}},ym=({otherUserId:e,onBack:t})=>{const[s,r]=Ae.useState(""),[a,i]=Ae.useState(!1),n=Ae.useRef(null),{user:o}=hn(),{messages:l,loading:c,sendMessage:d,deleteMessage:u,loadMessages:p,subscribeToMessages:f}=gm(),{profile:x,fetchUserProfile:g}=zl(),{permission:v,requestPermission:y,isSupported:b}=vm();Ae.useEffect((()=>{console.log("ChatSection mounted, otherUserId:",e),e&&(g(e),p(e))}),[e]),Ae.useEffect((()=>{b&&"default"===v&&(console.log("Auto-requesting notification permission"),y())}),[b,v]),Ae.useEffect((()=>{if(!e||!o)return void console.log("Not setting up subscription - missing otherUserId or user");console.log("Setting up realtime subscription for chat with:",e);const t=f(e);return()=>{t&&(console.log("Cleaning up realtime subscription"),t.unsubscribe())}}),[e,o]),Ae.useEffect((()=>{w()}),[l]);const w=()=>{var e;null==(e=n.current)||e.scrollIntoView({behavior:"smooth"})};Ae.useEffect((()=>{if(s.trim()){const e=(e=>{const t=e.toLowerCase();return xm.some((e=>new RegExp(`\\b${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(t)))})(s);i(e)}else i(!1)}),[s]);const j=e=>new Date(e).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});return x?(console.log("Rendering ChatSection with",l.length,"messages"),m.jsxs("div",{className:"h-screen flex flex-col",style:{backgroundImage:x.background_url?`url(${x.background_url})`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:[x.background_url&&m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),m.jsxs("div",{className:"relative z-10 flex flex-col h-full max-w-4xl mx-auto w-full",children:[m.jsx("div",{className:"flex-shrink-0 p-4",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs(Ve,{variant:"outline",onClick:t,className:"border-white/20 text-white hover:bg-white/10",children:[m.jsx(He,{className:"w-4 h-4 mr-2"}),"Volver"]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs(Fn,{className:"w-10 h-10",children:[m.jsx(Vn,{src:x.avatar_url}),m.jsx(qn,{className:"bg-purple-500/20 text-white",children:m.jsx(kt,{className:"w-5 h-5"})})]}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-bold text-white",children:x.username||"Usuario"}),m.jsx("p",{className:"text-gray-300 text-sm",children:"Chat privado • En tiempo real"})]})]}),b&&m.jsx(Ve,{variant:"outline",onClick:()=>{"granted"===v?alert("Para desactivar las notificaciones, hazlo desde la configuración de tu navegador"):y()},className:"border-white/20 text-white hover:bg-white/10 ml-auto "+("granted"===v?"bg-green-500/20 border-green-500/30":""),children:"granted"===v?m.jsxs(m.Fragment,{children:[m.jsx(Je,{className:"w-4 h-4 mr-2 text-green-400"}),"Notificaciones ON"]}):m.jsxs(m.Fragment,{children:[m.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Activar notificaciones"]})})]})}),m.jsx("div",{className:"flex-1 p-4 pt-0 overflow-hidden",children:m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20 h-full flex flex-col",children:[m.jsx(wn,{className:"flex-shrink-0 pb-4",children:m.jsxs(jn,{className:"text-white flex items-center gap-2",children:[m.jsx(kt,{className:"w-5 h-5"}),"Conversación con ",x.username||"Usuario","granted"===v&&m.jsx("span",{className:"text-green-400 text-sm ml-2",children:"🔔"})]})}),m.jsxs(Nn,{className:"flex-1 flex flex-col p-4 pt-0 overflow-hidden",children:[m.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 mb-4 pr-2",children:[0===l.length?m.jsxs("div",{className:"text-center text-gray-400 py-8",children:[m.jsx(kt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),m.jsx("p",{className:"text-lg",children:"Aún no hay mensajes"}),m.jsx("p",{className:"text-sm",children:"Envía el primer mensaje para comenzar la conversación"})]}):l.map((e=>m.jsx("div",{className:"flex "+(e.sender_id===(null==o?void 0:o.id)?"justify-end":"justify-start"),children:e.sender_id===(null==o?void 0:o.id)?m.jsxs(hm,{children:[m.jsx(mm,{children:m.jsxs("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg bg-blue-500 text-white cursor-pointer hover:bg-blue-600 transition-colors",children:[m.jsx("p",{className:"break-words",children:e.content}),m.jsx("p",{className:"text-xs mt-1 text-blue-100",children:j(e.created_at)})]})}),m.jsx(pm,{className:"bg-gray-800 border-gray-700",children:m.jsxs(fm,{onClick:()=>{return t=e.id,h(void 0,null,(function*(){console.log("Deleting message:",t),yield u(t)}));var t},className:"text-red-400 hover:bg-red-500/20 hover:text-red-300 cursor-pointer",children:[m.jsx(qt,{className:"w-4 h-4 mr-2"}),"Eliminar mensaje"]})})]}):m.jsxs("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg bg-white/20 text-white border border-white/20",children:[m.jsx("p",{className:"break-words",children:e.content}),m.jsx("p",{className:"text-xs mt-1 text-gray-300",children:j(e.created_at)})]})},e.id))),m.jsx("div",{ref:n})]}),m.jsxs("div",{className:"flex-shrink-0 border-t border-white/10 pt-4",children:[a&&m.jsxs("div",{className:"mb-2 p-2 bg-yellow-500/20 border border-yellow-500/30 rounded-lg flex items-center gap-2",children:[m.jsx(Bt,{className:"w-4 h-4 text-yellow-400"}),m.jsx("span",{className:"text-yellow-200 text-sm",children:"Tu mensaje contiene palabras inapropiadas que serán censuradas automáticamente."})]}),m.jsxs("form",{onSubmit:t=>h(void 0,null,(function*(){if(t.preventDefault(),!s.trim())return;console.log("Sending message:",s);(yield d(e,s))&&(r(""),i(!1))})),className:"flex gap-2",children:[m.jsx(Sn,{value:s,onChange:e=>r(e.target.value),placeholder:"Escribe un mensaje...",className:"flex-1 bg-white/10 border-white/20 text-white placeholder:text-gray-400 focus:ring-2 focus:ring-blue-500 "+(a?"border-yellow-500/50":""),disabled:c}),m.jsx(Ve,{type:"submit",disabled:c||!s.trim(),className:"bg-blue-500 hover:bg-blue-600 text-white px-4",children:m.jsx(Ot,{className:"w-4 h-4"})})]})]})]})]})})]})]})):m.jsxs("div",{className:"min-h-screen p-4 space-y-4",children:[m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs(Ve,{variant:"outline",onClick:t,className:"border-white/20 text-white hover:bg-white/10",children:[m.jsx(He,{className:"w-4 h-4 mr-2"}),"Volver"]})}),m.jsx("div",{className:"text-center text-white",children:"Cargando chat..."})]})},bm=({onSelectChat:e})=>{const[t,s]=Ae.useState([]),[r,a]=Ae.useState(!0),{conversations:i,unreadCounts:n,loadConversations:o,subscribeToConversations:d}=gm(),{user:u}=hn();Ae.useEffect((()=>{u&&o()}),[u]),Ae.useEffect((()=>{if(!u)return;const e=d();return()=>{e&&e.unsubscribe()}}),[u]),Ae.useEffect((()=>{i.length>0?p():a(!1)}),[i]);const p=()=>h(void 0,null,(function*(){const e=[];for(const s of i){const r=s.user1_id===(null==u?void 0:u.id)?s.user2_id:s.user1_id;try{const{data:t}=yield cn.from("profiles").select("id, username, avatar_url").eq("id",r).single(),{data:a}=yield cn.from("messages").select("content, sender_id").or(`and(sender_id.eq.${s.user1_id},receiver_id.eq.${s.user2_id}),and(sender_id.eq.${s.user2_id},receiver_id.eq.${s.user1_id})`).order("created_at",{ascending:!1}).limit(1).single();t&&e.push(c(l({},s),{otherUser:t,lastMessage:a||void 0}))}catch(t){console.error("Error loading conversation profile:",t)}}s(e),a(!1)})),f=e=>{const t=new Date(e),s=new Date,r=Math.floor((s.getTime()-t.getTime())/6e4);return r<1?"Ahora":r<60?`${r}m`:r<1440?`${Math.floor(r/60)}h`:`${Math.floor(r/1440)}d`};return r?m.jsx("div",{className:"min-h-screen p-4 space-y-4",children:m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsxs(jn,{className:"text-white flex items-center gap-2",children:[m.jsx(kt,{className:"w-6 h-6"}),"Chats"]})}),m.jsx(Nn,{children:m.jsxs("div",{className:"text-center text-gray-400 py-8",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto"}),m.jsx("p",{className:"mt-4",children:"Cargando conversaciones..."})]})})]})}):m.jsx("div",{className:"min-h-screen p-4 space-y-4",children:m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsxs(jn,{className:"text-white flex items-center gap-2",children:[m.jsx(kt,{className:"w-6 h-6"}),"Chats"]})}),m.jsx(Nn,{children:0===t.length?m.jsxs("div",{className:"text-center text-gray-400 py-8",children:[m.jsx(kt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),m.jsx("p",{className:"text-lg",children:"No tienes conversaciones"}),m.jsx("p",{className:"text-sm",children:"Empieza a chatear con otros usuarios desde sus perfiles"})]}):m.jsx("div",{className:"space-y-3",children:t.map((t=>{const s=n[t.otherUser.id]||0;return m.jsxs("div",{onClick:()=>e(t.otherUser.id),className:"flex items-center gap-3 p-4 rounded-lg bg-white/5 hover:bg-white/10 transition-colors cursor-pointer border border-white/10 hover:border-white/20 relative",children:[m.jsxs("div",{className:"relative",children:[m.jsxs(Fn,{className:"w-12 h-12",children:[m.jsx(Vn,{src:t.otherUser.avatar_url}),m.jsx(qn,{className:"bg-purple-500/20 text-white",children:m.jsx(Xt,{className:"w-6 h-6"})})]}),s>0&&m.jsx(gn,{variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 flex items-center justify-center text-xs bg-red-500 hover:bg-red-600 min-w-[1.5rem]",children:s>99?"99+":s})]}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h3",{className:"text-white font-medium truncate",children:t.otherUser.username||"Usuario"}),m.jsxs("div",{className:"flex items-center gap-1 text-gray-400 text-xs",children:[m.jsx(ot,{className:"w-3 h-3"}),f(t.last_message_at)]})]}),t.lastMessage&&m.jsxs("div",{className:"text-gray-300 text-sm truncate mt-1",children:[t.lastMessage.sender_id===(null==u?void 0:u.id)?"Tú: ":"",t.lastMessage.content]})]}),m.jsx("div",{className:"text-gray-400",children:m.jsx(kt,{className:"w-5 h-5"})})]},t.id)}))})})]})})},wm=({onBack:e})=>{const{cartItems:t,removeFromCart:s,loading:r,cartCount:a,clearCart:i,total:n}=fn(),{user:o}=hn(),{toast:l}=ys();Ae.useEffect((()=>{o||r||e()}),[o,r,e]);return r?m.jsx("div",{className:"text-center text-white py-20",children:"Cargando carrito..."}):m.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8 text-white min-h-screen",children:[m.jsx("div",{className:"flex justify-start mb-6",children:m.jsx(Ve,{onClick:e,variant:"outline",className:"bg-transparent border-white/20 hover:bg-white/10",children:m.jsxs("span",{className:"inline-flex items-center gap-2 text-gray-300 hover:text-white",children:[m.jsx(He,{className:"w-4 h-4"}),"Volver a la tienda"]})})}),m.jsxs(bn,{className:"bg-white/10 backdrop-blur-lg border-white/20",children:[m.jsx(wn,{children:m.jsxs(jn,{className:"flex items-center gap-3 text-2xl text-white",children:[m.jsx(Lt,{className:"w-6 h-6"}),"Tu Carrito de Compras (",a,")"]})}),m.jsx(Nn,{children:t.length>0?m.jsx("div",{className:"space-y-4",children:t.map((e=>e.products?m.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:[m.jsx("img",{src:e.products.image_url||"/placeholder.svg",alt:e.products.title,className:"w-20 h-20 object-cover rounded-md"}),m.jsxs("div",{className:"flex-grow",children:[m.jsx("h3",{className:"font-semibold text-white",children:e.products.title}),m.jsx("p",{className:"text-sm text-gray-400",children:e.products.category})]}),m.jsxs("div",{className:"text-right",children:[m.jsxs("p",{className:"text-lg font-bold text-white",children:["$",e.products.price.toFixed(2)]}),m.jsxs(Ve,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-400 hover:bg-red-500/10",onClick:()=>s(e.id),children:[m.jsx(qt,{className:"w-4 h-4"}),m.jsx("span",{className:"sr-only",children:"Eliminar"})]})]})]},e.id):null))}):m.jsxs("div",{className:"text-center py-12 text-gray-400",children:[m.jsx(Lt,{className:"w-16 h-16 mx-auto mb-4"}),m.jsx("h3",{className:"text-xl font-semibold text-white",children:"Tu carrito está vacío"}),m.jsx("p",{children:"Añade productos para verlos aquí."})]})}),t.length>0&&m.jsxs(kn,{className:"flex flex-col sm:flex-row items-center justify-between gap-4 bg-black/20 p-6 mt-4 rounded-b-lg",children:[m.jsxs("div",{className:"text-2xl font-bold text-white",children:["Total: ",m.jsxs("span",{className:"text-purple-400",children:["$",n.toFixed(2)]})]}),m.jsxs(Ve,{size:"lg",className:"w-full sm:w-auto bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white",onClick:()=>{l({title:"Procesando pago...",description:"Esta es una simulación. ¡Gracias por tu compra!"}),setTimeout((()=>{i(),l({title:"¡Compra completada!",description:"Tus productos ahora están disponibles para descargar."}),e()}),2e3)},children:[m.jsx(lt,{className:"w-5 h-5 mr-2"}),"Proceder al Pago"]})]})]})]})},jm=()=>{const[e,t]=Ae.useState(!0),[s,r]=Ae.useState(""),[a,i]=Ae.useState(""),[n,o]=Ae.useState(!1),{signIn:l,signUp:c}=hn(),{toast:d}=ys();return m.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-brand-black via-brand-gray to-brand-black flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-[url('/grid.svg')] bg-center [mask-image:linear-gradient(180deg,white,rgba(255,255,255,0))]"}),m.jsxs(bn,{className:"w-full max-w-md bg-brand-white/10 backdrop-blur-lg border-brand-gray-light/20 relative z-10",children:[m.jsxs(wn,{className:"text-center px-0 py-[10px] my-0 mx-[10px]",children:[m.jsx("div",{className:"flex justify-center mb-6",children:m.jsx("div",{className:"w-32 h-24 flex items-center justify-center backdrop-blur-sm border border-brand-gray-light/20 p-3 bg-[#0d0d0d]/10 rounded-full mx-0 my-0 py-[15px] px-[15px]",children:m.jsx("img",{alt:"ERDEX Logo",src:"/lovable-uploads/d1bf6873-c647-4471-bd2c-246647bc51be.png",className:"h-16 w-auto filter brightness-125 contrast-125 drop-shadow-lg object-scale-down"})})}),m.jsx(jn,{className:"text-2xl font-bold text-brand-white",children:e?"Iniciar Sesión":"Crear Cuenta"}),m.jsx(_n,{className:"mx-0 px-[10px] py-0 text-lime-950 font-extrabold text-3xl",children:"Tu marketplace de productos digitales"})]}),m.jsxs(Nn,{className:"my-[10px] py-0 mx-[10px]",children:[m.jsxs("form",{onSubmit:t=>h(void 0,null,(function*(){t.preventDefault(),o(!0);try{const{error:t}=e?yield l(s,a):yield c(s,a);t?d({title:"Error",description:t.message,variant:"destructive"}):e||d({title:"¡Registro exitoso!",description:"Revisa tu email para confirmar tu cuenta"})}catch(r){d({title:"Error",description:"Algo salió mal. Intenta de nuevo.",variant:"destructive"})}finally{o(!1)}})),className:"space-y-4 py-0 my-[10px] px-0 mx-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"email",className:"text-brand-white",children:"Email"}),m.jsx(Sn,{id:"email",type:"email",placeholder:"tu@email.com",value:s,onChange:e=>r(e.target.value),required:!0,className:"border-brand-gray-light/20 text-brand-white placeholder:text-brand-gray bg-stone-950"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(co,{htmlFor:"password",className:"text-brand-white",children:"Contraseña"}),m.jsx(Sn,{id:"password",type:"password",placeholder:"********",value:a,onChange:e=>i(e.target.value),required:!0,className:"border-brand-gray-light/20 text-brand-white placeholder:text-brand-gray bg-stone-950"})]}),m.jsx(Ve,{type:"submit",disabled:n,className:"w-full bg-gradient-to-r from-brand-red to-brand-green hover:from-brand-red/80 hover:to-brand-green/80 transition-all duration-200 text-zinc-950 bg-slate-50",children:n?"Cargando...":e?"Iniciar Sesión":"Crear Cuenta"})]}),m.jsxs("p",{className:"text-center text-sm mt-4 text-zinc-950",children:[e?"¿No tienes cuenta?":"¿Ya tienes cuenta?"," ",m.jsx("button",{onClick:()=>t(!e),className:"underline text-red-500",children:e?"Crear cuenta":"Iniciar sesión"})]})]})]})]})},_m=()=>{const[e,t]=Ae.useState(null),[s,r]=Ae.useState(!0),{user:a}=hn(),{toast:i}=ys(),n=Ae.useRef(null),o=()=>h(void 0,null,(function*(){if(a)try{const{data:e,error:s}=yield cn.rpc("check_user_ban_status",{user_id:a.id});if(s)console.error("Error checking ban status:",s),t(null);else{const s=(null==e?void 0:e[0])||{is_banned:!1};t(s),s.is_banned&&i({title:"Cuenta suspendida",description:`Tu cuenta ha sido suspendida: ${s.reason}`,variant:"destructive"})}}catch(e){console.error("Error checking ban status:",e),t(null)}finally{r(!1)}else r(!1)}));return Ae.useEffect((()=>{if(a)return console.log("Setting up realtime subscription for ban status"),n.current&&(console.log("Cleaning up existing ban status channel"),n.current.unsubscribe(),n.current=null),n.current=cn.channel(`ban-status-${a.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"user_bans",filter:`user_id=eq.${a.id}`},(e=>h(void 0,null,(function*(){console.log("User banned via realtime:",e);const s=e.new,r={is_banned:!0,reason:s.reason,banned_until:s.banned_until};t(r),i({title:"Cuenta suspendida",description:`Tu cuenta ha sido suspendida: ${s.reason}`,variant:"destructive"})})))).on("postgres_changes",{event:"DELETE",schema:"public",table:"user_bans",filter:`user_id=eq.${a.id}`},(e=>h(void 0,null,(function*(){console.log("User unbanned via realtime:",e);t({is_banned:!1,reason:void 0,banned_until:void 0}),i({title:"Cuenta restaurada",description:"Tu cuenta ha sido restaurada. Ya puedes acceder a la plataforma."})})))).subscribe((e=>{console.log("Ban status subscription status:",e)})),()=>{n.current&&(console.log("Cleaning up ban status subscription"),n.current.unsubscribe(),n.current=null)}}),[a,i]),Ae.useEffect((()=>{o()}),[a]),{banStatus:e,loading:s,refreshBanStatus:o}},Nm=({reason:e,bannedUntil:t})=>{const{signOut:s}=hn(),{banStatus:r}=_m(),{toast:a}=ys();Ae.useEffect((()=>{r&&!r.is_banned&&a({title:"Cuenta restaurada",description:"Tu cuenta ha sido restaurada. Ya puedes acceder a la plataforma."})}),[r,a]);return(null==r?void 0:r.is_banned)?m.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:m.jsxs(bn,{className:"bg-gray-900/95 backdrop-blur-lg border-red-500/30 text-white max-w-md w-full",children:[m.jsxs(wn,{className:"text-center",children:[m.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center",children:m.jsx(Bt,{className:"w-8 h-8 text-red-400"})}),m.jsx(jn,{className:"text-red-400 text-xl",children:"Cuenta Suspendida"})]}),m.jsxs(Nn,{className:"space-y-4",children:[r.reason&&m.jsxs("div",{className:"p-4 bg-red-500/10 rounded-lg border border-red-500/20",children:[m.jsx("h3",{className:"font-semibold text-red-400 mb-2",children:"Razón del ban:"}),m.jsx("p",{className:"text-gray-300",children:r.reason})]}),r.banned_until&&m.jsxs("div",{className:"p-4 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:[m.jsx("h3",{className:"font-semibold text-yellow-400 mb-2",children:"Ban temporal hasta:"}),m.jsx("p",{className:"text-gray-300",children:(i=r.banned_until,new Date(i).toLocaleString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]}),!r.banned_until&&m.jsxs("div",{className:"p-4 bg-red-500/10 rounded-lg border border-red-500/20",children:[m.jsx("h3",{className:"font-semibold text-red-400 mb-2",children:"Ban permanente"}),m.jsx("p",{className:"text-gray-300",children:"Esta suspensión es permanente."})]}),m.jsx("div",{className:"p-4 bg-blue-500/10 rounded-lg border border-blue-500/20",children:m.jsxs("p",{className:"text-blue-300 text-sm",children:[m.jsx("strong",{children:"Nota:"})," Si crees que esto es un error, contacta con el soporte técnico."]})}),m.jsxs(Ve,{onClick:()=>{s()},className:"w-full bg-red-600 hover:bg-red-700 text-white",children:[m.jsx(wt,{className:"w-4 h-4 mr-2"}),"Cerrar Sesión"]})]})]})}):null;var i},km=({isVisible:e,senderAvatar:t,senderUsername:s,message:r,onHide:a})=>{const[i,n]=Ae.useState(!1);return Ae.useEffect((()=>{if(e){n(!0);const e=setTimeout((()=>{n(!1),setTimeout(a,300)}),1e3);return()=>clearTimeout(e)}}),[e,a]),e||i?m.jsx("div",{className:`\n      fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999]\n      transition-all duration-300 ease-in-out\n      ${i?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}\n    `,children:m.jsx("div",{className:"bg-white/95 backdrop-blur-lg border border-gray-200/50 rounded-lg shadow-xl p-4 max-w-sm mx-auto",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs(Fn,{className:"w-10 h-10",children:[m.jsx(Vn,{src:t}),m.jsx(qn,{className:"bg-purple-500/20 text-purple-700",children:m.jsx(kt,{className:"w-5 h-5"})})]}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"font-semibold text-gray-900 truncate",children:s}),m.jsx("span",{className:"text-xs text-gray-500",children:"💬"})]}),m.jsx("p",{className:"text-sm text-gray-700 truncate mt-1",children:r})]})]})})}):null},Sm=()=>{const[e,t]=Ae.useState("products"),[s,r]=Ae.useState(null),[a,i]=Ae.useState(null),{user:n,loading:o,signOut:l}=hn(),{isAdmin:c}=(()=>{const[e,t]=Ae.useState(null),[s,r]=Ae.useState(!0),{user:a}=hn();return Ae.useEffect((()=>{h(void 0,null,(function*(){if(!a)return t(null),void r(!1);try{const{data:e,error:s}=yield cn.from("user_roles").select("role").eq("user_id",a.id).single();s&&"PGRST116"!==s.code&&console.error("Error fetching user role:",s),t((null==e?void 0:e.role)||"user")}catch(e){console.error("Error fetching user role:",e),t("user")}finally{r(!1)}}))}),[a]),{role:e,loading:s,isAdmin:"admin"===e}})(),{banStatus:d,loading:u}=_m();zl();const{permission:p,requestPermission:f,showNotification:x,isSupported:g}=vm(),{notification:v,isVisible:y,showNotification:b,hideNotification:w}=(()=>{const[e,t]=Ae.useState(null),[s,r]=Ae.useState(!1);return{notification:e,isVisible:s,showNotification:Ae.useCallback((e=>{console.log("Showing in-app notification:",e),t(e),r(!0)}),[]),hideNotification:Ae.useCallback((()=>{console.log("Hiding in-app notification"),r(!1),setTimeout((()=>t(null)),300)}),[])}})(),j=Ae.useRef(null);Ae.useEffect((()=>{if(n)return console.log("Setting up consolidated global message subscription"),g&&"default"===p&&(console.log("Auto-requesting notification permission"),f()),j.current&&(console.log("Cleaning up existing channel"),j.current.unsubscribe(),j.current=null),j.current=cn.channel(`global-messages-${n.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${n.id}`},(t=>h(void 0,null,(function*(){console.log("New message received globally:",t);const s=t.new;if("chat"!==e||a!==s.sender_id)try{const{data:e}=yield cn.from("profiles").select("username, avatar_url").eq("id",s.sender_id).single();e&&(x(`Nuevo mensaje de ${e.username||"Usuario"}`,{body:s.content,tag:`message-${s.id}`,requireInteraction:!1}),b({senderAvatar:e.avatar_url,senderUsername:e.username||"Usuario",message:s.content}))}catch(r){console.error("Error fetching sender profile for notification:",r)}})))).subscribe((e=>{console.log("Global message subscription status:",e)})),()=>{j.current&&(console.log("Cleaning up global message subscription"),j.current.unsubscribe(),j.current=null)}}),[n,e,a,x,b,g,p,f]);const _=e=>{r(e),t("user-profile")},N=()=>{r(null),t("products")},k=e=>{i(e),t("chat")},S=()=>{i(null),t(s?"user-profile":"chats")},C=e=>{i(e),r(null),t("chat")},E=()=>{t("products")};return o||u?m.jsx("div",{className:"min-h-screen bg-gradient-to-br from-brand-black via-brand-gray to-brand-black flex items-center justify-center",children:m.jsx("div",{className:"text-white text-xl",children:"Cargando..."})}):n?(null==d?void 0:d.is_banned)?m.jsx(Nm,{reason:d.reason,bannedUntil:d.banned_until}):m.jsxs(m.Fragment,{children:[v&&m.jsx(km,{isVisible:y,senderAvatar:v.senderAvatar,senderUsername:v.senderUsername,message:v.message,onHide:w}),m.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-brand-black via-brand-gray to-brand-black",children:[m.jsx("div",{className:"absolute inset-0 opacity-30",children:m.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(90deg,transparent_24%,rgba(255,255,255,.05)_25%,rgba(255,255,255,.05)_26%,transparent_27%,transparent_74%,rgba(255,255,255,.05)_75%,rgba(255,255,255,.05)_76%,transparent_77%,transparent),linear-gradient(rgba(255,255,255,.05)_50%,transparent_50%)] bg-[size:50px_50px]"})}),m.jsxs("div",{className:"relative z-10",children:[m.jsx(yn,{activeSection:e,setActiveSection:t,onLogout:l,isAdmin:c,onUserSelect:_}),m.jsx("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8",children:m.jsx("div",{className:"max-w-7xl mx-auto",children:(()=>{switch(e){case"products":default:return m.jsx(Po,{onUserSelect:_});case"user-search":return m.jsx(Ih,{onUserSelect:_});case"chats":return m.jsx(bm,{onSelectChat:C});case"sales":return m.jsx(Ro,{});case"profile":return m.jsx(vl,{onLogout:l});case"top-sellers":return m.jsx(yl,{onUserSelect:_});case"videos":return m.jsx(Zl,{onUserSelect:_});case"my-products":return m.jsx(Hl,{});case"my-videos":return m.jsx(Kl,{});case"admin":return c?m.jsx(Rh,{onUserSelect:_}):m.jsx(Po,{onUserSelect:_});case"user-profile":return s?m.jsx(Oh,{userId:s,onBack:N,onStartChat:k}):m.jsx(Po,{onUserSelect:_});case"chat":return a?m.jsx(ym,{otherUserId:a,onBack:S}):m.jsx(Po,{onUserSelect:_});case"cart":return m.jsx(wm,{onBack:E})}})()})})]})]})]}):m.jsx(jm,{})},Cm=()=>m.jsx(Sm,{});var Em="ToastProvider",[Tm,Pm,Am]=Ne("Toast"),[Rm,Om]=_("Toast",[Am]),[Im,$m]=Rm(Em),Dm=e=>{const{__scopeToast:t,label:s="Notification",duration:r=5e3,swipeDirection:a="right",swipeThreshold:i=50,children:n}=e,[o,l]=Ae.useState(null),[c,d]=Ae.useState(0),u=Ae.useRef(!1),h=Ae.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${Em}\`. Expected non-empty \`string\`.`),m.jsx(Tm.Provider,{scope:t,children:m.jsx(Im,{scope:t,label:s,duration:r,swipeDirection:a,swipeThreshold:i,toastCount:c,viewport:o,onViewportChange:l,onToastAdd:Ae.useCallback((()=>d((e=>e+1))),[]),onToastRemove:Ae.useCallback((()=>d((e=>e-1))),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:h,children:n})})};Dm.displayName=Em;var Lm="ToastViewport",Mm=["F8"],Um="toast.viewportPause",Fm="toast.viewportResume",Vm=Ae.forwardRef(((e,t)=>{const s=e,{__scopeToast:r,hotkey:a=Mm,label:i="Notifications ({hotkey})"}=s,n=d(s,["__scopeToast","hotkey","label"]),o=$m(Lm,r),u=Pm(r),h=Ae.useRef(null),p=Ae.useRef(null),f=Ae.useRef(null),x=Ae.useRef(null),g=V(t,x,o.onViewportChange),v=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=o.toastCount>0;Ae.useEffect((()=>{const e=e=>{var t;0!==a.length&&a.every((t=>e[t]||e.code===t))&&(null==(t=x.current)||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[a]),Ae.useEffect((()=>{const e=h.current,t=x.current;if(y&&e&&t){const s=()=>{if(!o.isClosePausedRef.current){const e=new CustomEvent(Um);t.dispatchEvent(e),o.isClosePausedRef.current=!0}},r=()=>{if(o.isClosePausedRef.current){const e=new CustomEvent(Fm);t.dispatchEvent(e),o.isClosePausedRef.current=!1}},a=t=>{!e.contains(t.relatedTarget)&&r()},i=()=>{e.contains(document.activeElement)||r()};return e.addEventListener("focusin",s),e.addEventListener("focusout",a),e.addEventListener("pointermove",s),e.addEventListener("pointerleave",i),window.addEventListener("blur",s),window.addEventListener("focus",r),()=>{e.removeEventListener("focusin",s),e.removeEventListener("focusout",a),e.removeEventListener("pointermove",s),e.removeEventListener("pointerleave",i),window.removeEventListener("blur",s),window.removeEventListener("focus",r)}}}),[y,o.isClosePausedRef]);const b=Ae.useCallback((({tabbingDirection:e})=>{const t=u().map((t=>{const s=t.ref.current,r=[s,...np(s)];return"forwards"===e?r:r.reverse()}));return("forwards"===e?t.reverse():t).flat()}),[u]);return Ae.useEffect((()=>{const e=x.current;if(e){const t=t=>{var s,r,a;const i=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!i){const i=document.activeElement,n=t.shiftKey;if(t.target===e&&n)return void(null==(s=p.current)||s.focus());const o=b({tabbingDirection:n?"backwards":"forwards"}),l=o.findIndex((e=>e===i));op(o.slice(l+1))?t.preventDefault():n?null==(r=p.current)||r.focus():null==(a=f.current)||a.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}}),[u,b]),m.jsxs(ke,{ref:h,role:"region","aria-label":i.replace("{hotkey}",v),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&m.jsx(zm,{ref:p,onFocusFromOutsideViewport:()=>{op(b({tabbingDirection:"forwards"}))}}),m.jsx(Tm.Slot,{scope:r,children:m.jsx(N.ol,c(l({tabIndex:-1},n),{ref:g}))}),y&&m.jsx(zm,{ref:f,onFocusFromOutsideViewport:()=>{op(b({tabbingDirection:"backwards"}))}})]})}));Vm.displayName=Lm;var qm="ToastFocusProxy",zm=Ae.forwardRef(((e,t)=>{const s=e,{__scopeToast:r,onFocusFromOutsideViewport:a}=s,i=d(s,["__scopeToast","onFocusFromOutsideViewport"]),n=$m(qm,r);return m.jsx(Se,c(l({"aria-hidden":!0,tabIndex:0},i),{ref:t,style:{position:"fixed"},onFocus:e=>{var t;const s=e.relatedTarget;!(null==(t=n.viewport)?void 0:t.contains(s))&&a()}}))}));zm.displayName=qm;var Bm="Toast",Zm=Ae.forwardRef(((e,t)=>{const s=e,{forceMount:r,open:a,defaultOpen:i,onOpenChange:n}=s,o=d(s,["forceMount","open","defaultOpen","onOpenChange"]),[u=!0,h]=q({prop:a,defaultProp:i,onChange:n});return m.jsx(B,{present:r||u,children:m.jsx(Wm,c(l({open:u},o),{ref:t,onClose:()=>h(!1),onPause:k(e.onPause),onResume:k(e.onResume),onSwipeStart:z(e.onSwipeStart,(e=>{e.currentTarget.setAttribute("data-swipe","start")})),onSwipeMove:z(e.onSwipeMove,(e=>{const{x:t,y:s}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${s}px`)})),onSwipeCancel:z(e.onSwipeCancel,(e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")})),onSwipeEnd:z(e.onSwipeEnd,(e=>{const{x:t,y:s}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${s}px`),h(!1)}))}))})}));Zm.displayName=Bm;var[Hm,Km]=Rm(Bm,{onClose(){}}),Wm=Ae.forwardRef(((e,t)=>{const s=e,{__scopeToast:r,type:a="foreground",duration:i,open:n,onClose:o,onEscapeKeyDown:u,onPause:h,onResume:p,onSwipeStart:f,onSwipeMove:x,onSwipeCancel:g,onSwipeEnd:v}=s,y=d(s,["__scopeToast","type","duration","open","onClose","onEscapeKeyDown","onPause","onResume","onSwipeStart","onSwipeMove","onSwipeCancel","onSwipeEnd"]),b=$m(Bm,r),[w,j]=Ae.useState(null),_=V(t,(e=>j(e))),S=Ae.useRef(null),C=Ae.useRef(null),E=i||b.duration,T=Ae.useRef(0),P=Ae.useRef(E),A=Ae.useRef(0),{onToastAdd:R,onToastRemove:O}=b,I=k((()=>{var e;(null==w?void 0:w.contains(document.activeElement))&&(null==(e=b.viewport)||e.focus()),o()})),$=Ae.useCallback((e=>{e&&e!==1/0&&(window.clearTimeout(A.current),T.current=(new Date).getTime(),A.current=window.setTimeout(I,e))}),[I]);Ae.useEffect((()=>{const e=b.viewport;if(e){const t=()=>{$(P.current),null==p||p()},s=()=>{const e=(new Date).getTime()-T.current;P.current=P.current-e,window.clearTimeout(A.current),null==h||h()};return e.addEventListener(Um,s),e.addEventListener(Fm,t),()=>{e.removeEventListener(Um,s),e.removeEventListener(Fm,t)}}}),[b.viewport,E,h,p,$]),Ae.useEffect((()=>{n&&!b.isClosePausedRef.current&&$(E)}),[n,E,b.isClosePausedRef,$]),Ae.useEffect((()=>(R(),()=>O())),[R,O]);const D=Ae.useMemo((()=>w?rp(w):null),[w]);return b.viewport?m.jsxs(m.Fragment,{children:[D&&m.jsx(Gm,{__scopeToast:r,role:"status","aria-live":"foreground"===a?"assertive":"polite","aria-atomic":!0,children:D}),m.jsx(Hm,{scope:r,onClose:I,children:Pe.createPortal(m.jsx(Tm.ItemSlot,{scope:r,children:m.jsx(Ce,{asChild:!0,onEscapeKeyDown:z(u,(()=>{b.isFocusedToastEscapeKeyDownRef.current||I(),b.isFocusedToastEscapeKeyDownRef.current=!1})),children:m.jsx(N.li,c(l({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":n?"open":"closed","data-swipe-direction":b.swipeDirection},y),{ref:_,style:l({userSelect:"none",touchAction:"none"},e.style),onKeyDown:z(e.onKeyDown,(e=>{"Escape"===e.key&&(null==u||u(e.nativeEvent),e.nativeEvent.defaultPrevented||(b.isFocusedToastEscapeKeyDownRef.current=!0,I()))})),onPointerDown:z(e.onPointerDown,(e=>{0===e.button&&(S.current={x:e.clientX,y:e.clientY})})),onPointerMove:z(e.onPointerMove,(e=>{if(!S.current)return;const t=e.clientX-S.current.x,s=e.clientY-S.current.y,r=Boolean(C.current),a=["left","right"].includes(b.swipeDirection),i=["left","up"].includes(b.swipeDirection)?Math.min:Math.max,n=a?i(0,t):0,o=a?0:i(0,s),l="touch"===e.pointerType?10:2,c={x:n,y:o},d={originalEvent:e,delta:c};r?(C.current=c,ap("toast.swipeMove",x,d,{discrete:!1})):ip(c,b.swipeDirection,l)?(C.current=c,ap("toast.swipeStart",f,d,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(s)>l)&&(S.current=null)})),onPointerUp:z(e.onPointerUp,(e=>{const t=C.current,s=e.target;if(s.hasPointerCapture(e.pointerId)&&s.releasePointerCapture(e.pointerId),C.current=null,S.current=null,t){const s=e.currentTarget,r={originalEvent:e,delta:t};ip(t,b.swipeDirection,b.swipeThreshold)?ap("toast.swipeEnd",v,r,{discrete:!0}):ap("toast.swipeCancel",g,r,{discrete:!0}),s.addEventListener("click",(e=>e.preventDefault()),{once:!0})}}))}))})}),b.viewport)})]}):null})),Gm=e=>{const t=e,{__scopeToast:s,children:r}=t,a=d(t,["__scopeToast","children"]),i=$m(Bm,s),[n,o]=Ae.useState(!1),[u,h]=Ae.useState(!1);return function(e=()=>{}){const t=k(e);S((()=>{let e=0,s=0;return e=window.requestAnimationFrame((()=>s=window.requestAnimationFrame(t))),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(s)}}),[t])}((()=>o(!0))),Ae.useEffect((()=>{const e=window.setTimeout((()=>h(!0)),1e3);return()=>window.clearTimeout(e)}),[]),u?null:m.jsx(Ee,{asChild:!0,children:m.jsx(Se,c(l({},a),{children:n&&m.jsxs(m.Fragment,{children:[i.label," ",r]})}))})},Jm=Ae.forwardRef(((e,t)=>{const s=e,{__scopeToast:r}=s,a=d(s,["__scopeToast"]);return m.jsx(N.div,c(l({},a),{ref:t}))}));Jm.displayName="ToastTitle";var Xm=Ae.forwardRef(((e,t)=>{const s=e,{__scopeToast:r}=s,a=d(s,["__scopeToast"]);return m.jsx(N.div,c(l({},a),{ref:t}))}));Xm.displayName="ToastDescription";var Ym="ToastAction",Qm=Ae.forwardRef(((e,t)=>{const s=e,{altText:r}=s,a=d(s,["altText"]);return r.trim()?m.jsx(sp,{altText:r,asChild:!0,children:m.jsx(tp,c(l({},a),{ref:t}))}):(console.error(`Invalid prop \`altText\` supplied to \`${Ym}\`. Expected non-empty \`string\`.`),null)}));Qm.displayName=Ym;var ep="ToastClose",tp=Ae.forwardRef(((e,t)=>{const s=e,{__scopeToast:r}=s,a=d(s,["__scopeToast"]),i=Km(ep,r);return m.jsx(sp,{asChild:!0,children:m.jsx(N.button,c(l({type:"button"},a),{ref:t,onClick:z(e.onClick,i.onClose)}))})}));tp.displayName=ep;var sp=Ae.forwardRef(((e,t)=>{const s=e,{__scopeToast:r,altText:a}=s,i=d(s,["__scopeToast","altText"]);return m.jsx(N.div,c(l({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0},i),{ref:t}))}));function rp(e){const t=[];return Array.from(e.childNodes).forEach((e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const s=e.ariaHidden||e.hidden||"none"===e.style.display,r=""===e.dataset.radixToastAnnounceExclude;if(!s)if(r){const s=e.dataset.radixToastAnnounceAlt;s&&t.push(s)}else t.push(...rp(e))}})),t}function ap(e,t,s,{discrete:r}){const a=s.originalEvent.currentTarget,i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s});t&&a.addEventListener(e,t,{once:!0}),r?Te(a,i):a.dispatchEvent(i)}var ip=(e,t,s=0)=>{const r=Math.abs(e.x),a=Math.abs(e.y),i=r>a;return"left"===t||"right"===t?i&&r>s:!i&&a>s};function np(e){const t=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t}function op(e){const t=document.activeElement;return e.some((e=>e===t||(e.focus(),document.activeElement!==t)))}var lp=Vm,cp=Zm,dp=Jm,up=Xm,hp=Qm,mp=tp;const pp=Dm,fp=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(lp,l({ref:t,className:Ue("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r)},a))}));fp.displayName=lp.displayName;const xp=Le("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),gp=Ae.forwardRef(((e,t)=>{var s=e,{className:r,variant:a}=s,i=d(s,["className","variant"]);return m.jsx(cp,l({ref:t,className:Ue(xp({variant:a}),r)},i))}));gp.displayName=cp.displayName;Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(hp,l({ref:t,className:Ue("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r)},a))})).displayName=hp.displayName;const vp=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(mp,c(l({ref:t,className:Ue("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":""},a),{children:m.jsx(ss,{className:"h-4 w-4"})}))}));vp.displayName=mp.displayName;const yp=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(dp,l({ref:t,className:Ue("text-sm font-semibold",r)},a))}));yp.displayName=dp.displayName;const bp=Ae.forwardRef(((e,t)=>{var s=e,{className:r}=s,a=d(s,["className"]);return m.jsx(up,l({ref:t,className:Ue("text-sm opacity-90",r)},a))}));function wp(){const{toasts:e}=ys();return m.jsxs(pp,{children:[e.map((function(e){var t=e,{id:s,title:r,description:a,action:i}=t,n=d(t,["id","title","description","action"]);return m.jsxs(gp,c(l({},n),{children:[m.jsxs("div",{className:"grid gap-1",children:[r&&m.jsx(yp,{children:r}),a&&m.jsx(bp,{children:a})]}),i,m.jsx(vp,{})]}),s)})),m.jsx(fp,{})]})}function jp(){return m.jsxs(m.Fragment,{children:[m.jsx(Cm,{}),m.jsx(wp,{})]})}bp.displayName=up.displayName;const _p=()=>"file:"===window.location.protocol||"localhost"===window.location.hostname&&""===window.location.port;(()=>{const e=_p();e&&(console.log("Running in static mode - file:// protocol detected"),document.addEventListener("DOMContentLoaded",(()=>{const e=an;document.querySelectorAll('a[href^="/"]').forEach((t=>{const s=t.getAttribute("href");s&&s.startsWith("/")&&t.setAttribute("href",`${e}${s.slice(1)}`)}));document.querySelectorAll('img[src^="/"]').forEach((t=>{const s=t.getAttribute("src");s&&s.startsWith("/")&&t.setAttribute("src",`${e}${s.slice(1)}`)}))})))})();const Np=document.getElementById("root");if(!Np)throw new Error("Root element not found");e(Np).render(m.jsx(Ae.StrictMode,{children:m.jsx(un,{children:m.jsx(pn,{children:m.jsx(jp,{})})})}));
